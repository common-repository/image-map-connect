(()=>{var e={184:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)){if(n.length){var s=r.apply(null,n);s&&e.push(s)}}else if("object"===o){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var a in n)i.call(n,a)&&n[a]&&e.push(a)}}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.apply(this,arguments)}var i;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(i||(i={}));var r="beforeunload";function o(e){e.preventDefault(),e.returnValue=""}function s(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}const a=function(e){void 0===e&&(e={});var n=e.window,a=void 0===n?document.defaultView:n,l=a.history;function c(){var e=a.location,t=e.pathname,n=e.search,i=e.hash,r=l.state||{};return[r.idx,{pathname:t,search:n,hash:i,state:r.usr||null,key:r.key||"default"}]}var h=null;a.addEventListener("popstate",(function(){if(h)g.call(h),h=null;else{var e=i.Pop,t=c(),n=t[0],r=t[1];if(g.length){if(null!=n){var o=p-n;o&&(h={action:e,location:r,retry:function(){x(-1*o)}},x(o))}}else _(e)}}));var d=i.Pop,u=c(),p=u[0],m=u[1],f=s(),g=s();function y(e){return"string"==typeof e?e:(n=(t=e).pathname,i=void 0===n?"/":n,r=t.search,o=void 0===r?"":r,s=t.hash,a=void 0===s?"":s,o&&"?"!==o&&(i+="?"===o.charAt(0)?o:"?"+o),a&&"#"!==a&&(i+="#"===a.charAt(0)?a:"#"+a),i);var t,n,i,r,o,s,a}function v(e,n){return void 0===n&&(n=null),t({pathname:m.pathname,hash:"",search:""},"string"==typeof e?function(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}(e):e,{state:n,key:Math.random().toString(36).substr(2,8)})}function b(e,t){return[{usr:e.state,key:e.key,idx:t},y(e)]}function w(e,t,n){return!g.length||(g.call({action:e,location:t,retry:n}),!1)}function _(e){d=e;var t=c();p=t[0],m=t[1],f.call({action:d,location:m})}function x(e){l.go(e)}null==p&&(p=0,l.replaceState(t({},l.state,{idx:p}),""));var C={get action(){return d},get location(){return m},createHref:y,push:function e(t,n){var r=i.Push,o=v(t,n);if(w(r,o,(function(){e(t,n)}))){var s=b(o,p+1),c=s[0],h=s[1];try{l.pushState(c,"",h)}catch(e){a.location.assign(h)}_(r)}},replace:function e(t,n){var r=i.Replace,o=v(t,n);if(w(r,o,(function(){e(t,n)}))){var s=b(o,p),a=s[0],c=s[1];l.replaceState(a,"",c),_(r)}},go:x,back:function(){x(-1)},forward:function(){x(1)},listen:function(e){return f.push(e)},block:function(e){var t=g.push(e);return 1===g.length&&a.addEventListener(r,o),function(){t(),g.length||a.removeEventListener(r,o)}}};return C}(),l=(0,e.createContext)(null);function c(e){const t=new URLSearchParams(a.location.search);for(const n in e)null===e[n]?t.delete(n):t.set(n,e[n]);return"?"+t.toString()}function h(e,t,n=!1){const i=c(e);n?a.replace(i,t):a.push(i,t)}function d(){return(0,e.useContext)(l)}function u({param:t,rootPath:n,errorPath:i,children:r}){const{query:o}=d();return(0,e.useEffect)((()=>{o[t]||h({[t]:n},null,!0)}),[t,o,n]),(0,e.useMemo)((()=>{var s,a;const l=null!==(s=o[t])&&void 0!==s?s:n,c=e.Children.toArray(r);return null!==(a=c.find((e=>e.props.path&&e.props.path===l)))&&void 0!==a?a:c.find((e=>e.props.path&&e.props.path===i))}),[r,i,t,o,n]).props.children}function p(t){return(0,e.createElement)(e.Fragment,null)}const m=window.wp.components,f=window.wp.i18n,g=window.wp.data,y=window.wp.notices,v=window.wp.primitives,b=(0,e.createElement)(v.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(v.Path,{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})),w=window.wp.coreData;function _(e,t,n,i=[]){return(0,g.useSelect)((i=>{var r;const{getEntityRecords:o,hasFinishedResolution:s}=i(w.store),a=[e,t,n];return{list:null!==(r=o(...a))&&void 0!==r?r:[],loading:!s("getEntityRecords",a)}}),i)}const x={menu:"UPv2Ut4JEw47H7ZRnmpb",tab:"W7WDu2wT6syf1r2ZYKka",menuItem:"Jhcm11aO5uIfYTMORySA",addContainer:"kTk26Wx6euSZatk3Tird",placeholder:"StLhS2bRklERUmhBM2gA",empty:"S6DUF4QCfcqKpukPaIsv",dragging:"lRyKO9rj9Jg94PyuIasE",hovering:"cNSL4WNdkEzFKjCkzrU3"};function C({record:t,titleAttr:n,onSelect:i,isSelected:r,sortable:o,onDragStart:s,onDragEnter:a,onDrop:l,isHovered:c}){return(0,e.createElement)("div",{id:"imc-layout-list-item-"+t.id,onDragOver:function(e){o&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},onDrop:l,onDragEnter:function(e){o&&(e.preventDefault(),a(e))},className:c?x.hovering:""},(0,e.createElement)(m.CardBody,{size:"extraSmall",className:x.menuItem,onClick:()=>i(t.id),isShady:r},(0,e.createElement)("span",null,function(e,t){const n=t.split(".");for(const t of n)e=e[t];return e}(t,n)),o&&(0,e.createElement)(m.Draggable,{elementId:"imc-layout-list-item-"+t.id,onDragStart:s,cloneClassname:x.dragging},(({onDraggableStart:t,onDraggableEnd:n})=>(0,e.createElement)("i",{draggable:!0,className:"ri-draggable",onDragStart:t,onDragEnd:n})))),(0,e.createElement)(m.CardDivider,null))}function E({loading:t,list:n,titleAttr:i,selected:r,selectItem:o,addButton:s,sortable:a,onChangeOrder:l,children:c}){const[h,d]=(0,e.useState)(),[u,p]=(0,e.useState)();function g(e){e.preventDefault();const t=n.map((e=>e.id)),i=t.splice(h,1);t.splice(u,0,i[0]),l(t),d(null),p(null)}return(0,e.createElement)("div",{className:`${x.tab} grid-bleed`},(0,e.createElement)(m.Card,{as:"aside",className:`${x.menu} col-3`},(0,e.createElement)(m.CardBody,{size:"extraSmall",className:x.addContainer},s),(0,e.createElement)(m.CardDivider,null),t&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(m.CardBody,{size:"extraSmall"},(0,e.createElement)("div",{className:x.placeholder})),(0,e.createElement)(m.CardDivider,null)),!t&&(n.length?n.map(((t,n)=>(0,e.createElement)(C,{key:t.id,record:t,isSelected:t.id===r,onSelect:o,titleAttr:i,sortable:a,onDragStart:()=>d(n),onDragEnter:()=>p(n),onDrop:g,isHovered:u===n}))):(0,e.createElement)("p",{className:x.empty},(0,f.__)("No items found")))),(0,e.createElement)("div",{className:"full-height col-9"},c))}const S=window.React;var M=e=>"checkbox"===e.type,I=e=>e instanceof Date,k=e=>null==e;const T=e=>"object"==typeof e;var N=e=>!k(e)&&!Array.isArray(e)&&T(e)&&!I(e),R=e=>N(e)&&e.target?M(e.target)?e.target.checked:e.target.value:e,A=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),O=e=>{const t=e.constructor&&e.constructor.prototype;return N(t)&&t.hasOwnProperty("isPrototypeOf")},P="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function D(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(P&&(e instanceof Blob||e instanceof FileList)||!n&&!N(e))return e;if(t=n?[]:{},n||O(e))for(const n in e)e.hasOwnProperty(n)&&(t[n]=D(e[n]));else t=e}return t}var L=e=>Array.isArray(e)?e.filter(Boolean):[],B=e=>void 0===e,Z=(e,t,n)=>{if(!t||!N(e))return n;const i=L(t.split(/[,[\].]+?/)).reduce(((e,t)=>k(e)?e:e[t]),e);return B(i)||i===e?B(e[t])?n:e[t]:i};const z={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},F={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},V="pattern",G="required",j=S.createContext(null),W=()=>S.useContext(j),H=e=>{const{children:t,...n}=e;return S.createElement(j.Provider,{value:n},t)};var U=(e,t,n,i=!0)=>{const r={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(r,o,{get:()=>{const r=o;return t._proxyFormState[r]!==F.all&&(t._proxyFormState[r]=!i||F.all),n&&(n[r]=!0),e[r]}});return r},Y=e=>N(e)&&!Object.keys(e).length,X=(e,t,n,i)=>{n(e);const{name:r,...o}=e;return Y(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find((e=>t[e]===(!i||F.all)))},J=e=>Array.isArray(e)?e:[e],K=(e,t,n)=>n&&t?e===t:!e||!t||e===t||J(e).some((e=>e&&(e.startsWith(t)||t.startsWith(e))));function $(e){const t=S.useRef(e);t.current=e,S.useEffect((()=>{const n=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{n&&n.unsubscribe()}}),[e.disabled])}var q=e=>"string"==typeof e,Q=(e,t,n,i,r)=>q(e)?(i&&t.watch.add(e),Z(n,e,r)):Array.isArray(e)?e.map((e=>(i&&t.watch.add(e),Z(n,e)))):(i&&(t.watchAll=!0),n);function ee(e){const t=W(),{control:n=t.control,name:i,defaultValue:r,disabled:o,exact:s}=e||{},a=S.useRef(i);a.current=i,$({disabled:o,subject:n._subjects.values,next:e=>{K(a.current,e.name,s)&&c(D(Q(a.current,n._names,e.values||n._formValues,!1,r)))}});const[l,c]=S.useState(n._getWatch(i,r));return S.useEffect((()=>n._removeUnmounted())),l}var te=e=>/^\w*$/.test(e),ne=e=>L(e.replace(/["|']|\]/g,"").split(/\.|\[/));function ie(e,t,n){let i=-1;const r=te(t)?[t]:ne(t),o=r.length,s=o-1;for(;++i<o;){const t=r[i];let o=n;if(i!==s){const n=e[t];o=N(n)||Array.isArray(n)?n:isNaN(+r[i+1])?{}:[]}e[t]=o,e=e[t]}return e}const re=e=>e.render(function(e){const t=W(),{name:n,control:i=t.control,shouldUnregister:r}=e,o=A(i._names.array,n),s=ee({control:i,name:n,defaultValue:Z(i._formValues,n,Z(i._defaultValues,n,e.defaultValue)),exact:!0}),a=function(e){const t=W(),{control:n=t.control,disabled:i,name:r,exact:o}=e||{},[s,a]=S.useState(n._formState),l=S.useRef(!0),c=S.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1}),h=S.useRef(r);return h.current=r,$({disabled:i,next:e=>l.current&&K(h.current,e.name,o)&&X(e,c.current,n._updateFormState)&&a({...n._formState,...e}),subject:n._subjects.state}),S.useEffect((()=>(l.current=!0,c.current.isValid&&n._updateValid(!0),()=>{l.current=!1})),[n]),U(s,n,c.current,!1)}({control:i,name:n}),l=S.useRef(i.register(n,{...e.rules,value:s}));return l.current=i.register(n,e.rules),S.useEffect((()=>{const e=i._options.shouldUnregister||r,t=(e,t)=>{const n=Z(i._fields,e);n&&(n._f.mount=t)};if(t(n,!0),e){const e=D(Z(i._options.defaultValues,n));ie(i._defaultValues,n,e),B(Z(i._formValues,n))&&ie(i._formValues,n,e)}return()=>{(o?e&&!i._state.action:e)?i.unregister(n):t(n,!1)}}),[n,i,o,r]),{field:{name:n,value:s,onChange:S.useCallback((e=>l.current.onChange({target:{value:R(e),name:n},type:z.CHANGE})),[n]),onBlur:S.useCallback((()=>l.current.onBlur({target:{value:Z(i._formValues,n),name:n},type:z.BLUR})),[n,i]),ref:e=>{const t=Z(i._fields,n);t&&e&&(t._f.ref={focus:()=>e.focus(),select:()=>e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})}},formState:a,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Z(a.errors,n)},isDirty:{enumerable:!0,get:()=>!!Z(a.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Z(a.touchedFields,n)},error:{enumerable:!0,get:()=>Z(a.errors,n)}})}}(e));var oe=(e,t,n,i,r)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[i]:r||!0}}:{};const se=(e,t,n)=>{for(const i of n||Object.keys(e)){const n=Z(e,i);if(n){const{_f:e,...i}=n;if(e&&t(e.name)){if(e.ref.focus){e.ref.focus();break}if(e.refs&&e.refs[0].focus){e.refs[0].focus();break}}else N(i)&&se(i,t)}}};var ae=()=>{const e="undefined"==typeof performance?Date.now():1e3*performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(16*Math.random()+e)%16|0;return("x"==t?n:3&n|8).toString(16)}))},le=(e,t,n={})=>n.shouldFocus||B(n.shouldFocus)?n.focusName||`${e}.${B(n.focusIndex)?t:n.focusIndex}.`:"",ce=e=>({isOnSubmit:!e||e===F.onSubmit,isOnBlur:e===F.onBlur,isOnChange:e===F.onChange,isOnAll:e===F.all,isOnTouch:e===F.onTouched}),he=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some((t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))))),de=(e,t,n)=>{const i=L(Z(e,n));return ie(i,"root",t[n]),ie(e,n,i),e},ue=e=>"boolean"==typeof e,pe=e=>"file"===e.type,me=e=>"function"==typeof e,fe=e=>{if(!P)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ge=e=>q(e),ye=e=>"radio"===e.type,ve=e=>e instanceof RegExp;const be={value:!1,isValid:!1},we={value:!0,isValid:!0};var _e=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter((e=>e&&e.checked&&!e.disabled)).map((e=>e.value));return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!B(e[0].attributes.value)?B(e[0].value)||""===e[0].value?we:{value:e[0].value,isValid:!0}:we:be}return be};const xe={isValid:!1,value:null};var Ce=e=>Array.isArray(e)?e.reduce(((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e),xe):xe;function Ee(e,t,n="validate"){if(ge(e)||Array.isArray(e)&&e.every(ge)||ue(e)&&!e)return{type:n,message:ge(e)?e:"",ref:t}}var Se=e=>N(e)&&!ve(e)?e:{value:e,message:""},Me=async(e,t,n,i,r)=>{const{ref:o,refs:s,required:a,maxLength:l,minLength:c,min:h,max:d,pattern:u,validate:p,name:m,valueAsNumber:f,mount:g,disabled:y}=e._f,v=Z(t,m);if(!g||y)return{};const b=s?s[0]:o,w=e=>{i&&b.reportValidity&&(b.setCustomValidity(ue(e)?"":e||""),b.reportValidity())},_={},x=ye(o),C=M(o),E=x||C,S=(f||pe(o))&&B(o.value)&&B(v)||fe(o)&&""===o.value||""===v||Array.isArray(v)&&!v.length,I=oe.bind(null,m,n,_),T=(e,t,n,i="maxLength",r="minLength")=>{const s=e?t:n;_[m]={type:e?i:r,message:s,ref:o,...I(e?i:r,s)}};if(r?!Array.isArray(v)||!v.length:a&&(!E&&(S||k(v))||ue(v)&&!v||C&&!_e(s).isValid||x&&!Ce(s).isValid)){const{value:e,message:t}=ge(a)?{value:!!a,message:a}:Se(a);if(e&&(_[m]={type:G,message:t,ref:b,...I(G,t)},!n))return w(t),_}if(!(S||k(h)&&k(d))){let e,t;const i=Se(d),r=Se(h);if(k(v)||isNaN(v)){const n=o.valueAsDate||new Date(v),s=e=>new Date((new Date).toDateString()+" "+e),a="time"==o.type,l="week"==o.type;q(i.value)&&v&&(e=a?s(v)>s(i.value):l?v>i.value:n>new Date(i.value)),q(r.value)&&v&&(t=a?s(v)<s(r.value):l?v<r.value:n<new Date(r.value))}else{const n=o.valueAsNumber||(v?+v:v);k(i.value)||(e=n>i.value),k(r.value)||(t=n<r.value)}if((e||t)&&(T(!!e,i.message,r.message,"max","min"),!n))return w(_[m].message),_}if((l||c)&&!S&&(q(v)||r&&Array.isArray(v))){const e=Se(l),t=Se(c),i=!k(e.value)&&v.length>+e.value,r=!k(t.value)&&v.length<+t.value;if((i||r)&&(T(i,e.message,t.message),!n))return w(_[m].message),_}if(u&&!S&&q(v)){const{value:e,message:t}=Se(u);if(ve(e)&&!v.match(e)&&(_[m]={type:V,message:t,ref:o,...I(V,t)},!n))return w(t),_}if(p)if(me(p)){const e=Ee(await p(v,t),b);if(e&&(_[m]={...e,...I("validate",e.message)},!n))return w(e.message),_}else if(N(p)){let e={};for(const i in p){if(!Y(e)&&!n)break;const r=Ee(await p[i](v,t),b,i);r&&(e={...r,...I(i,r.message)},w(r.message),n&&(_[m]=e))}if(!Y(e)&&(_[m]={ref:b,...e},!n))return _}return w(!0),_};function Ie(e,t){return[...e,...J(t)]}var ke=e=>Array.isArray(e)?e.map((()=>{})):void 0;function Te(e,t,n){return[...e.slice(0,t),...J(n),...e.slice(t)]}var Ne=(e,t,n)=>Array.isArray(e)?(B(e[n])&&(e[n]=void 0),e.splice(n,0,e.splice(t,1)[0]),e):[];function Re(e,t){return[...J(t),...J(e)]}var Ae=(e,t)=>B(t)?[]:function(e,t){let n=0;const i=[...e];for(const e of t)i.splice(e-n,1),n++;return L(i).length?i:[]}(e,J(t).sort(((e,t)=>e-t))),Oe=(e,t,n)=>{e[t]=[e[n],e[n]=e[t]][0]};function Pe(e,t){const n=Array.isArray(t)?t:te(t)?[t]:ne(t),i=1===n.length?e:function(e,t){const n=t.slice(0,-1).length;let i=0;for(;i<n;)e=B(e)?i++:e[t[i++]];return e}(e,n),r=n.length-1,o=n[r];return i&&delete i[o],0!==r&&(N(i)&&Y(i)||Array.isArray(i)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!B(e[t]))return!1;return!0}(i))&&Pe(e,n.slice(0,-1)),e}var De=(e,t,n)=>(e[t]=n,e);function Le(e){const t=W(),{control:n=t.control,name:i,keyName:r="id",shouldUnregister:o}=e,[s,a]=S.useState(n._getFieldArray(i)),l=S.useRef(n._getFieldArray(i).map(ae)),c=S.useRef(s),h=S.useRef(i),d=S.useRef(!1);h.current=i,c.current=s,n._names.array.add(i),e.rules&&n.register(i,e.rules),$({next:({values:e,name:t})=>{if(t===h.current||!t){const t=Z(e,h.current);Array.isArray(t)&&(a(t),l.current=t.map(ae))}},subject:n._subjects.array});const u=S.useCallback((e=>{d.current=!0,n._updateFieldArray(i,e)}),[n,i]);return S.useEffect((()=>{if(n._state.action=!1,he(i,n._names)&&n._subjects.state.next({...n._formState}),d.current&&(!ce(n._options.mode).isOnSubmit||n._formState.isSubmitted))if(n._options.resolver)n._executeSchema([i]).then((e=>{const t=Z(e.errors,i),r=Z(n._formState.errors,i);(r?!t&&r.type||t&&(r.type!==t.type||r.message!==t.message):t&&t.type)&&(t?ie(n._formState.errors,i,t):Pe(n._formState.errors,i),n._subjects.state.next({errors:n._formState.errors}))}));else{const e=Z(n._fields,i);e&&e._f&&Me(e,n._formValues,n._options.criteriaMode===F.all,n._options.shouldUseNativeValidation,!0).then((e=>!Y(e)&&n._subjects.state.next({errors:de(n._formState.errors,e,i)})))}n._subjects.values.next({name:i,values:{...n._formValues}}),n._names.focus&&se(n._fields,(e=>!!e&&e.startsWith(n._names.focus||""))),n._names.focus="",n._updateValid()}),[s,i,n]),S.useEffect((()=>(!Z(n._formValues,i)&&n._updateFieldArray(i),()=>{(n._options.shouldUnregister||o)&&n.unregister(i)})),[i,n,r,o]),{swap:S.useCallback(((e,t)=>{const r=n._getFieldArray(i);Oe(r,e,t),Oe(l.current,e,t),u(r),a(r),n._updateFieldArray(i,r,Oe,{argA:e,argB:t},!1)}),[u,i,n]),move:S.useCallback(((e,t)=>{const r=n._getFieldArray(i);Ne(r,e,t),Ne(l.current,e,t),u(r),a(r),n._updateFieldArray(i,r,Ne,{argA:e,argB:t},!1)}),[u,i,n]),prepend:S.useCallback(((e,t)=>{const r=J(D(e)),o=Re(n._getFieldArray(i),r);n._names.focus=le(i,0,t),l.current=Re(l.current,r.map(ae)),u(o),a(o),n._updateFieldArray(i,o,Re,{argA:ke(e)})}),[u,i,n]),append:S.useCallback(((e,t)=>{const r=J(D(e)),o=Ie(n._getFieldArray(i),r);n._names.focus=le(i,o.length-1,t),l.current=Ie(l.current,r.map(ae)),u(o),a(o),n._updateFieldArray(i,o,Ie,{argA:ke(e)})}),[u,i,n]),remove:S.useCallback((e=>{const t=Ae(n._getFieldArray(i),e);l.current=Ae(l.current,e),u(t),a(t),n._updateFieldArray(i,t,Ae,{argA:e})}),[u,i,n]),insert:S.useCallback(((e,t,r)=>{const o=J(D(t)),s=Te(n._getFieldArray(i),e,o);n._names.focus=le(i,e,r),l.current=Te(l.current,e,o.map(ae)),u(s),a(s),n._updateFieldArray(i,s,Te,{argA:e,argB:ke(t)})}),[u,i,n]),update:S.useCallback(((e,t)=>{const r=D(t),o=De(n._getFieldArray(i),e,r);l.current=[...o].map(((t,n)=>t&&n!==e?l.current[n]:ae())),u(o),a([...o]),n._updateFieldArray(i,o,De,{argA:e,argB:r},!0,!1)}),[u,i,n]),replace:S.useCallback((e=>{const t=J(D(e));l.current=t.map(ae),u([...t]),a([...t]),n._updateFieldArray(i,[...t],(e=>e),{},!0,!1)}),[u,i,n]),fields:S.useMemo((()=>s.map(((e,t)=>({...e,[r]:l.current[t]||ae()})))),[s,r])}}function Be(){let e=[];return{get observers(){return e},next:t=>{for(const n of e)n.next&&n.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter((e=>e!==t))}}),unsubscribe:()=>{e=[]}}}var Ze=e=>k(e)||!T(e);function ze(e,t){if(Ze(e)||Ze(t))return e===t;if(I(e)&&I(t))return e.getTime()===t.getTime();const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const r of n){const n=e[r];if(!i.includes(r))return!1;if("ref"!==r){const e=t[r];if(I(n)&&I(e)||N(n)&&N(e)||Array.isArray(n)&&Array.isArray(e)?!ze(n,e):n!==e)return!1}}return!0}var Fe=e=>"select-multiple"===e.type,Ve=e=>ye(e)||M(e),Ge=e=>fe(e)&&e.isConnected,je=e=>{for(const t in e)if(me(e[t]))return!0;return!1};function We(e,t={}){const n=Array.isArray(e);if(N(e)||n)for(const n in e)Array.isArray(e[n])||N(e[n])&&!je(e[n])?(t[n]=Array.isArray(e[n])?[]:{},We(e[n],t[n])):k(e[n])||(t[n]=!0);return t}function He(e,t,n){const i=Array.isArray(e);if(N(e)||i)for(const i in e)Array.isArray(e[i])||N(e[i])&&!je(e[i])?B(t)||Ze(n[i])?n[i]=Array.isArray(e[i])?We(e[i],[]):{...We(e[i])}:He(e[i],k(t)?{}:t[i],n[i]):n[i]=!ze(e[i],t[i]);return n}var Ue=(e,t)=>He(e,t,We(t)),Ye=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:i})=>B(e)?e:t?""===e?NaN:e?+e:e:n&&q(e)?new Date(e):i?i(e):e;function Xe(e){const t=e.ref;if(!(e.refs?e.refs.every((e=>e.disabled)):t.disabled))return pe(t)?t.files:ye(t)?Ce(e.refs).value:Fe(t)?[...t.selectedOptions].map((({value:e})=>e)):M(t)?_e(e.refs).value:Ye(B(t.value)?e.ref.value:t.value,e)}var Je=(e,t,n,i)=>{const r={};for(const n of e){const e=Z(t,n);e&&ie(r,n,e._f)}return{criteriaMode:n,names:[...e],fields:r,shouldUseNativeValidation:i}},Ke=e=>B(e)?e:ve(e)?e.source:N(e)?ve(e.value)?e.value.source:e.value:e,$e=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function qe(e,t,n){const i=Z(e,n);if(i||te(n))return{error:i,name:n};const r=n.split(".");for(;r.length;){const i=r.join("."),o=Z(t,i),s=Z(e,i);if(o&&!Array.isArray(o)&&n!==i)return{name:n};if(s&&s.type)return{name:i,error:s};r.pop()}return{name:n}}var Qe=(e,t,n,i,r)=>!r.isOnAll&&(!n&&r.isOnTouch?!(t||e):(n?i.isOnBlur:r.isOnBlur)?!e:!(n?i.isOnChange:r.isOnChange)||e),et=(e,t)=>!L(Z(e,t)).length&&Pe(e,t);const tt={mode:F.onSubmit,reValidateMode:F.onChange,shouldFocusError:!0};function nt(e={},t){let n,i={...tt,...e},r={submitCount:0,isDirty:!1,isLoading:me(i.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},errors:{}},o={},s=(N(i.defaultValues)||N(i.values))&&D(i.defaultValues||i.values)||{},a=i.shouldUnregister?{}:D(s),l={action:!1,mount:!1,watch:!1},c={mount:new Set,unMount:new Set,array:new Set,watch:new Set},h=0;const d={isDirty:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},u={values:Be(),array:Be(),state:Be()},p=e.resetOptions&&e.resetOptions.keepDirtyValues,m=ce(i.mode),f=ce(i.reValidateMode),g=i.criteriaMode===F.all,y=async e=>{if(d.isValid||e){const e=i.resolver?Y((await _()).errors):await x(o,!0);e!==r.isValid&&u.state.next({isValid:e})}},v=e=>d.isValidating&&u.state.next({isValidating:e}),b=(e,t,n,i)=>{const r=Z(o,e);if(r){const o=Z(a,e,B(n)?Z(s,e):n);B(o)||i&&i.defaultChecked||t?ie(a,e,t?o:Xe(r._f)):S(e,o),l.mount&&y()}},w=(e,t,n,i,o)=>{let a=!1,l=!1;const c={name:e};if(!n||i){d.isDirty&&(l=r.isDirty,r.isDirty=c.isDirty=C(),a=l!==c.isDirty);const n=ze(Z(s,e),t);l=Z(r.dirtyFields,e),n?Pe(r.dirtyFields,e):ie(r.dirtyFields,e,!0),c.dirtyFields=r.dirtyFields,a=a||d.dirtyFields&&l!==!n}if(n){const t=Z(r.touchedFields,e);t||(ie(r.touchedFields,e,n),c.touchedFields=r.touchedFields,a=a||d.touchedFields&&t!==n)}return a&&o&&u.state.next(c),a?c:{}},_=async e=>i.resolver(a,i.context,Je(e||c.mount,o,i.criteriaMode,i.shouldUseNativeValidation)),x=async(e,t,n={valid:!0})=>{for(const o in e){const s=e[o];if(s){const{_f:e,...o}=s;if(e){const o=c.array.has(e.name),l=await Me(s,a,g,i.shouldUseNativeValidation&&!t,o);if(l[e.name]&&(n.valid=!1,t))break;!t&&(Z(l,e.name)?o?de(r.errors,l,e.name):ie(r.errors,e.name,l[e.name]):Pe(r.errors,e.name))}o&&await x(o,t,n)}}return n.valid},C=(e,t)=>(e&&t&&ie(a,e,t),!ze(j(),s)),E=(e,t,n)=>Q(e,c,{...l.mount?a:B(t)?s:q(e)?{[e]:t}:t},n,t),S=(e,t,n={})=>{const i=Z(o,e);let r=t;if(i){const n=i._f;n&&(!n.disabled&&ie(a,e,Ye(t,n)),r=fe(n.ref)&&k(t)?"":t,Fe(n.ref)?[...n.ref.options].forEach((e=>e.selected=r.includes(e.value))):n.refs?M(n.ref)?n.refs.length>1?n.refs.forEach((e=>(!e.defaultChecked||!e.disabled)&&(e.checked=Array.isArray(r)?!!r.find((t=>t===e.value)):r===e.value))):n.refs[0]&&(n.refs[0].checked=!!r):n.refs.forEach((e=>e.checked=e.value===r)):pe(n.ref)?n.ref.value="":(n.ref.value=r,n.ref.type||u.values.next({name:e,values:{...a}})))}(n.shouldDirty||n.shouldTouch)&&w(e,r,n.shouldTouch,n.shouldDirty,!0),n.shouldValidate&&G(e)},T=(e,t,n)=>{for(const i in t){const r=t[i],s=`${e}.${i}`,a=Z(o,s);!c.array.has(e)&&Ze(r)&&(!a||a._f)||I(r)?S(s,r,n):T(s,r,n)}},O=(e,n,i={})=>{const h=Z(o,e),p=c.array.has(e),m=D(n);ie(a,e,m),p?(u.array.next({name:e,values:{...a}}),(d.isDirty||d.dirtyFields)&&i.shouldDirty&&u.state.next({name:e,dirtyFields:Ue(s,a),isDirty:C(e,m)})):!h||h._f||k(m)?S(e,m,i):T(e,m,i),he(e,c)&&u.state.next({...r}),u.values.next({name:e,values:{...a}}),!l.mount&&t()},V=async t=>{const s=t.target;let l=s.name,p=!0;const b=Z(o,l);if(b){let C,E;const S=s.type?Xe(b._f):R(t),M=t.type===z.BLUR||t.type===z.FOCUS_OUT,I=!$e(b._f)&&!i.resolver&&!Z(r.errors,l)&&!b._f.deps||Qe(M,Z(r.touchedFields,l),r.isSubmitted,f,m),k=he(l,c,M);ie(a,l,S),M?(b._f.onBlur&&b._f.onBlur(t),n&&n(0)):b._f.onChange&&b._f.onChange(t);const T=w(l,S,M,!1),N=!Y(T)||k;if(!M&&u.values.next({name:l,type:t.type,values:{...a}}),I)return d.isValid&&y(),N&&u.state.next({name:l,...k?{}:T});if(!M&&k&&u.state.next({...r}),v(!0),i.resolver){const{errors:e}=await _([l]),t=qe(r.errors,o,l),n=qe(e,o,t.name||l);C=n.error,l=n.name,E=Y(e)}else C=(await Me(b,a,g,i.shouldUseNativeValidation))[l],p=isNaN(S)||S===Z(a,l,S),p&&(C?E=!1:d.isValid&&(E=await x(o,!0)));p&&(b._f.deps&&G(b._f.deps),((t,i,o,s)=>{const a=Z(r.errors,t),l=d.isValid&&ue(i)&&r.isValid!==i;var c;if(e.delayError&&o?(c=()=>((e,t)=>{ie(r.errors,e,t),u.state.next({errors:r.errors})})(t,o),n=e=>{clearTimeout(h),h=setTimeout(c,e)},n(e.delayError)):(clearTimeout(h),n=null,o?ie(r.errors,t,o):Pe(r.errors,t)),(o?!ze(a,o):a)||!Y(s)||l){const e={...s,...l&&ue(i)?{isValid:i}:{},errors:r.errors,name:t};r={...r,...e},u.state.next(e)}v(!1)})(l,E,C,T))}},G=async(e,t={})=>{let n,s;const a=J(e);if(v(!0),i.resolver){const t=await(async e=>{const{errors:t}=await _();if(e)for(const n of e){const e=Z(t,n);e?ie(r.errors,n,e):Pe(r.errors,n)}else r.errors=t;return t})(B(e)?e:a);n=Y(t),s=e?!a.some((e=>Z(t,e))):n}else e?(s=(await Promise.all(a.map((async e=>{const t=Z(o,e);return await x(t&&t._f?{[e]:t}:t)})))).every(Boolean),(s||r.isValid)&&y()):s=n=await x(o);return u.state.next({...!q(e)||d.isValid&&n!==r.isValid?{}:{name:e},...i.resolver||!e?{isValid:n}:{},errors:r.errors,isValidating:!1}),t.shouldFocus&&!s&&se(o,(e=>e&&Z(r.errors,e)),e?a:c.mount),s},j=e=>{const t={...s,...l.mount?a:{}};return B(e)?t:q(e)?Z(t,e):e.map((e=>Z(t,e)))},W=(e,t)=>({invalid:!!Z((t||r).errors,e),isDirty:!!Z((t||r).dirtyFields,e),isTouched:!!Z((t||r).touchedFields,e),error:Z((t||r).errors,e)}),H=(e,t,n)=>{const i=(Z(o,e,{_f:{}})._f||{}).ref;ie(r.errors,e,{...t,ref:i}),u.state.next({name:e,errors:r.errors,isValid:!1}),n&&n.shouldFocus&&i&&i.focus&&i.focus()},U=(e,t={})=>{for(const n of e?J(e):c.mount)c.mount.delete(n),c.array.delete(n),t.keepValue||(Pe(o,n),Pe(a,n)),!t.keepError&&Pe(r.errors,n),!t.keepDirty&&Pe(r.dirtyFields,n),!t.keepTouched&&Pe(r.touchedFields,n),!i.shouldUnregister&&!t.keepDefaultValue&&Pe(s,n);u.values.next({values:{...a}}),u.state.next({...r,...t.keepDirty?{isDirty:C()}:{}}),!t.keepIsValid&&y()},X=(e,t={})=>{let n=Z(o,e);const r=ue(t.disabled);return ie(o,e,{...n||{},_f:{...n&&n._f?n._f:{ref:{name:e}},name:e,mount:!0,...t}}),c.mount.add(e),B(t.value)||ie(a,e,t.value),n?r&&ie(a,e,t.disabled?void 0:Z(a,e,Xe(n._f))):b(e,!0,t.value),{...r?{disabled:t.disabled}:{},...i.progressive?{required:!!t.required,min:Ke(t.min),max:Ke(t.max),minLength:Ke(t.minLength),maxLength:Ke(t.maxLength),pattern:Ke(t.pattern)}:{},name:e,onChange:V,onBlur:V,ref:r=>{if(r){X(e,t),n=Z(o,e);const i=B(r.value)&&r.querySelectorAll&&r.querySelectorAll("input,select,textarea")[0]||r,a=Ve(i),l=n._f.refs||[];if(a?l.find((e=>e===i)):i===n._f.ref)return;ie(o,e,{_f:{...n._f,...a?{refs:[...l.filter(Ge),i,...Array.isArray(Z(s,e))?[{}]:[]],ref:{type:i.type,name:e}}:{ref:i}}}),b(e,!1,void 0,i)}else n=Z(o,e,{}),n._f&&(n._f.mount=!1),(i.shouldUnregister||t.shouldUnregister)&&(!A(c.array,e)||!l.action)&&c.unMount.add(e)}}},K=()=>i.shouldFocusError&&se(o,(e=>e&&Z(r.errors,e)),c.mount),$=(e,t)=>async n=>{n&&(n.preventDefault&&n.preventDefault(),n.persist&&n.persist());let s=D(a);if(u.state.next({isSubmitting:!0}),i.resolver){const{errors:e,values:t}=await _();r.errors=e,s=t}else await x(o);Pe(r.errors,"root"),Y(r.errors)?(u.state.next({errors:{}}),await e(s,n)):(t&&await t({...r.errors},n),K(),setTimeout(K)),u.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Y(r.errors),submitCount:r.submitCount+1,errors:r.errors})},ee=(n,i={})=>{const h=n||s,m=D(h),f=n&&!Y(n)?m:s;if(i.keepDefaultValues||(s=h),!i.keepValues){if(i.keepDirtyValues||p)for(const e of c.mount)Z(r.dirtyFields,e)?ie(f,e,Z(a,e)):O(e,Z(f,e));else{if(P&&B(n))for(const e of c.mount){const t=Z(o,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(fe(e)){const t=e.closest("form");if(t){t.reset();break}}}}o={}}a=e.shouldUnregister?i.keepDefaultValues?D(s):{}:D(f),u.array.next({values:{...f}}),u.values.next({values:{...f}})}c={mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},!l.mount&&t(),l.mount=!d.isValid||!!i.keepIsValid,l.watch=!!e.shouldUnregister,u.state.next({submitCount:i.keepSubmitCount?r.submitCount:0,isDirty:i.keepDirty?r.isDirty:!(!i.keepDefaultValues||ze(n,s)),isSubmitted:!!i.keepIsSubmitted&&r.isSubmitted,dirtyFields:i.keepDirtyValues?r.dirtyFields:i.keepDefaultValues&&n?Ue(s,n):{},touchedFields:i.keepTouched?r.touchedFields:{},errors:i.keepErrors?r.errors:{},isSubmitting:!1,isSubmitSuccessful:!1})},te=(e,t)=>ee(me(e)?e(a):e,t);return{control:{register:X,unregister:U,getFieldState:W,handleSubmit:$,setError:H,_executeSchema:_,_getWatch:E,_getDirty:C,_updateValid:y,_removeUnmounted:()=>{for(const e of c.unMount){const t=Z(o,e);t&&(t._f.refs?t._f.refs.every((e=>!Ge(e))):!Ge(t._f.ref))&&U(e)}c.unMount=new Set},_updateFieldArray:(e,t=[],n,i,c=!0,h=!0)=>{if(i&&n){if(l.action=!0,h&&Array.isArray(Z(o,e))){const t=n(Z(o,e),i.argA,i.argB);c&&ie(o,e,t)}if(h&&Array.isArray(Z(r.errors,e))){const t=n(Z(r.errors,e),i.argA,i.argB);c&&ie(r.errors,e,t),et(r.errors,e)}if(d.touchedFields&&h&&Array.isArray(Z(r.touchedFields,e))){const t=n(Z(r.touchedFields,e),i.argA,i.argB);c&&ie(r.touchedFields,e,t)}d.dirtyFields&&(r.dirtyFields=Ue(s,a)),u.state.next({name:e,isDirty:C(e,t),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else ie(a,e,t)},_getFieldArray:t=>L(Z(l.mount?a:s,t,e.shouldUnregister?Z(s,t,[]):[])),_reset:ee,_resetDefaultValues:()=>me(i.defaultValues)&&i.defaultValues().then((e=>{te(e,i.resetOptions),u.state.next({isLoading:!1})})),_updateFormState:e=>{r={...r,...e}},_subjects:u,_proxyFormState:d,get _fields(){return o},get _formValues(){return a},get _state(){return l},set _state(e){l=e},get _defaultValues(){return s},get _names(){return c},set _names(e){c=e},get _formState(){return r},set _formState(e){r=e},get _options(){return i},set _options(e){i={...i,...e}}},trigger:G,register:X,handleSubmit:$,watch:(e,t)=>me(e)?u.values.subscribe({next:n=>e(E(void 0,t),n)}):E(e,t,!0),setValue:O,getValues:j,reset:te,resetField:(e,t={})=>{Z(o,e)&&(B(t.defaultValue)?O(e,Z(s,e)):(O(e,t.defaultValue),ie(s,e,t.defaultValue)),t.keepTouched||Pe(r.touchedFields,e),t.keepDirty||(Pe(r.dirtyFields,e),r.isDirty=t.defaultValue?C(e,Z(s,e)):C()),t.keepError||(Pe(r.errors,e),d.isValid&&y()),u.state.next({...r}))},clearErrors:e=>{e&&J(e).forEach((e=>Pe(r.errors,e))),u.state.next({errors:e?r.errors:{}})},unregister:U,setError:H,setFocus:(e,t={})=>{const n=Z(o,e),i=n&&n._f;if(i){const e=i.refs?i.refs[0]:i.ref;e.focus&&(e.focus(),t.shouldSelect&&e.select())}},getFieldState:W}}function it(e={}){const t=S.useRef(),n=S.useRef(),[i,r]=S.useState({isDirty:!1,isValidating:!1,isLoading:me(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},errors:{},defaultValues:me(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...nt(e,(()=>r((e=>({...e}))))),formState:i});const o=t.current.control;return o._options=e,$({subject:o._subjects.state,next:e=>{X(e,o._proxyFormState,o._updateFormState,!0)&&r({...o._formState})}}),S.useEffect((()=>{e.values&&!ze(e.values,n.current)?(o._reset(e.values,o._options.resetOptions),n.current=e.values):o._resetDefaultValues()}),[e.values,o]),S.useEffect((()=>{o._state.mount||(o._updateValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()})),t.current.formState=U(i,o),t.current}const rt={colorSelect:"D_Q2L5d0OCeRsDRlA1Pn",iconRow:"CRguuFWW6LYN6m_PO9CQ",iconColBtn:"b_neSv9tWZbRBwsBYxnw",iconBtn:"Axeq9hWjcyWZcZCdNZo9",iconDropdown:"YfTk64xG_MEBTEBqJ9ww",field:"ttW7HVqn8cjXvrXSKTXu",label:"k7yCy5Hlbe9QCnAAdJP5",plainLabel:"kT64VkcoDOGyUE72NS6P",infoLabel:"QT0HXsIHmrHKnbnnl6PW",input:"ZoaYbQ7NOsaT69K4AIW4",row:"d7MNyGKGbfaLwojgBLhV",alignColour:"IkRfcw5Mx8CrQn_7rSJM",marker:"lrKSO6vstK2t2UHWO7nF",iconName:"rCeow217G88uxJFTbqNW",invalid:"ELnaywFth412oYByC25s",imageSelect:"WipvWm2ln2IsMxYxCSiK",map:"lAVFg7G4dRlDfOoX5OmX",border:"ce67RygHZzWLFXsRbmYp",center:"fCKjcwYT1iOsRdEIVLfn",iconGroup:"QhdMnAHrHlSpAbQMtp9a",featuredButtons:"y3_bfjwbo76NpqIj1mvw",featured:"QZp6Yt59oJjxJzdKqezU",right:"pIGLlPHcalTDkJ00Qsc6",spacer:"Scv_0PeQMwY2F3WGJCoQ",divider:"P1GrZnCR6W5tWMYFlF26"};function ot(e){const t=e.invalid;return rt.field+(t?" "+rt.invalid:"")}function st(){const t=(0,e.useRef)({}),{createNotice:n,removeNotice:i}=(0,g.useDispatch)(y.store);return(0,e.useCallback)((async({message:e,style:r,timeout:o=10,...s})=>{const a=await n(r,e,s);o>0&&(clearTimeout(t.current[a.notice.id]),t.current[a.notice.id]=setTimeout((()=>i(a.notice.id)),1e3*o))}),[n,i])}function at(e,t,n,i,r={},o=[]){const{record:s,status:a}=(0,g.useSelect)((o=>{var s;switch(e){case void 0:return{status:"none",record:r};case"new":return{status:"new",record:r};default:const{hasFinishedResolution:a,getEntityRecord:l}=o(w.store);return{status:a("getEntityRecord",[t,n,e,i])?"loaded":"loading",record:null!==(s=l(t,n,e,i))&&void 0!==s?s:r}}}),[t,n,e,...o]),{saveEntityRecord:l,deleteEntityRecord:c}=(0,g.useDispatch)(w.store),h=st();return{record:s,status:a,saveRecord:async function(e){try{return await l(t,n,e,{throwOnError:!0})}catch(e){return h({message:e.message,style:"error"}),!1}},delRecord:async function(){try{return await c(t,n,e,{force:!0},{throwOnError:!0})}catch(e){return h({message:e.message,style:"error"}),!1}}}}const lt=window.wp.apiFetch;var ct=n.n(lt);const ht=(0,e.forwardRef)((function({selected:t,onSelect:n,onBlur:i,inputClass:r,id:o},s){const[a,l]=(0,e.useState)([]),c=st();return(0,e.useEffect)((()=>{ct()({path:"flare/v1/post-types"}).then((e=>{l(Object.values(e))})).catch((()=>{c({message:(0,f.__)("Unable to load post types. Please refresh to try again.","image-map-connect"),style:"error"})}))}),[c]),(0,e.createElement)("div",{className:r,ref:s,id:o},a.map((r=>(0,e.createElement)(m.CheckboxControl,{key:r,label:r,checked:t.includes(r),onChange:e=>function(e,i){const r=e?[...t,i]:t.filter((e=>e!==i));n(r)}(e,r),className:"do4QoNoqTmqWw2WxOJmV",onBlur:i}))))}));function dt({name:t,tooltip:n}){return(0,e.createElement)(m.Tooltip,{text:n},(0,e.createElement)("div",{className:rt.infoLabel},(0,e.createElement)("span",null,t),(0,e.createElement)(m.Icon,{icon:"info"})))}const ut=(0,e.forwardRef)((function({label:t,value:n,onChange:i,onBlur:r,className:o},s){const a=(0,e.useRef)("clr-indicator-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.BaseControl,{label:t,id:a.current,className:o},(0,e.createElement)(m.Dropdown,{renderToggle:({isOpen:t,onToggle:i})=>(0,e.createElement)(m.ColorIndicator,{id:a.current,colorValue:n,onClick:i,"aria-expanded":t,ref:s}),renderContent:()=>(0,e.createElement)(m.ColorPicker,{color:n,onChange:i,onBlur:r}),expandOnMobile:!0,className:rt.colorSelect}))})),pt=(0,e.forwardRef)((function({label:t,icons:n,selected:i,colour:r,size:o,onSelect:s,onBlur:a,className:l},c){const h=(0,e.useRef)("btn-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.BaseControl,{label:t,className:`${rt.iconGroup} ${l}`,id:h.current},(0,e.createElement)(m.Dropdown,{renderToggle:({isOpen:t,onToggle:n})=>(0,e.createElement)(m.ToolbarButton,{id:h.current,icon:(0,e.createElement)("i",{className:i.ref,style:{fontSize:o,color:r}}),onClick:n,"aria-expanded":t,className:rt.iconBtn,ref:c}),renderContent:()=>(0,e.createElement)(m.ToolbarGroup,{className:rt.iconDropdown},n.map((t=>(0,e.createElement)(m.ToolbarButton,{key:t.ref,icon:(0,e.createElement)("i",{className:t.ref,style:{fontSize:o,color:r}}),onClick:()=>s(t,o),isActive:i.ref===t.ref})))),expandOnMobile:!0,onClose:a}))}));function mt(e){return{color:e.colour,height:e.size,lineHeight:e.size+"px",fontSize:e.size}}const ft=[{ref:"ri-checkbox-blank-circle-fill",type:"remix",iconAnchor:{x:.5,y:.5}},{ref:"ri-checkbox-blank-circle-line",type:"remix",iconAnchor:{x:.5,y:.5}},{ref:"ri-flag-fill",type:"remix",iconAnchor:{x:.1,y:.9}},{ref:"ri-flag-line",type:"remix",iconAnchor:{x:.1,y:.9}},{ref:"ri-heart-fill",type:"remix",iconAnchor:{x:.5,y:.5}},{ref:"ri-heart-line",type:"remix",iconAnchor:{x:.5,y:.5}},{ref:"ri-map-pin-2-fill",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-map-pin-2-line",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-map-pin-3-fill",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-map-pin-3-line",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-pushpin-2-fill",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-pushpin-2-line",type:"remix",iconAnchor:{x:.5,y:1}},{ref:"ri-star-fill",type:"remix",iconAnchor:{x:.5,y:.6}},{ref:"ri-star-line",type:"remix",iconAnchor:{x:.5,y:.6}}];function gt({name:t}){const{setValue:n,getValues:i,watch:r}=W(),o=st();return(0,e.useEffect)((()=>{i(t+".img.ref")||n(t+".img",ft[0])}),[i,t,n]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(m.CardDivider,null),(0,e.createElement)(m.CardBody,null,(0,e.createElement)(m.Flex,{className:rt.iconRow},(0,e.createElement)(m.FlexItem,{isBlock:!0},(0,e.createElement)(re,{name:t+".name",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.TextControl,{...t,className:ot(n)})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(re,{name:t+".img.ref",rules:{required:!0},render:({field:o,fieldState:s})=>(0,e.createElement)(pt,{icons:ft,selected:i(t+".img"),size:i(t+".size"),colour:r(t+".colour"),onSelect:(e,i)=>{n(t+".size",i,{shouldDirty:!0}),n(t+".img.iconAnchor",e.iconAnchor),n(t+".img.type",e.type),o.onChange(e.ref)},onBlur:o.onBlur,ref:o.ref,className:ot(s)})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(re,{name:t+".colour",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(ut,{...t,className:ot(n)})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(m.BaseControl,null,(0,e.createElement)(m.Button,{variant:"tertiary",icon:"no",isDestructive:!0,onClick:function(){i(t+".count")>1?o({style:"error",message:(0,f.__)("Cannot delete icon that is used by markers.","image-map-connect"),timeout:10}):n(t+".delete",!0,{shouldDirty:!0})}}))))))}const yt=24;function vt({name:t}){const{control:n,watch:i}=W(),{fields:r,append:o}=Le({name:t,control:n,rules:{required:!0}});return(0,e.createElement)(m.Card,{size:"xSmall",className:rt.input},(0,e.createElement)(m.CardBody,null,(0,e.createElement)(m.Flex,{className:rt.iconRow},(0,e.createElement)(m.FlexItem,{isBlock:!0},(0,e.createElement)(m.BaseControl,{className:rt.field,label:(0,e.createElement)(dt,{name:(0,f.__)("Icon Name","image-map-connect"),tooltip:(0,f.__)("Used when selecting an icon on a marker in the admin UI.","image-map-connect")})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(m.BaseControl,{className:rt.field,label:(0,e.createElement)(dt,{name:(0,f.__)("Icon","image-map-connect"),tooltip:(0,f.__)("Select the icon to change it","image-map-connect")})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(m.BaseControl,{className:rt.field,label:(0,e.createElement)(dt,{name:(0,f.__)("Colour","image-map-connect"),tooltip:(0,f.__)("Select the colour to change it","image-map-connect")})})),(0,e.createElement)(m.FlexItem,{className:rt.iconColBtn},(0,e.createElement)(m.BaseControl,{label:(0,f.__)("Delete","image-map-connect")})))),r.map(((n,r)=>i(`${t}.${r}.delete`)?null:(0,e.createElement)(gt,{name:`${t}.${r}`,key:n.id}))),(0,e.createElement)(m.CardDivider,null),(0,e.createElement)(m.CardBody,{className:rt.right},(0,e.createElement)(m.Button,{icon:"plus-alt",iconPosition:"left",text:(0,f.__)("Add icon","image-map-connect"),variant:"secondary",type:"button",onClick:()=>o({name:"",count:1,colour:"",img:{ref:""},size:yt,delete:!1})})))}const bt={btn:"Dmzc5HZhkAm3Sg4SHJlS"};function wt({model:t,id:n,onSave:i,onDelete:r,confirmDeleteText:o}){const{formState:s,handleSubmit:a}=W(),[l,c]=(0,e.useState)(!1),d=st();return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:bt.btn},(0,e.createElement)(m.Button,{variant:"primary",className:"medium",type:"button",onClick:a((async function(e){const r=await i(e);"new"===n&&r?.id&&h({[t]:r.id},{force:!0})}),(function(){d({message:(0,f.__)("Please fill out the highlighted required fields.","image-map-connect"),style:"error"})})),disabled:!Object.keys(s.dirtyFields).length||s.isSubmitting},(0,f.__)("Save"))),(0,e.createElement)("div",{className:bt.btn},(0,e.createElement)(m.Button,{isDestructive:!0,className:"medium",type:"button",onClick:()=>c(!0)},(0,f.__)("Delete"))),l&&(0,e.createElement)(m.Modal,{title:(0,f.__)("Delete"),onRequestClose:()=>c(!1)},(0,e.createElement)("p",null,o),(0,e.createElement)(m.Flex,{justify:"end",gap:4},(0,e.createElement)(m.Button,{variant:"secondary",className:"medium",type:"button",onClick:()=>c(!1)},(0,f.__)("Cancel")),(0,e.createElement)(m.Button,{variant:"primary",isDestructive:!0,className:"medium",type:"button",onClick:async function(){const e=await r();c(!1),e&&h({[t]:null})}},(0,f.__)("Delete")))))}function _t({form:t,children:n}){const{history:i,navigate:r}=d();return(0,e.useEffect)((()=>{if(t.formState.isDirty){const e=i.block((({retry:t,location:n})=>{(n.state?.force||window.confirm((0,f.__)("Your record is not saved. Are you sure you want to cancel your changes?","image-map-connect")))&&(e(),t())}));return e}}),[t.formState.isDirty,i,r]),(0,e.createElement)(H,{...t},n)}const xt={title:{raw:""},excerpt:{raw:""},meta:{post_types:[]},icon_details:[],status:"publish"};function Ct(){const{query:t}=d(),{record:n,status:i,saveRecord:r,delRecord:o}=at(t.map,"postType","imc-map",{_fields:"id,title,excerpt,meta,icon_details,status"},xt),s=it({mode:"onTouched",defaultValues:n}),{isSubmitSuccessful:a,errors:l}=s.formState;(0,e.useEffect)((()=>{("new"===i||"loaded"===i||a)&&s.reset(n)}),[s,a,n,i]);const c=(0,e.useRef)("post-types-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.Card,{className:"full-height"},(0,e.createElement)(m.CardBody,null,"none"===i&&(0,e.createElement)("h3",null,(0,f.__)("Select a map from the list or add a new one.","image-map-connect")),"loading"===i&&(0,e.createElement)(m.Spinner,{style:{width:"100px",height:"100px"}}),("new"===i||"loaded"===i)&&(0,e.createElement)(_t,{form:s},(0,e.createElement)("h2",null,"new"===t.map?(0,f.__)("Add Map","image-map-connect"):(0,f.__)("Edit Map","image-map-connect")),(0,e.createElement)("div",{className:"col-xs-9"},(0,e.createElement)(re,{name:"title.raw",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.TextControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Map name","image-map-connect"),tooltip:(0,f.__)("Used for internal clarification only.","image-map-connect")}),...t,className:ot(n)})}),(0,e.createElement)(re,{name:"excerpt.raw",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.TextControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Description","image-map-connect"),tooltip:(0,f.__)("Used for internal clarification only.","image-map-connect")}),...t,className:ot(n)})}),(0,e.createElement)(re,{name:"meta.post_types",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Post Types","image-map-connect"),tooltip:(0,f.__)("Select the types of posts that can be referenced on this image map.","image-map-connect")}),className:ot(n),id:c.current},(0,e.createElement)(ht,{selected:t.value,onSelect:t.onChange,onBlur:t.onBlur,inputClass:rt.input,ref:t.ref,id:c.current}))}),(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Icon types","image-map-connect"),tooltip:(0,f.__)("Icon options for each marker on the map.","image-map-connect")}),className:ot({invalid:l.icon_details&&l.icon_details.root}),id:"no-input-to-focus-on"},(0,e.createElement)(vt,{name:"icon_details"}))),(0,e.createElement)("div",{className:"col-xs-3"},(0,e.createElement)(wt,{model:"map",id:t.map,onSave:r,onDelete:o,confirmDeleteText:(0,f.__)("Are you sure you want to delete this map?","image-map-connect")})))))}function Et(){const{query:t,navigate:n}=d(),{list:i,loading:r}=_("postType","imc-map",{_fields:"id,title"},[]);function o(e){n({map:e,layer:null,marker:null})}return(0,e.createElement)(E,{list:i,titleAttr:"title.rendered",selected:Number(t.map),selectItem:o,loading:r&&!(i&&i.length),addButton:(0,e.createElement)(m.Button,{variant:"primary",className:"medium",onClick:()=>o("new")},(0,f.__)("Add Map"))},(0,e.createElement)(Ct,null))}const St=class{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},Mt="propertychange",It=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function kt(e,t){return e>t?1:e<t?-1:0}function Tt(e,t,n){if(e[0]<=t)return 0;const i=e.length;if(t<=e[i-1])return i-1;if("function"==typeof n){for(let r=1;r<i;++r){const i=e[r];if(i===t)return r;if(i<t)return n(t,e[r-1],i)>0?r-1:r}return i-1}if(n>0){for(let n=1;n<i;++n)if(e[n]<t)return n-1;return i-1}if(n<0){for(let n=1;n<i;++n)if(e[n]<=t)return n;return i-1}for(let n=1;n<i;++n){if(e[n]==t)return n;if(e[n]<t)return e[n-1]-t<t-e[n]?n-1:n}return i-1}function Nt(e,t){const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Rt(){return!0}function At(){return!1}function Ot(){}function Pt(e){for(const t in e)delete e[t]}const Dt=class extends It{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),i=n[e]||(n[e]=[]);i.includes(t)||i.push(t)}dispatchEvent(e){const t="string"==typeof e,n=t?e:e.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const r=t?new St(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});let a;n in o||(o[n]=0,s[n]=0),++o[n];for(let e=0,t=i.length;e<t;++e)if(a="handleEvent"in i[e]?i[e].handleEvent(r):i[e].call(this,r),!1===a||r.propagationStopped){a=!1;break}if(0==--o[n]){let e=s[n];for(delete s[n];e--;)this.removeEventListener(n,Ot);delete o[n]}return a}disposeInternal(){this.listeners_&&Pt(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){const n=this.listeners_&&this.listeners_[e];if(n){const i=n.indexOf(t);-1!==i&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[i]=Ot,++this.pendingRemovals_[e]):(n.splice(i,1),0===n.length&&delete this.listeners_[e]))}}},Lt="change",Bt="contextmenu",Zt="click",zt="keydown",Ft="keypress",Vt="touchmove",Gt="wheel";function jt(e,t,n,i,r){if(i&&i!==e&&(n=n.bind(i)),r){const i=n;n=function(){e.removeEventListener(t,n),i.apply(this,arguments)}}const o={target:e,type:t,listener:n};return e.addEventListener(t,n),o}function Wt(e,t,n,i){return jt(e,t,n,i,!0)}function Ht(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),Pt(e))}class Ut extends Dt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Lt)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=jt(this,e[r],t);return i}return jt(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const i=e.length;n=new Array(i);for(let r=0;r<i;++r)n[r]=Wt(this,e[r],t)}else n=Wt(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)!function(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)Ht(e[t]);else Ht(e)}(n);else if(Array.isArray(e))for(let n=0,i=e.length;n<i;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}Ut.prototype.on,Ut.prototype.once,Ut.prototype.un;const Yt=Ut;function Xt(){throw new Error("Unimplemented abstract method.")}let Jt=0;function Kt(e){return e.ol_uid||(e.ol_uid=String(++Jt))}class $t extends St{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}const qt=class extends Yt{constructor(e){super(),this.on,this.once,this.un,Kt(this),this.values_=null,void 0!==e&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new $t(n,e,t)),n=Mt,this.hasListener(n)&&this.dispatchEvent(new $t(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const i=this.values_||(this.values_={});if(n)i[e]=t;else{const n=i[e];i[e]=t,n!==t&&this.notify(e,n)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],function(e){let t;for(t in e)return!1;return!t}(this.values_)&&(this.values_=null),t||this.notify(e,n)}}},Qt={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class en extends Error{constructor(e){const t=Qt[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}const tn=en,nn="add",rn="remove",on="length";class sn extends St{constructor(e,t,n){super(e),this.element=t,this.index=n}}const an=class extends qt{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(on)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new sn(nn,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new sn(rn,t,e)),t}setAt(e,t){if(e>=this.getLength())return void this.insertAt(e,t);if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new sn(rn,n,e)),this.dispatchEvent(new sn(nn,t,e))}updateLength_(){this.set(on,this.array_.length)}assertUnique_(e,t){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===e&&n!==t)throw new tn(58)}},ln="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",cn=ln.includes("firefox"),hn=(ln.includes("safari")&&!ln.includes("chrom")&&(ln.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ln)),ln.includes("webkit")&&!ln.includes("edge")),dn=ln.includes("macintosh"),un="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,pn="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,mn="undefined"!=typeof Image&&Image.prototype.decode,fn=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(e){}return e}();function gn(e,t){if(!e)throw new tn(t)}function yn(e,t){const n=t[0],i=t[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t}function vn(e,t,n,i,r,o,s,a){const l=Math.sin(o),c=Math.cos(o);return e[0]=i*c,e[1]=r*l,e[2]=-i*l,e[3]=r*c,e[4]=s*i*c-a*i*l+t,e[5]=s*r*l+a*r*c+n,e}function bn(e,t){const n=(i=t)[0]*i[3]-i[1]*i[2];var i;gn(0!==n,32);const r=t[0],o=t[1],s=t[2],a=t[3],l=t[4],c=t[5];return e[0]=a/n,e[1]=-o/n,e[2]=-s/n,e[3]=r/n,e[4]=(s*c-a*l)/n,e[5]=-(r*c-o*l)/n,e}let wn;new Array(6);const xn={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Cn(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0,i=e.length;n<i;++n)An(t,e[n]);return t}function En(e,t,n){let i,r;return i=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,r=n<e[1]?e[1]-n:e[3]<n?n-e[3]:0,i*i+r*r}function Sn(e,t){return In(e,t[0],t[1])}function Mn(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function In(e,t,n){return e[0]<=t&&t<=e[2]&&e[1]<=n&&n<=e[3]}function kn(e,t){const n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1];let l=xn.UNKNOWN;return s<n?l|=xn.LEFT:s>r&&(l|=xn.RIGHT),a<i?l|=xn.BELOW:a>o&&(l|=xn.ABOVE),l===xn.UNKNOWN&&(l=xn.INTERSECTING),l}function Tn(e,t,n,i,r){return r?(r[0]=e,r[1]=t,r[2]=n,r[3]=i,r):[e,t,n,i]}function Nn(e){return Tn(1/0,1/0,-1/0,-1/0,e)}function Rn(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function An(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function On(e,t,n,i,r){for(;n<i;n+=r)Pn(e,t[n],t[n+1]);return e}function Pn(e,t,n){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],n),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],n)}function Dn(e){return[e[0],e[1]]}function Ln(e){return[e[2],e[1]]}function Bn(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Zn(e,t,n,i,r){const[o,s,a,l,c,h,d,u]=function(e,t,n,i){const r=t*i[0]/2,o=t*i[1]/2,s=Math.cos(n),a=Math.sin(n),l=r*s,c=r*a,h=o*s,d=o*a,u=e[0],p=e[1];return[u-l+d,p-c-h,u-l-d,p-c+h,u+l-d,p+c+h,u+l+d,p+c-h,u-l+d,p-c-h]}(e,t,n,i);return Tn(Math.min(o,a,c,d),Math.min(s,l,h,u),Math.max(o,a,c,d),Math.max(s,l,h,u),r)}function zn(e){return e[3]-e[1]}function Fn(e,t,n){const i=n||[1/0,1/0,-1/0,-1/0];return Wn(e,t)?(e[0]>t[0]?i[0]=e[0]:i[0]=t[0],e[1]>t[1]?i[1]=e[1]:i[1]=t[1],e[2]<t[2]?i[2]=e[2]:i[2]=t[2],e[3]<t[3]?i[3]=e[3]:i[3]=t[3]):Nn(i),i}function Vn(e){return[e[0],e[3]]}function Gn(e){return[e[2],e[3]]}function jn(e){return e[2]-e[0]}function Wn(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Hn(e){return e[2]<e[0]||e[3]<e[1]}function Un(e,t,n){return Math.min(Math.max(e,t),n)}function Yn(e,t,n,i,r,o){const s=r-n,a=o-i;if(0!==s||0!==a){const l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return Xn(e,t,n,i)}function Xn(e,t,n,i){const r=n-e,o=i-t;return r*r+o*o}function Jn(e){return e*Math.PI/180}function Kn(e,t){const n=e%t;return n*t<0?n+t:n}function $n(e,t,n){return e+n*(t-e)}const qn=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Qn=/^([a-z]*)$|^hsla?\(.*\)$/i;const ei=function(){const e={};let t=0;return function(n){let i;if(e.hasOwnProperty(n))i=e[n];else{if(t>=1024){let n=0;for(const i in e)0==(3&n++)&&(delete e[i],--t)}i=function(e){let t,n,i,r,o;if(Qn.exec(e)&&(e=function(e){const t=document.createElement("div");if(t.style.color=e,""!==t.style.color){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}return""}(e)),qn.exec(e)){const s=e.length-1;let a;a=s<=4?1:2;const l=4===s||8===s;t=parseInt(e.substr(1+0*a,a),16),n=parseInt(e.substr(1+1*a,a),16),i=parseInt(e.substr(1+2*a,a),16),r=l?parseInt(e.substr(1+3*a,a),16):255,1==a&&(t=(t<<4)+t,n=(n<<4)+n,i=(i<<4)+i,l&&(r=(r<<4)+r)),o=[t,n,i,r/255]}else e.startsWith("rgba(")?(o=e.slice(5,-1).split(",").map(Number),ni(o)):e.startsWith("rgb(")?(o=e.slice(4,-1).split(",").map(Number),o.push(1),ni(o)):gn(!1,14);return o}(n),e[n]=i,++t}return i}}();function ti(e){return Array.isArray(e)?e:ei(e)}function ni(e){return e[0]=Un(e[0]+.5|0,0,255),e[1]=Un(e[1]+.5|0,0,255),e[2]=Un(e[2]+.5|0,0,255),e[3]=Un(e[3],0,1),e}function ii(e,t,n){return t+":"+e+":"+(n?function(e){return"string"==typeof e?e:function(e){let t=e[0];t!=(0|t)&&(t=t+.5|0);let n=e[1];n!=(0|n)&&(n=n+.5|0);let i=e[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+t+","+n+","+i+","+(void 0===e[3]?1:Math.round(100*e[3])/100)+")"}(e)}(n):"null")}const ri=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];0!=(3&e++)||n.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const i=ii(e,t,n);return i in this.cache_?this.cache_[i]:null}set(e,t,n,i){const r=ii(e,t,n);this.cache_[r]=i,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}},oi="opacity",si="visible",ai="extent",li="zIndex",ci="maxResolution",hi="minResolution",di="maxZoom",ui="minZoom",pi="source",mi=class extends qt{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);"object"==typeof e.properties&&(delete t.properties,Object.assign(t,e.properties)),t[oi]=void 0!==e.opacity?e.opacity:1,gn("number"==typeof t[oi],64),t[si]=void 0===e.visible||e.visible,t[li]=e.zIndex,t[ci]=void 0!==e.maxResolution?e.maxResolution:1/0,t[hi]=void 0!==e.minResolution?e.minResolution:0,t[ui]=void 0!==e.minZoom?e.minZoom:-1/0,t[di]=void 0!==e.maxZoom?e.maxZoom:1/0,this.className_=void 0!==t.className?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:void 0===e||e},n=this.getZIndex();return t.opacity=Un(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=void 0!==n||t.managed?n:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Xt()}getLayerStatesArray(e){return Xt()}getExtent(){return this.get(ai)}getMaxResolution(){return this.get(ci)}getMinResolution(){return this.get(hi)}getMinZoom(){return this.get(ui)}getMaxZoom(){return this.get(di)}getOpacity(){return this.get(oi)}getSourceState(){return Xt()}getVisible(){return this.get(si)}getZIndex(){return this.get(li)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(ai,e)}setMaxResolution(e){this.set(ci,e)}setMinResolution(e){this.set(hi,e)}setMaxZoom(e){this.set(di,e)}setMinZoom(e){this.set(ui,e)}setOpacity(e){gn("number"==typeof e,64),this.set(oi,e)}setVisible(e){this.set(si,e)}setZIndex(e){this.set(li,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},fi="precompose",gi="rendercomplete",yi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},vi={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},bi=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||vi[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}},wi=6378137,_i=Math.PI*wi,xi=[-_i,-_i,_i,_i],Ci=[-180,-85,180,85],Ei=wi*Math.log(Math.tan(Math.PI/2));class Si extends bi{constructor(e){super({code:e,units:"m",extent:xi,global:!0,worldExtent:Ci,getPointResolution:function(e,t){return e/Math.cosh(t[1]/wi)}})}}const Mi=[new Si("EPSG:3857"),new Si("EPSG:102100"),new Si("EPSG:102113"),new Si("EPSG:900913"),new Si("http://www.opengis.net/def/crs/EPSG/0/3857"),new Si("http://www.opengis.net/gml/srs/epsg.xml#3857")];const Ii=[-180,-90,180,90],ki=6378137*Math.PI/180;class Ti extends bi{constructor(e,t){super({code:e,units:"degrees",extent:Ii,axisOrientation:t,global:!0,metersPerUnit:ki,worldExtent:Ii})}}const Ni=[new Ti("CRS:84"),new Ti("EPSG:4326","neu"),new Ti("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ti("urn:ogc:def:crs:OGC:2:84"),new Ti("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ti("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ti("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ri={},Ai={};function Oi(e,t,n){const i=e.getCode(),r=t.getCode();i in Ai||(Ai[i]={}),Ai[i][r]=n}function Pi(e,t){let n=!0;for(let i=e.length-1;i>=0;--i)if(e[i]!=t[i]){n=!1;break}return n}function Di(e,t){const n=Math.cos(t),i=Math.sin(t),r=e[0]*n-e[1]*i,o=e[1]*n+e[0]*i;return e[0]=r,e[1]=o,e}const Li=6371008.8;function Bi(e,t,n){n=n||Li;const i=Jn(e[1]),r=Jn(t[1]),o=(r-i)/2,s=Jn(t[0]-e[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(r);return 2*n*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const Zi={info:1,warn:2,error:3,none:4};let zi=Zi.info;function Fi(...e){zi>Zi.warn||console.warn(...e)}let Vi=!0;function Gi(e,t){if(void 0!==t)for(let n=0,i=e.length;n<i;++n)t[n]=e[n];else t=e.slice();return t}function ji(e,t){if(void 0!==t&&e!==t){for(let n=0,i=e.length;n<i;++n)t[n]=e[n];e=t}return e}function Wi(e){!function(e,t){Ri[e]=t}(e.getCode(),e),Oi(e,e,Gi)}function Hi(e){return"string"==typeof e?function(e){return Ri[e]||Ri[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}(e):e||null}function Ui(e,t,n,i){let r;const o=(e=Hi(e)).getPointResolutionFunc();if(o){if(r=o(t,n),i&&i!==e.getUnits()){const t=e.getMetersPerUnit();t&&(r=r*t/vi[i])}}else{const o=e.getUnits();if("degrees"==o&&!i||"degrees"==i)r=t;else{const s=Ki(e,Hi("EPSG:4326"));if(s===ji&&"degrees"!==o)r=t*e.getMetersPerUnit();else{let e=[n[0]-t/2,n[1],n[0]+t/2,n[1],n[0],n[1]-t/2,n[0],n[1]+t/2];e=s(e,e,2),r=(Bi(e.slice(0,2),e.slice(2,4))+Bi(e.slice(4,6),e.slice(6,8)))/2}const a=i?vi[i]:e.getMetersPerUnit();void 0!==a&&(r/=a)}}return r}function Yi(e){!function(e){e.forEach(Wi)}(e),e.forEach((function(t){e.forEach((function(e){t!==e&&Oi(t,e,Gi)}))}))}function Xi(e,t){return e?"string"==typeof e?Hi(e):e:Hi(t)}function Ji(e,t){if(e===t)return!0;const n=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||Ki(e,t)===Gi)&&n}function Ki(e,t){let n=function(e,t){let n;return e in Ai&&t in Ai[e]&&(n=Ai[e][t]),n}(e.getCode(),t.getCode());return n||(n=ji),n}function $i(e,t){return Ki(Hi(e),Hi(t))}function qi(e,t,n){return $i(t,n)(e,void 0,e.length)}let Qi=null;function er(){return Qi}function tr(e,t){return e}function nr(e,t){return Vi&&!Pi(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(Vi=!1,Fi("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e}function ir(e,t){return e}var rr,or,sr;function ar(e,t,n){return function(i,r,o,s,a){if(!i)return;if(!r&&!t)return i;const l=t?0:o[0]*r,c=t?0:o[1]*r,h=a?a[0]:0,d=a?a[1]:0;let u=e[0]+l/2+h,p=e[2]-l/2+h,m=e[1]+c/2+d,f=e[3]-c/2+d;u>p&&(u=(p+u)/2,p=u),m>f&&(m=(f+m)/2,f=m);let g=Un(i[0],u,p),y=Un(i[1],m,f);if(s&&n&&r){const e=30*r;g+=-e*Math.log(1+Math.max(0,u-i[0])/e)+e*Math.log(1+Math.max(0,i[0]-p)/e),y+=-e*Math.log(1+Math.max(0,m-i[1])/e)+e*Math.log(1+Math.max(0,i[1]-f)/e)}return[g,y]}}function lr(e){return e}function cr(e,t,n,i){const r=jn(t)/n[0],o=zn(t)/n[1];return i?Math.min(e,Math.max(r,o)):Math.min(e,Math.min(r,o))}function hr(e,t,n){let i=Math.min(e,t);return i*=Math.log(1+50*Math.max(0,e/t-1))/50+1,n&&(i=Math.max(i,n),i/=Math.log(1+50*Math.max(0,n/e-1))/50+1),Un(i,n/2,2*t)}function dr(e,t,n,i,r){return n=void 0===n||n,function(o,s,a,l){if(void 0!==o){const s=i?cr(e,i,a,r):e;return n&&l?hr(o,s,t):Un(o,t,s)}}}function ur(e){if(void 0!==e)return 0}function pr(e){if(void 0!==e)return e}function mr(e){return 1-function(e){return Math.pow(e,3)}(1-e)}function fr(e){return 3*e*e-2*e*e*e}function gr(e){return e}Yi(Mi),Yi(Ni),rr=Mi,or=function(e,t,n){const i=e.length;n=n>1?n:2,void 0===t&&(t=n>2?e.slice():new Array(i));for(let r=0;r<i;r+=n){t[r]=_i*e[r]/180;let n=wi*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));n>Ei?n=Ei:n<-Ei&&(n=-Ei),t[r+1]=n}return t},sr=function(e,t,n){const i=e.length;n=n>1?n:2,void 0===t&&(t=n>2?e.slice():new Array(i));for(let r=0;r<i;r+=n)t[r]=180*e[r]/_i,t[r+1]=360*Math.atan(Math.exp(e[r+1]/wi))/Math.PI-90;return t},Ni.forEach((function(e){rr.forEach((function(t){Oi(e,t,or),Oi(t,e,sr)}))}));const yr=[1,0,0,1,0,0],vr=class extends qt{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(e){let t,n,i,r=!1;return function(){const o=Array.prototype.slice.call(arguments);return r&&this===i&&Nt(o,n)||(r=!0,i=this,n=o,t=e.apply(this,arguments)),t}}((function(e,t,n){if(!n)return this.getSimplifiedGeometry(t);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(t)}))}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Xt()}closestPointXY(e,t,n,i){return Xt()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Xt()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Nn(e),this.extentRevision_=this.getRevision()}return function(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}(this.extent_,e)}rotate(e,t){Xt()}scale(e,t,n){Xt()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Xt()}getType(){return Xt()}applyTransform(e){Xt()}intersectsExtent(e){return Xt()}translate(e,t){Xt()}transform(e,t){const n=Hi(e),i="tile-pixels"==n.getUnits()?function(e,i,r){const o=n.getExtent(),s=n.getWorldExtent(),a=zn(s)/zn(o);return vn(yr,s[0],s[3],a,-a,0,0,0),function(e,t,n,i,r,o){o=o||[];let s=0;for(let t=0;t<n;t+=i){const n=e[t],i=e[t+1];o[s++]=r[0]*n+r[2]*i+r[4],o[s++]=r[1]*n+r[3]*i+r[5]}o&&o.length!=s&&(o.length=s)}(e,0,e.length,r,yr,i),$i(n,t)(e,i,r)}:$i(n,t);return this.applyTransform(i),this}};function br(e){let t;return"XY"==e?t=2:"XYZ"==e||"XYM"==e?t=3:"XYZM"==e&&(t=4),t}const wr=class extends vr{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return t=this.flatCoordinates,n=this.flatCoordinates.length,i=this.stride,On(Nn(e),t,0,n,i);var t,n,i}getCoordinates(){return Xt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=br(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Xt()}setLayout(e,t,n){let i;if(e)i=br(e);else{for(let e=0;e<n;++e){if(0===t.length)return this.layout="XY",void(this.stride=2);t=t[0]}i=t.length,e=function(e){let t;return 2==e?t="XY":3==e?t="XYZ":4==e&&(t="XYZM"),t}(i)}this.layout=e,this.stride=i}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();!function(e,t,n,i,r,o,s){s=s||[];const a=Math.cos(r),l=Math.sin(r),c=o[0],h=o[1];let d=0;for(let t=0;t<n;t+=i){const n=e[t]-c,r=e[t+1]-h;s[d++]=c+n*a-r*l,s[d++]=h+n*l+r*a;for(let n=t+2;n<t+i;++n)s[d++]=e[n]}s&&s.length!=d&&(s.length=d)}(n,0,n.length,i,e,t,n),this.changed()}}scale(e,t,n){void 0===t&&(t=e),n||(n=Bn(this.getExtent()));const i=this.getFlatCoordinates();if(i){const r=this.getStride();!function(e,t,n,i,r,o,s,a){a=a||[];const l=s[0],c=s[1];let h=0;for(let t=0;t<n;t+=i){const n=e[t]-l,s=e[t+1]-c;a[h++]=l+r*n,a[h++]=c+o*s;for(let n=t+2;n<t+i;++n)a[h++]=e[n]}a&&a.length!=h&&(a.length=h)}(i,0,i.length,r,e,t,n,i),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();!function(e,t,n,i,r,o,s){s=s||[];let a=0;for(let t=0;t<n;t+=i){s[a++]=e[t]+r,s[a++]=e[t+1]+o;for(let n=t+2;n<t+i;++n)s[a++]=e[n]}s&&s.length!=a&&(s.length=a)}(n,0,n.length,i,e,t,n),this.changed()}}};function _r(e,t,n,i,r,o,s){const a=e[t],l=e[t+1],c=e[n]-a,h=e[n+1]-l;let d;if(0===c&&0===h)d=t;else{const u=((r-a)*c+(o-l)*h)/(c*c+h*h);if(u>1)d=n;else{if(u>0){for(let r=0;r<i;++r)s[r]=$n(e[t+r],e[n+r],u);return void(s.length=i)}d=t}}for(let t=0;t<i;++t)s[t]=e[d+t];s.length=i}function xr(e,t,n,i,r){let o=e[t],s=e[t+1];for(t+=i;t<n;t+=i){const n=e[t],i=e[t+1],a=Xn(o,s,n,i);a>r&&(r=a),o=n,s=i}return r}function Cr(e,t,n,i,r,o,s,a,l,c,h){if(t==n)return c;let d,u;if(0===r){if(u=Xn(s,a,e[t],e[t+1]),u<c){for(d=0;d<i;++d)l[d]=e[t+d];return l.length=i,u}return c}h=h||[NaN,NaN];let p=t+i;for(;p<n;)if(_r(e,p-i,p,i,s,a,h),u=Xn(s,a,h[0],h[1]),u<c){for(c=u,d=0;d<i;++d)l[d]=h[d];l.length=i,p+=i}else p+=i*Math.max((Math.sqrt(u)-Math.sqrt(c))/r|0,1);if(o&&(_r(e,n-i,t,i,s,a,h),u=Xn(s,a,h[0],h[1]),u<c)){for(c=u,d=0;d<i;++d)l[d]=h[d];l.length=i}return c}function Er(e,t,n,i){for(let r=0,o=n.length;r<o;++r){const o=n[r];for(let n=0;n<i;++n)e[t++]=o[n]}return t}function Sr(e,t){return t*Math.round(e/t)}function Mr(e,t,n,i,r,o,s){if(t==n)return s;let a,l,c=Sr(e[t],r),h=Sr(e[t+1],r);t+=i,o[s++]=c,o[s++]=h;do{if(a=Sr(e[t],r),l=Sr(e[t+1],r),(t+=i)==n)return o[s++]=a,o[s++]=l,s}while(a==c&&l==h);for(;t<n;){const n=Sr(e[t],r),d=Sr(e[t+1],r);if(t+=i,n==a&&d==l)continue;const u=a-c,p=l-h,m=n-c,f=d-h;u*f==p*m&&(u<0&&m<u||u==m||u>0&&m>u)&&(p<0&&f<p||p==f||p>0&&f>p)?(a=n,l=d):(o[s++]=a,o[s++]=l,c=a,h=l,a=n,l=d)}return o[s++]=a,o[s++]=l,s}function Ir(e,t,n,i,r){r=void 0!==r?r:[];let o=0;for(let s=t;s<n;s+=i)r[o++]=e.slice(s,s+i);return r.length=o,r}function kr(e,t,n,i){let r=0,o=e[n-i],s=e[n-i+1];for(;t<n;t+=i){const n=e[t],i=e[t+1];r+=s*n-o*i,o=n,s=i}return r/2}class Tr extends wr{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}clone(){return new Tr(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,i){return i<En(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(xr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Cr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,i))}getArea(){return kr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=function(e,t,n,i,r,o,s){const a=(n-t)/i;if(a<3){for(;t<n;t+=i)o[s++]=e[t],o[s++]=e[t+1];return s}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[t,n-i];let h=0;for(;c.length>0;){const n=c.pop(),o=c.pop();let s=0;const a=e[o],d=e[o+1],u=e[n],p=e[n+1];for(let t=o+i;t<n;t+=i){const n=Yn(e[t],e[t+1],a,d,u,p);n>s&&(h=t,s=n)}s>r&&(l[(h-t)/i]=1,o+i<h&&c.push(o,h),h+i<n&&c.push(h,n))}for(let n=0;n<a;++n)l[n]&&(o[s++]=e[t+n*i],o[s++]=e[t+n*i+1]);return s}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Tr(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Er(this.flatCoordinates,0,e,this.stride),this.changed()}}const Nr=Tr;class Rr extends wr{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Rr(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){const r=this.flatCoordinates,o=Xn(e,t,r[0],r[1]);if(o<i){const e=this.stride;for(let t=0;t<e;++t)n[t]=r[t];return n.length=e,o}return i}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return function(e,t){const n=e[0],i=e[1];return Tn(n,i,n,i,t)}(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return In(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(e,t,n,i){for(let i=0,r=n.length;i<r;++i)e[t++]=n[i];return t}(this.flatCoordinates,0,e,this.stride),this.changed()}}const Ar=Rr;function Or(e,t,n,i,r){const o=function(e,t){let n;return n=t(Dn(e)),n||(n=t(Ln(e)),n||(n=t(Gn(e)),n||(n=t(Vn(e)),n||!1)))}(r,(function(r){return!Pr(e,t,n,i,r[0],r[1])}));return!o}function Pr(e,t,n,i,r,o){let s=0,a=e[n-i],l=e[n-i+1];for(;t<n;t+=i){const n=e[t],i=e[t+1];l<=o?i>o&&(n-a)*(o-l)-(r-a)*(i-l)>0&&s++:i<=o&&(n-a)*(o-l)-(r-a)*(i-l)<0&&s--,a=n,l=i}return 0!==s}function Dr(e,t,n,i,r,o){if(0===n.length)return!1;if(!Pr(e,t,n[0],i,r,o))return!1;for(let t=1,s=n.length;t<s;++t)if(Pr(e,n[t-1],n[t],i,r,o))return!1;return!0}function Lr(e,t,n,i,r){const o=On([1/0,1/0,-1/0,-1/0],e,t,n,i);return!!Wn(r,o)&&(!!Mn(r,o)||o[0]>=r[0]&&o[2]<=r[2]||o[1]>=r[1]&&o[3]<=r[3]||function(e,t,n,i,o){let s;for(t+=i;t<n;t+=i)if(a=e.slice(t-i,t),l=e.slice(t,t+i),s=function(e,t,n){let i=!1;const r=kn(e,t),o=kn(e,n);if(r===xn.INTERSECTING||o===xn.INTERSECTING)i=!0;else{const s=e[0],a=e[1],l=e[2],c=e[3],h=t[0],d=t[1],u=n[0],p=n[1],m=(p-d)/(u-h);let f,g;o&xn.ABOVE&&!(r&xn.ABOVE)&&(f=u-(p-c)/m,i=f>=s&&f<=l),i||!(o&xn.RIGHT)||r&xn.RIGHT||(g=p-(u-l)*m,i=g>=a&&g<=c),i||!(o&xn.BELOW)||r&xn.BELOW||(f=u-(p-a)/m,i=f>=s&&f<=l),i||!(o&xn.LEFT)||r&xn.LEFT||(g=p-(u-s)*m,i=g>=a&&g<=c)}return i}(r,a,l),s)return s;var a,l;return!1}(e,t,n,i))}function Br(e,t,n,i){for(;t<n-i;){for(let r=0;r<i;++r){const o=e[t+r];e[t+r]=e[n-i+r],e[n-i+r]=o}t+=i,n-=i}}function Zr(e,t,n,i){let r=0,o=e[n-i],s=e[n-i+1];for(;t<n;t+=i){const n=e[t],i=e[t+1];r+=(n-o)*(i+s),o=n,s=i}return 0===r?void 0:r>0}function zr(e,t,n,i,r){r=void 0!==r&&r;for(let o=0,s=n.length;o<s;++o){const s=n[o],a=Zr(e,t,s,i);(0===o?r&&a||!r&&!a:r&&!a||!r&&a)&&Br(e,t,s,i),t=s}return t}class Fr extends wr{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==t&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?function(e,t){const n=Array.isArray(t)?t:[t],i=n.length;for(let t=0;t<i;t++)e[e.length]=n[t]}(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Fr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,i){return i<En(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(e,t,n,i,r){for(let o=0,s=n.length;o<s;++o){const s=n[o];r=xr(e,t,s,i,r),t=s}return r}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(e,t,n,i,r,o,s,a,l,c,h){h=h||[NaN,NaN];for(let d=0,u=n.length;d<u;++d){const u=n[d];c=Cr(e,t,u,i,r,o,s,a,l,c,h),t=u}return c}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,i))}containsXY(e,t){return Dr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return function(e,t,n,i){let r=0;for(let o=0,s=n.length;o<s;++o){const s=n[o];r+=kr(e,t,s,i),t=s}return r}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),zr(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,function(e,t,n,i,r){r=void 0!==r?r:[];let o=0;for(let s=0,a=n.length;s<a;++s){const a=n[s];r[o++]=Ir(e,t,a,i,r[o]),t=a}return r.length=o,r}(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Bn(this.getExtent());this.flatInteriorPoint_=function(e,t,n,i,r,o,s){let a,l,c,h,d,u,p;const m=r[o+1],f=[];for(let r=0,o=n.length;r<o;++r){const o=n[r];for(h=e[o-i],u=e[o-i+1],a=t;a<o;a+=i)d=e[a],p=e[a+1],(m<=u&&p<=m||u<=m&&m<=p)&&(c=(m-u)/(p-u)*(d-h)+h,f.push(c)),h=d,u=p}let g=NaN,y=-1/0;for(f.sort(kt),h=f[0],a=1,l=f.length;a<l;++a){d=f[a];const r=Math.abs(d-h);r>y&&(c=(h+d)/2,Dr(e,t,n,i,c,m)&&(g=c,y=r)),h=d}return isNaN(g)&&(g=r[o]),s?(s.push(g,m,y),s):[g,m,y]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ar(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Nr(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,i=[];let r=0;for(let o=0,s=n.length;o<s;++o){const s=n[o],a=new Nr(t.slice(r,s),e);i.push(a),r=s}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;!function(e,t,n,i,r){r=void 0!==r&&r;for(let o=0,s=n.length;o<s;++o){const s=n[o],a=Zr(e,t,s,i);if(0===o){if(r&&a||!r&&!a)return!1}else if(r&&!a||!r&&a)return!1;t=s}return!0}(e,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=zr(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=e,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=function(e,t,n,i,r,o,s,a){for(let l=0,c=n.length;l<c;++l){const c=n[l];s=Mr(e,t,c,i,r,o,s),a.push(s),t=c}return s}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Fr(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return function(e,t,n,i,r){if(!function(e,t,n,i,r){return!!(Lr(e,t,n,i,r)||Pr(e,t,n,i,r[0],r[1])||Pr(e,t,n,i,r[0],r[3])||Pr(e,t,n,i,r[2],r[1])||Pr(e,t,n,i,r[2],r[3]))}(e,t,n[0],i,r))return!1;if(1===n.length)return!0;for(let t=1,o=n.length;t<o;++t)if(Or(e,n[t-1],n[t],i,r)&&!Lr(e,n[t-1],n[t],i,r))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=function(e,t,n,i,r){r=r||[];let o=0;for(let s=0,a=n.length;s<a;++s){const a=Er(e,t,n[s],i);r[o++]=a,t=a}return r.length=o,r}(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}const Vr=Fr;function Gr(e){const t=e[0],n=e[1],i=e[2],r=e[3],o=[t,n,t,r,i,r,i,n,t,n];return new Fr(o,"XY",[o.length])}function jr(e,t){setTimeout((function(){e(t)}),0)}function Wr(e){return!(e.sourceCenter&&e.targetCenter&&!Pi(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function Hr(e,t,n,i,r){const o=Math.cos(-r);let s=Math.sin(-r),a=e[0]*o-e[1]*s,l=e[1]*o+e[0]*s;return a+=(t[0]/2-n[0])*i,l+=(n[1]-t[1]/2)*i,s=-s,[a*o-l*s,l*o+a*s]}const Ur=class extends qt{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Xi(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&function(e){Vi=!(void 0===e||e)}(),e.center&&(e.center=nr(e.center,this.projection_)),e.extent&&(e.extent=ir(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const e in yi)delete t[e];this.setProperties(t,!0);const n=function(e){let t,n,i;let r=void 0!==e.minZoom?e.minZoom:0,o=void 0!==e.maxZoom?e.maxZoom:28;const s=void 0!==e.zoomFactor?e.zoomFactor:2,a=void 0!==e.multiWorld&&e.multiWorld,l=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,c=void 0!==e.showFullExtent&&e.showFullExtent,h=Xi(e.projection,"EPSG:3857"),d=h.getExtent();let u=e.constrainOnlyCenter,p=e.extent;if(a||p||!h.isGlobal()||(u=!1,p=d),void 0!==e.resolutions){const s=e.resolutions;n=s[r],i=void 0!==s[o]?s[o]:s[s.length-1],t=e.constrainResolution?function(e,t,n,i){return t=void 0===t||t,function(r,o,s,a){if(void 0!==r){const l=e[0],c=e[e.length-1],h=n?cr(l,n,s,i):l;if(a)return t?hr(r,h,c):Un(r,c,h);const d=Math.min(h,r),u=Math.floor(Tt(e,d,o));return e[u]>h&&u<e.length-1?e[u+1]:e[u]}}}(s,l,!u&&p,c):dr(n,i,l,!u&&p,c)}else{const a=(d?Math.max(jn(d),zn(d)):360*vi.degrees/h.getMetersPerUnit())/256/Math.pow(2,0),m=a/Math.pow(2,28);n=e.maxResolution,void 0!==n?r=0:n=a/Math.pow(s,r),i=e.minResolution,void 0===i&&(i=void 0!==e.maxZoom?void 0!==e.maxResolution?n/Math.pow(s,o):a/Math.pow(s,o):m),o=r+Math.floor(Math.log(n/i)/Math.log(s)),i=n/Math.pow(s,o-r),t=e.constrainResolution?function(e,t,n,i,r,o){return i=void 0===i||i,n=void 0!==n?n:0,function(s,a,l,c){if(void 0!==s){const h=r?cr(t,r,l,o):t;if(c)return i?hr(s,h,n):Un(s,n,h);const d=1e-9,u=Math.ceil(Math.log(t/h)/Math.log(e)-d),p=-a*(.5-d)+.5,m=Math.min(h,s),f=Math.floor(Math.log(t/m)/Math.log(e)+p),g=Math.max(u,f);return Un(t/Math.pow(e,g),n,h)}}}(s,n,i,l,!u&&p,c):dr(n,i,l,!u&&p,c)}return{constraint:t,maxResolution:n,minResolution:i,minZoom:r,zoomFactor:s}}(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const i=function(e){if(void 0!==e.extent){const t=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return ar(e.extent,e.constrainOnlyCenter,t)}const t=Xi(e.projection,"EPSG:3857");if(!0!==e.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,ar(e,!1,!1)}return lr}(e),r=n.constraint,o=function(e){if(void 0===e.enableRotation||e.enableRotation){const n=e.constrainRotation;return void 0===n||!0===n?(t=t||Jn(5),function(e,n){return n?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}):!1===n?pr:"number"==typeof n?function(e){const t=2*Math.PI/e;return function(e,n){return n?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(n):pr}var t;return ur}(e);this.constraints_={center:i,resolution:r,rotation:o},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const i=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(i[3]-t[3]+t[1]-i[1]),s=r/2*(i[0]-t[0]+t[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-s])}}getUpdatedOptions_(e){const t=this.getProperties();return void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let e=0;e<t.length;++e){let n=arguments[e];n.center&&(n=Object.assign({},n),n.center=nr(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=nr(n.anchor,this.getProjection())),t[e]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t,n=arguments.length;n>1&&"function"==typeof arguments[n-1]&&(t=arguments[n-1],--n);let i=0;for(;i<n&&!this.isDef();++i){const e=arguments[i];e.center&&this.setCenterInternal(e.center),void 0!==e.zoom?this.setZoom(e.zoom):e.resolution&&this.setResolution(e.resolution),void 0!==e.rotation&&this.setRotation(e.rotation)}if(i===n)return void(t&&jr(t,!0));let r=Date.now(),o=this.targetCenter_.slice(),s=this.targetResolution_,a=this.targetRotation_;const l=[];for(;i<n;++i){const e=arguments[i],n={start:r,complete:!1,anchor:e.anchor,duration:void 0!==e.duration?e.duration:1e3,easing:e.easing||fr,callback:t};if(e.center&&(n.sourceCenter=o,n.targetCenter=e.center.slice(),o=n.targetCenter),void 0!==e.zoom?(n.sourceResolution=s,n.targetResolution=this.getResolutionForZoom(e.zoom),s=n.targetResolution):e.resolution&&(n.sourceResolution=s,n.targetResolution=e.resolution,s=n.targetResolution),void 0!==e.rotation){n.sourceRotation=a;const t=Kn(e.rotation-a+Math.PI,2*Math.PI)-Math.PI;n.targetRotation=a+t,a=n.targetRotation}Wr(n)?n.complete=!0:r+=n.duration,l.push(n)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let e;this.setHint(0,-this.hints_[0]);for(let t=0,n=this.animations_.length;t<n;++t){const n=this.animations_[t];if(n[0].callback&&jr(n[0].callback,!1),!e)for(let t=0,i=n.length;t<i;++t){const i=n[t];if(!i.complete){e=i.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let r=!0;for(let n=0,o=i.length;n<o;++n){const o=i[n];if(o.complete)continue;const s=e-o.start;let a=o.duration>0?s/o.duration:1;a>=1?(o.complete=!0,a=1):r=!1;const l=o.easing(a);if(o.sourceCenter){const e=o.sourceCenter[0],t=o.sourceCenter[1],n=o.targetCenter[0],i=o.targetCenter[1];this.nextCenter_=o.targetCenter;const r=e+l*(n-e),s=t+l*(i-t);this.targetCenter_=[r,s]}if(o.sourceResolution&&o.targetResolution){const e=1===l?o.targetResolution:o.sourceResolution+l*(o.targetResolution-o.sourceResolution);if(o.anchor){const t=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(e,0,t,!0);this.targetCenter_=this.calculateCenterZoom(n,o.anchor)}this.nextResolution_=o.targetResolution,this.targetResolution_=e,this.applyTargetState_(!0)}if(void 0!==o.sourceRotation&&void 0!==o.targetRotation){const e=1===l?Kn(o.targetRotation+Math.PI,2*Math.PI)-Math.PI:o.sourceRotation+l*(o.targetRotation-o.sourceRotation);if(o.anchor){const t=this.constraints_.rotation(e,!0);this.targetCenter_=this.calculateCenterRotate(t,o.anchor)}this.nextRotation_=o.targetRotation,this.targetRotation_=e}if(this.applyTargetState_(!0),t=!0,!o.complete)break}if(r){this.animations_[n]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const e=i[0].callback;e&&jr(e,!0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const i=this.getCenterInternal();var r,o;return void 0!==i&&(n=[i[0]-t[0],i[1]-t[1]],Di(n,e-this.getRotation()),o=t,(r=n)[0]+=+o[0],r[1]+=+o[1]),n}calculateCenterZoom(e,t){let n;const i=this.getCenterInternal(),r=this.getResolution();return void 0!==i&&void 0!==r&&(n=[t[0]-e*(t[0]-i[0])/r,t[1]-e*(t[1]-i[1])/r]),n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],i=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(i*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(i*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e?tr(e,this.getProjection()):e}getCenterInternal(){return this.get(yi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){return t=this.calculateExtentInternal(e),this.getProjection(),t;var t}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();gn(t,1);const n=this.getResolution();gn(void 0!==n,2);const i=this.getRotation();return gn(void 0!==i,3),Zn(t,n,i,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(yi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ir(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=jn(e)/t[0],i=zn(e)/t[1];return Math.max(n,i)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(t/n)/Math.log(e);return function(n){return t/Math.pow(e,n*i)}}getRotation(){return this.get(yi.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(n/i)/t;return function(e){return Math.log(n/e)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const r=this.padding_;if(r){const e=this.getViewportSizeMinusPadding_();i=Hr(i,this.getViewportSize_(),[e[0]/2+r[3],e[1]/2+r[0]],t,n)}return{center:i.slice(0),projection:void 0!==e?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t,n,i=this.minZoom_||0;if(this.resolutions_){const r=Tt(this.resolutions_,e,1);i=r,t=this.resolutions_[r],n=r==this.resolutions_.length-1?2:t/this.resolutions_[r+1]}else t=this.maxResolution_,n=this.zoomFactor_;return i+Math.log(t/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=Un(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,Un(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(gn(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,24),Array.isArray(e))gn(!Hn(e),25),n=Gr(ir(e,this.getProjection()));else if("Circle"===e.getType()){const t=ir(e.getExtent(),this.getProjection());n=Gr(t),n.rotate(this.getRotation(),Bn(t))}else{const t=er();n=t?e.clone().transform(t,this.getProjection()):e}this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),i=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let s=1/0,a=1/0,l=-1/0,c=-1/0;for(let e=0,t=r.length;e<t;e+=o){const t=r[e]*n-r[e+1]*i,o=r[e]*i+r[e+1]*n;s=Math.min(s,t),a=Math.min(a,o),l=Math.max(l,t),c=Math.max(c,o)}return[s,a,l,c]}fitInternal(e,t){let n=(t=t||{}).size;n||(n=this.getViewportSizeMinusPadding_());const i=void 0!==t.padding?t.padding:[0,0,0,0],r=void 0!==t.nearest&&t.nearest;let o;o=void 0!==t.minResolution?t.minResolution:void 0!==t.maxZoom?this.getResolutionForZoom(t.maxZoom):0;const s=this.rotatedExtentForGeometry(e);let a=this.getResolutionForExtentInternal(s,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);a=isNaN(a)?o:Math.max(a,o),a=this.getConstrainedResolution(a,r?0:1);const l=this.getRotation(),c=Math.sin(l),h=Math.cos(l),d=Bn(s);d[0]+=(i[1]-i[3])/2*a,d[1]+=(i[0]-i[2])/2*a;const u=d[0]*h-d[1]*c,p=d[1]*h+d[0]*c,m=this.getConstrainedCenter([u,p],a),f=t.callback?t.callback:Ot;void 0!==t.duration?this.animateInternal({resolution:a,center:m,duration:t.duration,easing:t.easing},f):(this.targetResolution_=a,this.targetCenter_=m,this.applyTargetState_(!1,!0),jr(f,!0))}centerOn(e,t,n){this.centerOnInternal(nr(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(Hr(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,i){let r;const o=this.padding_;if(o&&e){const s=this.getViewportSizeMinusPadding_(-n),a=Hr(e,i,[s[0]/2+o[3],s[1]/2+o[0]],t,n);r=[e[0]-a[0],e[1]-a[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(e){const t=tr(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&nr(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,i,n);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=nr(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(i,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e?nr(e,this.getProjection()):e)}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,i=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,r,n),s=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,i,r));this.get(yi.ROTATION)!==i&&this.set(yi.ROTATION,i),this.get(yi.RESOLUTION)!==o&&(this.set(yi.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),s&&this.get(yi.CENTER)&&Pi(this.get(yi.CENTER),s)||this.set(yi.CENTER,s),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=void 0!==e?e:200;const i=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),s=this.constraints_.resolution(this.targetResolution_,i,o),a=this.constraints_.center(this.targetCenter_,s,o,!1,this.calculateCenterShift(this.targetCenter_,s,r,o));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=s,this.targetRotation_=r,this.targetCenter_=a,void this.applyTargetState_();n=n||(0===e?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===r&&this.getCenterInternal()&&Pi(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:a,resolution:s,duration:e,easing:mr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(e,t,n){n=n&&nr(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}};function Yr(e,t){if(!e.visible)return!1;const n=t.resolution;if(n<e.minResolution||n>=e.maxResolution)return!1;const i=t.zoom;return i>e.minZoom&&i<=e.maxZoom}const Xr=class extends mi{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(pi,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return(e=e||[]).push(this),e}getLayerStatesArray(e){return(e=e||[]).push(this.getLayerState()),e}getSource(){return this.get(pi)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Ht(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=jt(e,Lt,this.handleSourceChange_,this),"ready"===e.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null}isVisible(e){let t;const n=this.getMapInternal();let i;!e&&n&&(e=n.getView()),t=e instanceof Ur?{viewState:e.getState(),extent:e.calculateExtent()}:e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray()),i=t.layerStatesArray?t.layerStatesArray.find((e=>e.layer===this)):this.getLayerState();const r=this.getExtent();return Yr(i,t.viewState)&&(!r||Wn(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];let i=t(e instanceof Ur?e.getViewStateAndExtent():e);return Array.isArray(i)||(i=[i]),i}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set("map",e)}getMapInternal(){return this.get("map")}setMap(e){this.mapPrecomposeKey_&&(Ht(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Ht(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=jt(e,fi,(function(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);gn(!t.some((function(e){return e.layer===n.layer})),67),t.push(n)}),this),this.mapRenderKey_=jt(this,Lt,e.render,e),this.changed())}setSource(e){this.set(pi,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function Jr(e,t){ri.expire()}const Kr=class extends It{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Xt()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,i=e.pixelToCoordinateTransform;vn(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),bn(i,n)}forEachFeatureAtCoordinate(e,t,n,i,r,o,s,a){let l;const c=t.viewState;function h(e,t,n,i){return r.call(o,t,e?n:null,i)}const d=c.projection,u=function(e,t){if(t.canWrapX()){const n=jn(t.getExtent()),i=function(e,t,n){const i=t.getExtent();let r=0;return t.canWrapX()&&(e[0]<i[0]||e[0]>i[2])&&(n=n||jn(i),r=Math.floor((e[0]-i[0])/n)),r}(e,t,n);i&&(e[0]-=i*n)}return e}(e.slice(),d),p=[[0,0]];if(d.canWrapX()&&i){const e=jn(d.getExtent());p.push([-e,0],[e,0])}const m=t.layerStatesArray,f=m.length,g=[],y=[];for(let i=0;i<p.length;i++)for(let r=f-1;r>=0;--r){const o=m[r],d=o.layer;if(d.hasRenderer()&&Yr(o,c)&&s.call(a,d)){const r=d.getRenderer(),s=d.getSource();if(r&&s){const a=s.getWrapX()?u:e,c=h.bind(null,o.managed);y[0]=a[0]+p[i][0],y[1]=a[1]+p[i][1],l=r.forEachFeatureAtCoordinate(y,t,n,c,g)}if(l)return l}}if(0===g.length)return;const v=1/g.length;return g.forEach(((e,t)=>e.distanceSq+=t*v)),g.sort(((e,t)=>e.distanceSq-t.distanceSq)),g.some((e=>l=e.callback(e.feature,e.layer,e.geometry))),l}hasFeatureAtCoordinate(e,t,n,i,r,o){return void 0!==this.forEachFeatureAtCoordinate(e,t,n,i,Rt,this,r,o)}getMap(){return this.map_}renderFrame(e){Xt()}scheduleExpireIconCache(e){ri.canExpireCache()&&e.postRenderFunctions.push(Jr)}},$r=class extends St{constructor(e,t,n,i){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=i}},qr="ol-hidden",Qr="ol-unselectable",eo="ol-control",to="ol-collapsed";new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i");function no(e,t,n,i){let r;return r=n&&n.length?n.shift():pn?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(r.width=e),t&&(r.height=t),r.getContext("2d",i)}function io(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function ro(e){let t=e.offsetWidth;const n=getComputedStyle(e);return t+=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10),t}function oo(e){let t=e.offsetHeight;const n=getComputedStyle(e);return t+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10),t}function so(e,t){const n=t.parentNode;n&&n.replaceChild(e,t)}function ao(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function lo(e){for(;e.lastChild;)e.removeChild(e.lastChild)}const co=new qt;!function(){const e=["monospace","serif"];e.length}();const ho=class extends Kr{constructor(e){super(e),this.fontChangeListenerKey_=jt(co,Mt,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Qr+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const i=new $r(e,void 0,t);n.dispatchEvent(i)}}disposeInternal(){Ht(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(fi,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),n=e.viewState;this.children_.length=0;const i=[];let r=null;for(let o=0,s=t.length;o<s;++o){const s=t[o];e.layerIndex=o;const a=s.layer,l=a.getSourceState();if(!Yr(s,n)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const c=a.render(e,r);c&&(c!==r&&(this.children_.push(c),r=c),"getDeclutter"in a&&i.push(a))}for(let t=i.length-1;t>=0;--t)i[t].renderDeclutter(e);!function(e,t){const n=e.childNodes;for(let i=0;;++i){const r=n[i],o=t[i];if(!r&&!o)break;r!==o&&(r?o?e.insertBefore(o,r):(e.removeChild(r),--i):e.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}};class uo extends St{constructor(e,t){super(e),this.layer=t}}const po="layers";class mo extends mi{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(po,this.handleLayersChanged_),n?Array.isArray(n)?n=new an(n.slice(),{unique:!0}):gn("function"==typeof n.getArray,43):n=new an(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Ht),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(jt(e,nn,this.handleLayersAdd_,this),jt(e,rn,this.handleLayersRemove_,this));for(const e in this.listenerKeys_)this.listenerKeys_[e].forEach(Ht);Pt(this.listenerKeys_);const t=e.getArray();for(let e=0,n=t.length;e<n;e++){const n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new uo("addlayer",n))}this.changed()}registerLayerListeners_(e){const t=[jt(e,Mt,this.handleLayerChange_,this),jt(e,Lt,this.handleLayerChange_,this)];e instanceof mo&&t.push(jt(e,"addlayer",this.handleLayerGroupAdd_,this),jt(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Kt(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new uo("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new uo("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new uo("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=Kt(t);this.listenerKeys_[n].forEach(Ht),delete this.listenerKeys_[n],this.dispatchEvent(new uo("removelayer",t)),this.changed()}getLayers(){return this.get(po)}setLayers(e){const t=this.getLayers();if(t){const e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new uo("removelayer",e[t]))}this.set(po,e)}getLayersArray(e){return e=void 0!==e?e:[],this.getLayers().forEach((function(t){t.getLayersArray(e)})),e}getLayerStatesArray(e){const t=void 0!==e?e:[],n=t.length;this.getLayers().forEach((function(e){e.getLayerStatesArray(t)}));const i=this.getLayerState();let r=i.zIndex;e||void 0!==i.zIndex||(r=0);for(let e=n,o=t.length;e<o;e++){const n=t[e];n.opacity*=i.opacity,n.visible=n.visible&&i.visible,n.maxResolution=Math.min(n.maxResolution,i.maxResolution),n.minResolution=Math.max(n.minResolution,i.minResolution),n.minZoom=Math.max(n.minZoom,i.minZoom),n.maxZoom=Math.min(n.maxZoom,i.maxZoom),void 0!==i.extent&&(void 0!==n.extent?n.extent=Fn(n.extent,i.extent):n.extent=i.extent),void 0===n.zIndex&&(n.zIndex=r)}return t}getSourceState(){return"ready"}}const fo=mo,go=class extends St{constructor(e,t,n){super(e),this.map=t,this.frameState=void 0!==n?n:null}},yo=class extends go{constructor(e,t,n,i,r,o){super(e,t,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==i&&i,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},vo={SINGLECLICK:"singleclick",CLICK:Zt,DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},bo="pointerdown",wo=class extends Dt{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===t?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=jt(n,bo,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=jt(n,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Vt,this.boundHandleTouchMove_,!!fn&&{passive:!1})}emulateClick_(e){let t=new yo(vo.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new yo(vo.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const t=new yo(vo.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}),250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==vo.POINTERUP||t.type==vo.POINTERCANCEL){delete this.trackedTouches_[n];for(const e in this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}else t.type!=vo.POINTERDOWN&&t.type!=vo.POINTERMOVE||(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new yo(vo.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(Ht),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return 0===e.button}handlePointerDown_(e){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(e);const t=new yo(vo.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),0===this.dragListenerKeys_.length){const e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(jt(e,vo.POINTERMOVE,this.handlePointerMove_,this),jt(e,vo.POINTERUP,this.handlePointerUp_,this),jt(this.element_,vo.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(jt(this.element_.getRootNode(),vo.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new yo(vo.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new yo(vo.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||"boolean"==typeof e.cancelable&&!0!==e.cancelable||e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Ht(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Vt,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Ht(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Ht),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},_o="postrender",xo="loadstart",Co="loadend",Eo="layergroup",So="size",Mo="target",Io="view",ko=1/0,To=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Pt(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(e){gn(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=ko&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return 0===this.elements_.length}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,i=t.length,r=t[e],o=n[e],s=e;for(;e<i>>1;){const r=this.getLeftChildIndex_(e),o=this.getRightChildIndex_(e),s=o<i&&n[o]<n[r]?o:r;t[e]=t[s],n[e]=n[s],e=s}t[e]=r,n[e]=o,this.siftDown_(s,e)}siftDown_(e,t){const n=this.elements_,i=this.priorities_,r=n[t],o=i[t];for(;t>e;){const e=this.getParentIndex_(t);if(!(i[e]>o))break;n[t]=n[e],i[t]=i[e],t=e}n[t]=r,i[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let i=0;const r=t.length;let o,s,a;for(s=0;s<r;++s)o=t[s],a=e(o),a==ko?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=a,t[i++]=o);t.length=i,n.length=i,this.heapify_()}},No=class extends To{constructor(e,t){super((function(t){return e.apply(null,t)}),(function(e){return e[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Lt,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(2===n||3===n||4===n){3!==n&&t.removeEventListener(Lt,this.boundHandleTileChange_);const e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n,i,r,o=0;for(;this.tilesLoading_<e&&o<t&&this.getCount()>0;)i=this.dequeue()[0],r=i.getKey(),n=i.getState(),0!==n||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++o,i.load())}},Ro=class extends qt{constructor(e){super();const t=e.element;!t||e.target||t.style.pointerEvents||(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){ao(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&ao(this.element);for(let e=0,t=this.listenerKeys.length;e<t;++e)Ht(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ot&&this.listenerKeys.push(jt(e,_o,this.render,this)),e.render())}render(e){}setTarget(e){this.target_="string"==typeof e?document.getElementById(e):e}},Ao=class extends Ro{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1);const t=void 0!==e.className?e.className:"ol-attribution",n=void 0!==e.tipLabel?e.tipLabel:"Attributions",i=void 0!==e.expandClassName?e.expandClassName:t+"-expand",r=void 0!==e.collapseLabel?e.collapseLabel:"›",o=void 0!==e.collapseClassName?e.collapseClassName:t+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const s=void 0!==e.label?e.label:"i";"string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s,this.label_.className=i):this.label_=s;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(Zt,this.handleClick_.bind(this),!1);const l=t+" "+Qr+" "+eo+(this.collapsed_&&this.collapsible_?" "+to:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=l,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap((t=>t.getAttributions(e))))),n=!this.getMap().getAllLayers().some((e=>e.getSource()&&!1===e.getSource().getAttributionsCollapsible()));return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Nt(t,this.renderedAttributions_)){lo(this.ulElement_);for(let e=0,n=t.length;e<n;++e){const n=document.createElement("li");n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(to),this.collapsed_?so(this.collapseLabel_,this.label_):so(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},Oo=class extends Ro{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=void 0!==e.className?e.className:"ol-rotate",n=void 0!==e.label?e.label:"⇧",i=void 0!==e.compassClassName?e.compassClassName:"ol-compass";this.label_=null,"string"==typeof n?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(Zt,this.handleClick_.bind(this),!1);const s=t+" "+Qr+" "+eo,a=this.element;a.className=s,a.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=void 0!==e.duration?e.duration:250,this.autoHide_=void 0===e.autoHide||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(qr)}handleClick_(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();void 0!==t&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:mr}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const e="rotate("+n+"rad)";if(this.autoHide_){const e=this.element.classList.contains(qr);e||0!==n?e&&0!==n&&this.element.classList.remove(qr):this.element.classList.add(qr)}this.label_.style.transform=e}this.rotation_=n}},Po=class extends Ro{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=void 0!==e.className?e.className:"ol-zoom",n=void 0!==e.delta?e.delta:1,i=void 0!==e.zoomInClassName?e.zoomInClassName:t+"-in",r=void 0!==e.zoomOutClassName?e.zoomOutClassName:t+"-out",o=void 0!==e.zoomInLabel?e.zoomInLabel:"+",s=void 0!==e.zoomOutLabel?e.zoomOutLabel:"–",a=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",l=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=i,c.setAttribute("type","button"),c.title=a,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener(Zt,this.handleClick_.bind(this,n),!1);const h=document.createElement("button");h.className=r,h.setAttribute("type","button"),h.title=l,h.appendChild("string"==typeof s?document.createTextNode(s):s),h.addEventListener(Zt,this.handleClick_.bind(this,-n),!1);const d=t+" "+Qr+" "+eo,u=this.element;u.className=d,u.appendChild(c),u.appendChild(h),this.duration_=void 0!==e.duration?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const n=t.getZoom();if(void 0!==n){const i=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:i,duration:this.duration_,easing:mr})):t.setZoom(i)}}},Do="active";function Lo(e,t,n,i){const r=e.getZoom();if(void 0===r)return;const o=e.getConstrainedZoom(r+t),s=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:n,duration:void 0!==i?i:250,easing:mr})}const Bo=class extends qt{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Do)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Do,e)}setMap(e){this.map_=e}},Zo=class extends Bo{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:250}handleEvent(e){let t=!1;if(e.type==vo.DBLCLICK){const n=e.originalEvent,i=e.map,r=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_;Lo(i.getView(),o,r,this.duration_),n.preventDefault(),t=!0}return!t}};function zo(e){const t=e.length;let n=0,i=0;for(let r=0;r<t;r++)n+=e[r].clientX,i+=e[r].clientY;return{clientX:n/t,clientY:i/t}}const Fo=class extends Bo{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==vo.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==vo.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==vo.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==vo.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function Vo(e){const t=arguments;return function(e){let n=!0;for(let i=0,r=t.length;i<r&&(n=n&&t[i](e),n);++i);return n}}const Go=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},jo=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||function(e){const t=e.map.getTargetElement(),n=e.map.getOwnerDocument().activeElement;return t.contains(n)}(e)},Wo=Rt,Ho=function(e){const t=e.originalEvent;return 0==t.button&&!(hn&&dn&&t.ctrlKey)},Uo=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Yo=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Xo=function(e){const t=e.originalEvent,n=t.target.tagName;return"INPUT"!==n&&"SELECT"!==n&&"TEXTAREA"!==n&&!t.target.isContentEditable},Jo=function(e){const t=e.originalEvent;return gn(void 0!==t,56),"mouse"==t.pointerType},Ko=function(e){const t=e.originalEvent;return gn(void 0!==t,56),t.isPrimary&&0===t.button},$o=class extends Fo{constructor(e){super({stopDown:At}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Vo(Uo,Ko);this.condition_=e.onFocusOnly?Vo(jo,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,i=t.getEventPixel(zo(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const t=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],n=e.map.getView();r=t,o=n.getResolution(),r[0]*=o,r[1]*=o,Di(t,n.getRotation()),n.adjustCenterInternal(t)}}else this.kinetic_&&this.kinetic_.begin();var r,o;this.lastCentroid=i,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),r=n.getCenterInternal(),o=t.getPixelFromCoordinateInternal(r),s=t.getCoordinateFromPixelInternal([o[0]-e*Math.cos(i),o[1]-e*Math.sin(i)]);n.animateInternal({center:n.getConstrainedCenter(s),duration:500,easing:mr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},qo=class extends Fo{constructor(e){e=e||{},super({stopDown:At}),this.condition_=e.condition?e.condition:Go,this.lastAngle_=void 0,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){if(!Jo(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===ur)return;const i=t.getSize(),r=e.pixel,o=Math.atan2(i[1]/2-r[1],r[0]-i[0]/2);if(void 0!==this.lastAngle_){const e=o-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=o}handleUpEvent(e){return!Jo(e)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){return!!Jo(e)&&(!(!Ho(e)||!this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}},Qo=class extends It{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(e[0],t[0])+n,i.top=Math.min(e[1],t[1])+n,i.width=Math.abs(t[0]-e[0])+n,i.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Vr([n])}getGeometry(){return this.geometry_}};class es extends St{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}const ts=class extends Fo{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Qo(e.className||"ol-dragbox"),this.minArea_=void 0!==e.minArea?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:Ho,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const i=n[0]-t[0],r=n[1]-t[1];return i*i+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new es("boxdrag",e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new es(t?"boxend":"boxcancel",e.coordinate,e)),!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new es("boxstart",e.coordinate,e)),!0)}onBoxEnd(e){}},ns=class extends ts{constructor(e){super({condition:(e=e||{}).condition?e.condition:Yo,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=void 0!==e.duration?e.duration:200,this.out_=void 0!==e.out&&e.out}onBoxEnd(e){const t=this.getMap().getView();let n=this.getGeometry();if(this.out_){const e=t.rotatedExtentForGeometry(n),i=t.getResolutionForExtentInternal(e),r=t.getResolution()/i;n=n.clone(),n.scale(r*r)}t.fitInternal(n,{duration:this.duration_,easing:mr})}},is="ArrowLeft",rs="ArrowRight",ss="ArrowDown",as=class extends Bo{constructor(e){super(),e=e||{},this.defaultCondition_=function(e){return Uo(e)&&Xo(e)},this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_,this.duration_=void 0!==e.duration?e.duration:100,this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==zt){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&(i==ss||i==is||i==rs||"ArrowUp"==i)){const r=e.map.getView(),o=r.getResolution()*this.pixelDelta_;let s=0,a=0;i==ss?a=-o:i==is?s=-o:i==rs?s=o:a=o;const l=[s,a];Di(l,r.getRotation()),function(e,t,n){const i=e.getCenterInternal();if(i){const r=[i[0]+t[0],i[1]+t[1]];e.animateInternal({duration:void 0!==n?n:250,easing:gr,center:e.getConstrainedCenter(r)})}}(r,l,this.duration_),n.preventDefault(),t=!0}}return!t}},ls=class extends Bo{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:Xo,this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:100}handleEvent(e){let t=!1;if(e.type==zt||e.type==Ft){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&("+"===i||"-"===i)){const r=e.map,o="+"===i?this.delta_:-this.delta_;Lo(r.getView(),o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}},cs=class extends Bo{constructor(e){super(e=e||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==e.maxDelta?e.maxDelta:1,this.duration_=void 0!==e.duration?e.duration:250,this.timeout_=void 0!==e.timeout?e.timeout:80,this.useAnchor_=void 0===e.useAnchor||e.useAnchor,this.constrainResolution_=void 0!==e.constrainResolution&&e.constrainResolution;const t=e.condition?e.condition:Wo;this.condition_=e.onFocusOnly?Vo(jo,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e))return!0;if(e.type!==Gt)return!0;const t=e.map,n=e.originalEvent;let i;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==Gt&&(i=n.deltaY,cn&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=un),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)),0===i)return!1;this.lastDelta_=i;const r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(i)<4?"trackpad":"wheel");const o=t.getView();if("trackpad"===this.mode_&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-i/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=i;const s=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),s),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-Un(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Lo(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},hs=class extends Fo{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=At),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==e.threshold?e.threshold:.3,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],i=this.targetPointers[1],r=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(void 0!==this.lastAngle_){const e=r-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=r;const o=e.map,s=o.getView();s.getConstraints().rotation!==ur&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(zo(this.targetPointers))),this.rotating_&&(o.render(),s.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},ds=class extends Fo{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=At),super(t),this.anchor_=null,this.duration_=void 0!==e.duration?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],i=this.targetPointers[1],r=n.clientX-i.clientX,o=n.clientY-i.clientY,s=Math.sqrt(r*r+o*o);void 0!==this.lastDistance_&&(t=this.lastDistance_/s),this.lastDistance_=s;const a=e.map,l=a.getView();1!=t&&(this.lastScaleDelta_=t),this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(zo(this.targetPointers))),a.render(),l.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}};function us(e){return e[0]>0&&e[1]>0}function ps(e){e instanceof Xr?e.setMapInternal(null):e instanceof fo&&e.getLayers().forEach(ps)}function ms(e,t){if(e instanceof Xr)e.setMapInternal(t);else if(e instanceof fo){const n=e.getLayers().getArray();for(let e=0,i=n.length;e<i;++e)ms(n[e],t)}}const fs=class extends qt{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=function(e){let t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const n={},i=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new fo({layers:e.layers});let r,o,s;return n[Eo]=i,n[Mo]=e.target,n[Io]=e.view instanceof Ur?e.view:new Ur,void 0!==e.controls&&(Array.isArray(e.controls)?r=new an(e.controls.slice()):(gn("function"==typeof e.controls.getArray,47),r=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?o=new an(e.interactions.slice()):(gn("function"==typeof e.interactions.getArray,48),o=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?s=new an(e.overlays.slice()):(gn("function"==typeof e.overlays.getArray,49),s=e.overlays):s=new an,{controls:r,interactions:o,keyboardEventTarget:t,overlays:s,values:n}}(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:un,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=t.controls||function(e){e=e||{};const t=new an;return(void 0===e.zoom||e.zoom)&&t.push(new Po(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&t.push(new Oo(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&t.push(new Ao(e.attributionOptions)),t}(),this.interactions=t.interactions||function(e){e=e||{};const t=new an,n=new class{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const i=this.points_[t+2]-this.points_[n+2];if(i<1e3/60)return!1;const r=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&t.push(new qo),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&t.push(new Zo({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&t.push(new $o({onFocusOnly:e.onFocusOnly,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&t.push(new hs),(void 0===e.pinchZoom||e.pinchZoom)&&t.push(new ds({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(t.push(new as),t.push(new ls({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&t.push(new cs({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&t.push(new ns({duration:e.zoomDuration})),t}({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new No(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Eo,this.handleLayerGroupChanged_),this.addChangeListener(Io,this.handleViewChanged_),this.addChangeListener(So,this.handleSizeChanged_),this.addChangeListener(Mo,this.handleTargetChanged_),this.setProperties(t.values);const n=this;!e.view||e.view instanceof Ur||e.view.then((function(e){n.setView(new Ur(e))})),this.controls.addEventListener(nn,(e=>{e.element.setMap(this)})),this.controls.addEventListener(rn,(e=>{e.element.setMap(null)})),this.interactions.addEventListener(nn,(e=>{e.element.setMap(this)})),this.interactions.addEventListener(rn,(e=>{e.element.setMap(null)})),this.overlays_.addEventListener(nn,(e=>{this.addOverlayInternal_(e.element)})),this.overlays_.addEventListener(rn,(e=>{const t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)})),this.controls.forEach((e=>{e.setMap(this)})),this.interactions.forEach((e=>{e.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){ms(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(e),r=void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,o=void 0!==n.layerFilter?n.layerFilter:Rt,s=!1!==n.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,r,s,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,(function(e){n.push(e)}),t),n}getAllLayers(){const e=[];return function t(n){n.forEach((function(n){n instanceof fo?t(n.getLayers()):e.push(n)}))}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e),i=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:Rt,r=void 0!==t.hitTolerance?t.hitTolerance:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,o,i,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),n=this.getSize(),i=t.width/n[0],r=t.height/n[1],o="changedTouches"in e?e.changedTouches[0]:e;return[(o.clientX-t.left)/i,(o.clientY-t.top)/r]}getTarget(){return this.get(Mo)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return tr(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?yn(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Eo)}setLayers(e){const t=this.getLayerGroup();if(e instanceof an)return void t.setLayers(e);const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const n=e[t];if(!n.visible)continue;const i=n.layer.getRenderer();if(i&&!i.ready)return!0;const r=n.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(e){const t=nr(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?yn(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(So)}getView(){return this.get(Io)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,i){return function(e,t,n,i,r){if(!e||!(n in e.wantedTiles))return ko;if(!e.wantedTiles[n][t.getKey()])return ko;const o=e.viewState.center,s=i[0]-o[0],a=i[1]-o[1];return 65536*Math.log(r)+Math.sqrt(s*s+a*a)/r}(this.frameState_,e,t,n,i)}handleBrowserEvent(e,t){t=t||e.type;const n=new yo(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===bo||n===Gt||n===zt){const e=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():e,i=t.target;if(this.overlayContainerStopEvent_.contains(i)||!(n===e?e.documentElement:n).contains(i))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.getMap()===this&&i.getActive()&&this.getTargetElement()&&(!i.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,i=n;if(e){const t=e.viewHints;if(t[0]||t[1]){const t=Date.now()-e.time>8;n=t?0:8,i=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,i))}e&&this.renderer_&&!e.animate&&(!0===this.renderComplete_?(this.hasListener(gi)&&this.renderer_.dispatchRenderEvent(gi,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new go(Co,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new go(xo,this,e))));const n=this.postRenderFunctions_;for(let t=0,i=n.length;t<i;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)Ht(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Bt,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Gt,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ao(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const e=this.getTarget(),t="string"==typeof e?document.getElementById(e):e;if(this.targetElement_=t,t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new ho(this)),this.mapBrowserEventHandler_=new wo(this,this.moveTolerance_);for(const e in vo)this.mapBrowserEventHandler_.addEventListener(vo[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Bt,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Gt,this.boundHandleBrowserEvent_,!!fn&&{passive:!1});const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[jt(e,zt,this.handleBrowserEvent,this),jt(e,Ft,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Ht(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Ht(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=jt(e,Mt,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=jt(e,Lt,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Ht),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new uo("addlayer",e)),this.layerGroupPropertyListenerKeys_=[jt(e,Mt,this.render,this),jt(e,Lt,this.render,this),jt(e,"addlayer",this.handleLayerAdd_,this),jt(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ps(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),i=this.frameState_;let r=null;if(void 0!==t&&us(t)&&n&&n.isDef()){const i=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Zn(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:i,wantedTiles:{},mapId:Kt(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const e=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=Zn(o.nextCenter,o.nextResolution,e,t)}}var o,s;this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),i&&(!this.previousExtent_||!Hn(this.previousExtent_)&&!Rn(r.extent,this.previousExtent_))&&(this.dispatchEvent(new go("movestart",this,i)),this.previousExtent_=Nn(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!Rn(r.extent,this.previousExtent_)&&(this.dispatchEvent(new go("moveend",this,r)),o=r.extent,(s=this.previousExtent_)?(s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3]):o.slice())),this.dispatchEvent(new go(_o,this,r)),this.renderComplete_=this.hasListener(xo)||this.hasListener(Co)||this.hasListener(gi)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new uo("removelayer",t)),this.set(Eo,e)}setSize(e){this.set(So,e)}setTarget(e){this.set(Mo,e)}setView(e){if(!e||e instanceof Ur)return void this.set(Io,e);this.set(Io,new Ur);const t=this;e.then((function(e){t.setView(new Ur(e))}))}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),i=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),r=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(i)||isNaN(r)||(t=[i,r],!us(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Fi("No map visible because the map container's width or height are 0."))}const n=this.getSize();!t||n&&Nt(t,n)||(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(t=[parseInt(n.width,10),parseInt(n.height,10)]),e.setViewportSize(t)}}},gs=(0,e.createContext)(null),ys=gs.Provider;function vs(){return(0,e.useContext)(gs)}function bs({eventHandlers:t=[],center:n,zoom:i,className:r,id:o,children:s}){const a=(0,e.useRef)(),l=(0,e.useMemo)((()=>new fs),[]);return(0,e.useLayoutEffect)((()=>{function e(e){const t=e.target.getView();if(!t)throw new Error("No view found for map. Has a visible base layer been provided?");const r=t.getProjection().getExtent();t.setCenter(null!=n?n:Bn(r)),t.getZoom()||t.setZoom(null!=i?i:t.getMinZoom())}return t.forEach((({event:e,handler:t,once:n})=>{l[n?"once":"on"].call(l,e,t)})),l.on("change:view",e),()=>{t.forEach((({event:e,handler:t,once:n})=>{n||l.un(e,t)})),l.un("change:view",e)}}),[]),(0,e.useEffect)((()=>{n&&l.getView().setCenter(n)}),[n,l]),(0,e.useEffect)((()=>{isNaN(i)||l.getView().setZoom(i)}),[l,i]),(0,e.useEffect)((()=>{l.setTarget(a.current)}),[l]),(0,e.createElement)(ys,{value:{map:l}},(0,e.createElement)("div",{className:r,ref:a,id:o},s))}const ws=class extends Dt{constructor(e,t,n,i){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=i}changed(){this.dispatchEvent(Lt)}getExtent(){return this.extent}getImage(){return Xt()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){Xt()}};let _s;const xs=[];function Cs(e,t,n,i,r){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(i,r),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,i)+1,Math.max(n,r)),e.restore()}function Es(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}const Ss=class extends ws{constructor(e,t,n,i,r,o,s){let a=e.getExtent();a&&e.canWrapX()&&(a=a.slice(),a[0]=-1/0,a[2]=1/0);let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);const c=l?Fn(n,l):n,h=function(e,t,n,i){const r=qi(n,t,e);let o=Ui(t,i,n);const s=t.getMetersPerUnit();void 0!==s&&(o*=s);const a=e.getMetersPerUnit();void 0!==a&&(o/=a);const l=e.getExtent();if(!l||Sn(l,r)){const t=Ui(e,o,r)/o;isFinite(t)&&t>0&&(o/=t)}return o}(e,t,Bn(c),i),d=new class{constructor(e,t,n,i,r,o){this.sourceProj_=e,this.targetProj_=t;let s={};const a=$i(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+"/"+e[1];return s[t]||(s[t]=a(e)),s[t]},this.maxSourceExtent_=i,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&jn(i)>=jn(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?jn(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?jn(this.targetProj_.getExtent()):null;const l=Vn(n),c=Gn(n),h=Ln(n),d=Dn(n),u=this.transformInv_(l),p=this.transformInv_(c),m=this.transformInv_(h),f=this.transformInv_(d),g=10+(o?Math.max(0,Math.ceil(Math.log2(function(e){let t=0;return Hn(e)||(t=jn(e)*zn(e)),t}(n)/(o*o*256*256)))):0);if(this.addQuad_(l,c,h,d,u,p,m,f,g),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach((function(t,n,i){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach((t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const n=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];n[0][0]-e>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-e>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-e>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);const i=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-i<this.sourceWorldWidth_/2&&(t.source=n)}}))}s={}}addTriangle_(e,t,n,i,r,o){this.triangles_.push({source:[i,r,o],target:[e,t,n]})}addQuad_(e,t,n,i,r,o,s,a,l){const c=Cn([r,o,s,a]),h=this.sourceWorldWidth_?jn(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,u=this.sourceProj_.canWrapX()&&h>.5&&h<1;let p=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=jn(Cn([e,t,n,i]))/this.targetWorldWidth_>.25||p),!u&&this.sourceProj_.isGlobal()&&h&&(p=h>.25||p)),!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Wn(c,this.maxSourceExtent_))return;let m=0;if(!(p||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)p=!0;else if(m=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(s[0])&&isFinite(s[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=m&&2!=m&&4!=m&&8!=m)return;if(l>0){if(!p){const t=[(e[0]+n[0])/2,(e[1]+n[1])/2],i=this.transformInv_(t);let o;o=u?(Kn(r[0],d)+Kn(s[0],d))/2-Kn(i[0],d):(r[0]+s[0])/2-i[0];const a=(r[1]+s[1])/2-i[1];p=o*o+a*a>this.errorThresholdSquared_}if(p){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const c=[(t[0]+n[0])/2,(t[1]+n[1])/2],h=this.transformInv_(c),d=[(i[0]+e[0])/2,(i[1]+e[1])/2],u=this.transformInv_(d);this.addQuad_(e,t,c,d,r,o,h,u,l-1),this.addQuad_(d,c,n,i,u,h,s,a,l-1)}else{const c=[(e[0]+t[0])/2,(e[1]+t[1])/2],h=this.transformInv_(c),d=[(n[0]+i[0])/2,(n[1]+i[1])/2],u=this.transformInv_(d);this.addQuad_(e,c,d,i,r,h,u,a,l-1),this.addQuad_(c,t,n,d,h,o,s,u,l-1)}return}}if(u){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&m)&&this.addTriangle_(e,n,i,r,s,a),0==(14&m)&&this.addTriangle_(e,n,t,r,s,o),m&&(0==(13&m)&&this.addTriangle_(t,i,e,o,a,r),0==(7&m)&&this.addTriangle_(t,i,n,o,a,s))}calculateSourceExtent(){const e=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(t,n,i){const r=t.source;An(e,r[0]),An(e,r[1]),An(e,r[2])})),e}getTriangles(){return this.triangles_}}(e,t,c,a,.5*h,i),u=d.calculateSourceExtent(),p=Hn(u)?null:o(u,h,r),m=p?0:4,f=p?p.getPixelRatio():1;super(n,i,f,m),this.targetProj_=t,this.maxSourceExtent_=a,this.triangulation_=d,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=p,this.sourcePixelRatio_=f,this.interpolate_=s,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){1==this.state&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(2==e){const e=jn(this.targetExtent_)/this.targetResolution_,t=zn(this.targetExtent_)/this.targetResolution_;this.canvas_=function(e,t,n,i,r,o,s,a,l,c,h,d){const u=no(Math.round(n*e),Math.round(n*t),xs);if(d||(u.imageSmoothingEnabled=!1),0===l.length)return u.canvas;function p(e){return Math.round(e*n)/n}u.scale(n,n),u.globalCompositeOperation="lighter";const m=[1/0,1/0,-1/0,-1/0];l.forEach((function(e,t,n){var i,r;i=m,(r=e.extent)[0]<i[0]&&(i[0]=r[0]),r[2]>i[2]&&(i[2]=r[2]),r[1]<i[1]&&(i[1]=r[1]),r[3]>i[3]&&(i[3]=r[3])}));const f=jn(m),g=zn(m),y=no(Math.round(n*f/i),Math.round(n*g/i),xs);d||(y.imageSmoothingEnabled=!1);const v=n/i;l.forEach((function(e,t,n){const i=e.extent[0]-m[0],r=-(e.extent[3]-m[3]),o=jn(e.extent),s=zn(e.extent);e.image.width>0&&e.image.height>0&&y.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,i*v,r*v,o*v,s*v)}));const b=Vn(s);return a.getTriangles().forEach((function(e,t,r){const s=e.source,a=e.target;let l=s[0][0],c=s[0][1],h=s[1][0],f=s[1][1],g=s[2][0],v=s[2][1];const w=p((a[0][0]-b[0])/o),_=p(-(a[0][1]-b[1])/o),x=p((a[1][0]-b[0])/o),C=p(-(a[1][1]-b[1])/o),E=p((a[2][0]-b[0])/o),S=p(-(a[2][1]-b[1])/o),M=l,I=c;l=0,c=0,h-=M,f-=I,g-=M,v-=I;const k=function(e){const t=e.length;for(let n=0;n<t;n++){let i=n,r=Math.abs(e[n][n]);for(let o=n+1;o<t;o++){const t=Math.abs(e[o][n]);t>r&&(r=t,i=o)}if(0===r)return null;const o=e[i];e[i]=e[n],e[n]=o;for(let i=n+1;i<t;i++){const r=-e[i][n]/e[n][n];for(let o=n;o<t+1;o++)n==o?e[i][o]=0:e[i][o]+=r*e[n][o]}}const n=new Array(t);for(let i=t-1;i>=0;i--){n[i]=e[i][t]/e[i][i];for(let r=i-1;r>=0;r--)e[r][t]-=e[r][i]*n[i]}return n}([[h,f,0,0,x-w],[g,v,0,0,E-w],[0,0,h,f,C-_],[0,0,g,v,S-_]]);if(k){if(u.save(),u.beginPath(),function(){if(void 0===_s){const e=no(6,6,xs);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Cs(e,4,5,4,0),Cs(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;_s=Es(t,0)||Es(t,4)||Es(t,8),io(e),xs.push(e.canvas)}return _s}()||!d){u.moveTo(x,C);const e=4,t=w-x,n=_-C;for(let i=0;i<e;i++)u.lineTo(x+p((i+1)*t/e),C+p(i*n/(e-1))),i!=e-1&&u.lineTo(x+p((i+1)*t/e),C+p((i+1)*n/(e-1)));u.lineTo(E,S)}else u.moveTo(x,C),u.lineTo(w,_),u.lineTo(E,S);u.clip(),u.transform(k[0],k[2],k[1],k[3],w,_),u.translate(m[0]-M,m[3]-I),u.scale(i/n,-i/n),u.drawImage(y.canvas,0,0),u.restore()}})),io(y),xs.push(y.canvas),h&&(u.save(),u.globalCompositeOperation="source-over",u.strokeStyle="black",u.lineWidth=1,a.getTriangles().forEach((function(e,t,n){const i=e.target,r=(i[0][0]-b[0])/o,s=-(i[0][1]-b[1])/o,a=(i[1][0]-b[0])/o,l=-(i[1][1]-b[1])/o,c=(i[2][0]-b[0])/o,h=-(i[2][1]-b[1])/o;u.beginPath(),u.moveTo(a,l),u.lineTo(r,s),u.lineTo(c,h),u.closePath(),u.stroke()})),u.restore()),u.canvas}(e,t,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(0==this.state){this.state=1,this.changed();const e=this.sourceImage_.getState();2==e||3==e?this.reproject_():(this.sourceListenerKey_=jt(this.sourceImage_,Lt,(function(e){const t=this.sourceImage_.getState();2!=t&&3!=t||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){Ht(this.sourceListenerKey_),this.sourceListenerKey_=null}};function Ms(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null}const Is=class extends qt{constructor(e){super(),this.projection=Hi(e.projection),this.attributions_=Ms(e.attributions),this.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,this.loading=!1,this.state_=void 0!==e.state?e.state:"ready",this.wrapX_=void 0!==e.wrapX&&e.wrapX,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise((function(e,n){t.viewResolver=e,t.viewRejector=n}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Ms(e),this.changed()}setState(e){this.state_=e,this.changed()}};class ks extends St{constructor(e,t){super(e),this.image=t}}function Ts(e,t){e.getImage().src=t}const Ns=class extends Is{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();return t&&(e=t[Tt(t,e,0)]),e}getImage(e,t,n,i){const r=this.getProjection();if(!r||!i||Ji(r,i))return r&&(i=r),this.getImageInternal(e,t,n,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ji(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==t&&Rn(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ss(r,i,e,t,n,((e,t,n)=>this.getImageInternal(e,t,n,r)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,i){return Xt()}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case 1:this.loading=!0,n="imageloadstart";break;case 2:this.loading=!1,n="imageloadend";break;case 3:this.loading=!1,n="imageloaderror";break;default:return}this.hasListener(n)&&this.dispatchEvent(new ks(n,t))}},Rs=class extends ws{constructor(e,t,n,i,r,o,s){super(e,t,n,0),this.src_=i,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.context_=s,this.unlisten_=null,this.state=0,this.imageLoadFunction_=o}getImage(){if(2==this.state&&this.context_&&!(this.image_ instanceof HTMLCanvasElement)){const e=this.context_.canvas;e.width=this.image_.width,e.height=this.image_.height,this.context_.drawImage(this.image_,0,0),this.image_=this.context_.canvas}return this.image_}handleImageError_(){this.state=3,this.unlistenImage_(),this.changed()}handleImageLoad_(){void 0===this.resolution&&(this.resolution=zn(this.extent)/this.image_.height),this.state=2,this.unlistenImage_(),this.changed()}load(){0!=this.state&&3!=this.state||(this.state=1,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=function(e,t,n){const i=e;let r=!0,o=!1,s=!1;const a=[Wt(i,"load",(function(){s=!0,o||t()}))];return i.src&&mn?(o=!0,i.decode().then((function(){r&&t()})).catch((function(e){r&&(s?t():n())}))):a.push(Wt(i,"error",n)),function(){r=!1,a.forEach(Ht)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}setImage(e){this.image_=e,this.resolution=zn(this.extent)/this.image_.height}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}},As=class extends Ns{constructor(e){const t=void 0!==e.crossOrigin?e.crossOrigin:null,n=void 0!==e.imageLoadFunction?e.imageLoadFunction:Ts;super({attributions:e.attributions,interpolate:e.interpolate,projection:Hi(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image_=new Rs(this.imageExtent_,void 0,1,this.url_,t,n,no(1,1)),this.imageSize_=e.imageSize?e.imageSize:null,this.image_.addEventListener(Lt,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return Wn(e,this.image_.getExtent())?this.image_:null}getUrl(){return this.url_}handleImageChange(e){if(2==this.image_.getState()){const e=this.image_.getExtent(),t=this.image_.getImage();let n,i;this.imageSize_?(n=this.imageSize_[0],i=this.imageSize_[1]):(n=t.width,i=t.height);const r=jn(e),o=zn(e),s=r/n,a=o/i;let l=n,c=i;if(s>a?l=Math.round(r/a):c=Math.round(o/s),l!==n||c!==i){const e=no(l,c);this.getInterpolate()||(e.imageSmoothingEnabled=!1);const r=e.canvas;e.drawImage(t,0,0,n,i,0,0,r.width,r.height),this.image_.setImage(r)}}super.handleImageChange(e)}},Os=class extends Xr{constructor(e){super(e=e||{})}},Ps=class extends Yt{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return Xt()}getData(e){return null}prepareFrame(e){return Xt()}renderFrame(e,t){return Xt()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(i,r)=>{const o=this.loadedTileCallback.bind(this,n,i);return e.forEachLoadedTile(t,i,r,o)}}forEachFeatureAtCoordinate(e,t,n,i,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){2===e.target.getState()&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return 2!=t&&3!=t&&e.addEventListener(Lt,this.boundHandleImageChange_),0==t&&(e.load(),t=e.getState()),2==t}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}};let Ds=null;const Ls=class extends Ps{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){let i;Ds||(Ds=no(1,1,void 0,{willReadFrequently:!0})),Ds.clearRect(0,0,1,1);try{Ds.drawImage(e,t,n,1,1,0,0,1,1),i=Ds.getImageData(0,0,1,1).data}catch(e){return Ds=null,null}return i}getBackground(e){let t=this.getLayer().getBackground();return"function"==typeof t&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,n){const i=this.getLayer().getClassName();let r,o;if(e&&e.className===i&&(!n||e&&e.style.backgroundColor&&Nt(ti(e.style.backgroundColor),ti(n)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(o=t.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=i;let e=r.style;e.position="absolute",e.width="100%",e.height="100%",o=no();const t=o.canvas;r.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=r,this.context=o}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const i=Vn(n),r=Gn(n),o=Ln(n),s=Dn(n);yn(t.coordinateToPixelTransform,i),yn(t.coordinateToPixelTransform,r),yn(t.coordinateToPixelTransform,o),yn(t.coordinateToPixelTransform,s);const a=this.inversePixelTransform;yn(a,i),yn(a,r),yn(a,o),yn(a,s),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.clip()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){const r=new $r(e,this.inversePixelTransform,n,t);i.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_("prerender",e,t)}postRender(e,t){this.dispatchRenderEvent_("postrender",e,t)}getRenderTransform(e,t,n,i,r,o,s){const a=r/2,l=o/2,c=i/t,h=-c,d=-e[0]+s,u=-e[1];return vn(this.tempTransform,a,l,c,h,-n,d,u)}disposeInternal(){delete this.frameState,super.disposeInternal()}},Bs=class extends Ls{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,i=e.viewState,r=i.resolution,o=this.getLayer().getSource(),s=e.viewHints;let a=e.extent;if(void 0!==t.extent&&(a=Fn(a,ir(t.extent,i.projection))),!s[0]&&!s[1]&&!Hn(a))if(o){const e=i.projection,t=o.getImage(a,r,n,e);t&&(this.loadImage(t)?this.image_=t:4===t.getState()&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),i=yn(t.pixelToCoordinateTransform,e.slice()),r=n.getExtent();if(r&&!Sn(r,i))return null;const o=this.image_.getExtent(),s=this.getImage(),a=jn(o),l=Math.floor(s.width*((i[0]-o[0])/a));if(l<0||l>=s.width)return null;const c=zn(o),h=Math.floor(s.height*((o[3]-i[1])/c));return h<0||h>=s.height?null:this.getImageData(s,l,h)}renderFrame(e,t){const n=this.image_,i=n.getExtent(),r=n.getResolution(),o=n.getPixelRatio(),s=e.layerStatesArray[e.layerIndex],a=e.pixelRatio,l=e.viewState,c=l.center,h=a*r/(l.resolution*o),d=e.extent,u=l.resolution,p=l.rotation,m=Math.round(jn(d)/u*a),f=Math.round(zn(d)/u*a);vn(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,p,-m/2,-f/2),bn(this.inversePixelTransform,this.pixelTransform);const g=function(e){const t="matrix("+e.join(", ")+")";if(pn)return t;const n=wn||(wn=document.createElement("div"));return n.style.transform=t,n.style.transform}(this.pixelTransform);this.useContainer(t,g,this.getBackground(e));const y=this.context,v=y.canvas;v.width!=m||v.height!=f?(v.width=m,v.height=f):this.containerReused||y.clearRect(0,0,m,f);let b=!1,w=!0;if(s.extent){const t=ir(s.extent,l.projection);w=Wn(t,e.extent),b=w&&!Mn(t,e.extent),b&&this.clipUnrotated(y,e,t)}const _=this.getImage(),x=vn(this.tempTransform,m/2,f/2,h,h,0,o*(i[0]-c[0])/r,o*(c[1]-i[3])/r);this.renderedResolution=r*a/o;const C=_.width*x[0],E=_.height*x[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,e),w&&C>=.5&&E>=.5){const e=x[4],t=x[5],n=s.opacity;let i;1!==n&&(i=y.globalAlpha,y.globalAlpha=n),y.drawImage(_,0,0,+_.width,+_.height,e,t,C,E),1!==n&&(y.globalAlpha=i)}return this.postRender(y,e),b&&y.restore(),y.imageSmoothingEnabled=!0,g!==v.style.transform&&(v.style.transform=g),this.container}},Zs=class extends Os{constructor(e){super(e)}createRenderer(){return new Bs(this)}getData(e){return super.getData(e)}};function zs({layer:t={},visible:n=!0,watchZoom:i,children:r}){const o=vs(),s=(0,e.useMemo)((()=>{var e,n;return[0,0,null!==(e=t.image_source?.width)&&void 0!==e?e:0,null!==(n=t.image_source?.height)&&void 0!==n?n:0]}),[t.image_source?.height,t.image_source?.width]),a=(0,e.useMemo)((()=>new Zs({title:t.name,baseLayer:!0,visible:n,wpId:t.id})),[]);(0,e.useLayoutEffect)((()=>o.map?.addLayer(a)),[o.map,a]),(0,e.useLayoutEffect)((()=>{a.setProperties({title:t.name,wpId:t.id})}),[a,t.id,t.name]);const l=(0,e.useMemo)((()=>t.image_source?.url?new bi({code:"layer-image",units:"pixels",extent:s}):null),[s,t.image_source?.url]);return(0,e.useLayoutEffect)((()=>{const e=l?new As({url:t.image_source?.url,projection:l,imageExtent:s}):null;a.setSource(e)}),[s,a,t.image_source?.url,l]),(0,e.useEffect)((()=>{const e=o.map?.getView().getZoom();n&&o.map.setView(new Ur({projection:l,extent:s,constrainOnlyCenter:!0,zoom:e}))}),[n,l,o.map,s]),(0,e.useEffect)((()=>{if(n){const e=o.map?.getView();e?.setMinZoom(t.meta.zoom?.min),e?.setMaxZoom(t.meta.zoom?.max)}}),[t.meta.zoom,n,o.map]),(0,e.useEffect)((()=>{"number"==typeof i&&o.map?.getView().setZoom(i)}),[o.map,i]),(0,e.createElement)(ys,{value:{...o,projection:l,imgLayer:a}},r)}function Fs(t,n){const i=(0,e.useMemo)((()=>window.wp.media({title:(0,f.__)("Select image"),button:{text:(0,f.__)("Select image")},multiple:t})),[t]);return(0,e.useEffect)((()=>{function e(){const e=i.state().get("selection");n&&n(e)}return i.on("select",e),()=>i.off("select",e)}),[i,n]),i}function Vs({onChange:t,invalid:n,matchSize:i,id:r}){const[o,s]=(0,e.useState)(!1),{setValue:a}=W(),l=st(),c=Fs(!1,(async e=>{let n;s(!0);try{n=await e.first()}catch(e){return void l({message:e.message,style:"error"})}a("image_source",{url:n.attributes.url,width:n.attributes.width,height:n.attributes.height}),i?.current?.height&&i.current.width&&n.attributes.width!==i.current.width&&n.attributes.height!==i.current.height&&l({style:"warning",message:(0,f.__)("The dimensions of the selected image are not the same as the first image. This might effect the usability for a visitor when switching layers.","image-map-connect")}),t(n.attributes.id),s(!1)}));return(0,e.createElement)(m.Button,{id:r,disabled:o,variant:"secondary",isDestructive:n,onClick:()=>c.open()},(0,f.__)("Select image","image-map-connect"))}function Gs(e){return Gs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gs(e)}function js(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Gs(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==Gs(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Gs(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ws(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Hs(e,t){if(e){if("string"==typeof e)return Ws(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ws(e,t):void 0}}function Us(e){return function(e){if(Array.isArray(e))return Ws(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Hs(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ys(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,_x,o,s=[],_n=!0,a=!1;try{if(_x=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(i=_x.call(n)).done)&&(s.push(i.value),s.length!==t);_n=!0);}catch(e){a=!0,r=e}finally{try{if(!_n&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(a)throw r}}return s}}(e,t)||Hs(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Xs=n(184),Js=n.n(Xs),Ks={},$s=[];function qs(e,t){}function Qs(e,t){}function ea(e,t,n){t||Ks[n]||(e(!1,n),Ks[n]=!0)}function ta(e,t){ea(qs,e,t)}ta.preMessage=function(e){$s.push(e)},ta.resetWarned=function(){Ks={}},ta.noteOnce=function(e,t){ea(Qs,e,t)};const na=ta;function ia(e){var t=S.useRef();t.current=e;var n=S.useCallback((function(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(i))}),[]);return n}var ra="undefined"!=typeof window&&window.document&&window.document.createElement?S.useLayoutEffect:S.useEffect,oa=function(e,t){!function(e,t){var n=S.useRef(!0);ra((function(){return e(n.current)}),t),ra((function(){return n.current=!1,function(){n.current=!0}}),[])}((function(t){if(!t)return e()}),t)};function sa(e){var t=S.useRef(!1),n=Ys(S.useState(e),2),i=n[0],r=n[1];return S.useEffect((function(){return t.current=!1,function(){t.current=!0}}),[]),[i,function(e,n){n&&t.current||r(e)}]}function aa(e){return void 0!==e}function la(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ca(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ha(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(n),!0).forEach((function(t){js(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ca(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var da={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=da.F1&&t<=da.F12)return!1;switch(t){case da.ALT:case da.CAPS_LOCK:case da.CONTEXT_MENU:case da.CTRL:case da.DOWN:case da.END:case da.ESC:case da.HOME:case da.INSERT:case da.LEFT:case da.MAC_FF_META:case da.META:case da.NUMLOCK:case da.NUM_CENTER:case da.PAGE_DOWN:case da.PAGE_UP:case da.PAUSE:case da.PRINT_SCREEN:case da.RIGHT:case da.SHIFT:case da.UP:case da.WIN_KEY:case da.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=da.ZERO&&e<=da.NINE)return!0;if(e>=da.NUM_ZERO&&e<=da.NUM_MULTIPLY)return!0;if(e>=da.A&&e<=da.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case da.SPACE:case da.QUESTION_MARK:case da.NUM_PLUS:case da.NUM_MINUS:case da.NUM_PERIOD:case da.NUM_DIVISION:case da.SEMICOLON:case da.DASH:case da.EQUALS:case da.COMMA:case da.PERIOD:case da.SLASH:case da.APOSTROPHE:case da.SINGLE_QUOTE:case da.OPEN_SQUARE_BRACKET:case da.BACKSLASH:case da.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};const ua=da,pa=S.createContext({min:0,max:0,direction:"ltr",step:1,includedStart:0,includedEnd:0,tabIndex:0,keyboard:!0});function ma(e,t,n){return(e-t)/(n-t)}function fa(e,t,n,i){var r=ma(t,n,i),o={};switch(e){case"rtl":o.right="".concat(100*r,"%"),o.transform="translateX(50%)";break;case"btt":o.bottom="".concat(100*r,"%"),o.transform="translateY(50%)";break;case"ttb":o.top="".concat(100*r,"%"),o.transform="translateY(-50%)";break;default:o.left="".concat(100*r,"%"),o.transform="translateX(-50%)"}return o}function ga(e,t){return Array.isArray(e)?e[t]:e}var ya=["prefixCls","value","valueIndex","onStartMove","style","render","dragging","onOffsetChange"],va=S.forwardRef((function(e,n){var i,r,o=e.prefixCls,s=e.value,a=e.valueIndex,l=e.onStartMove,c=e.style,h=e.render,d=e.dragging,u=e.onOffsetChange,p=la(e,ya),m=S.useContext(pa),f=m.min,g=m.max,y=m.direction,v=m.disabled,b=m.keyboard,w=m.range,_=m.tabIndex,x=m.ariaLabelForHandle,C=m.ariaLabelledByForHandle,E=m.ariaValueTextFormatterForHandle,M="".concat(o,"-handle"),I=function(e){v||l(e,a)},k=fa(y,s,f,g),T=S.createElement("div",t({ref:n,className:Js()(M,(i={},js(i,"".concat(M,"-").concat(a+1),w),js(i,"".concat(M,"-dragging"),d),i)),style:ha(ha({},k),c),onMouseDown:I,onTouchStart:I,onKeyDown:function(e){if(!v&&b){var t=null;switch(e.which||e.keyCode){case ua.LEFT:t="ltr"===y||"btt"===y?-1:1;break;case ua.RIGHT:t="ltr"===y||"btt"===y?1:-1;break;case ua.UP:t="ttb"!==y?1:-1;break;case ua.DOWN:t="ttb"!==y?-1:1;break;case ua.HOME:t="min";break;case ua.END:t="max";break;case ua.PAGE_UP:t=2;break;case ua.PAGE_DOWN:t=-2}null!==t&&(e.preventDefault(),u(t,a))}},tabIndex:v?null:ga(_,a),role:"slider","aria-valuemin":f,"aria-valuemax":g,"aria-valuenow":s,"aria-disabled":v,"aria-label":ga(x,a),"aria-labelledby":ga(C,a),"aria-valuetext":null===(r=ga(E,a))||void 0===r?void 0:r(s),"aria-orientation":"ltr"===y||"rtl"===y?"horizontal":"vertical"},p));return h&&(T=h(T,{index:a,prefixCls:o,value:s,dragging:d})),T}));const ba=va;var wa=["prefixCls","style","onStartMove","onOffsetChange","values","handleRender","draggingIndex"];const _a=S.forwardRef((function(e,n){var i=e.prefixCls,r=e.style,o=e.onStartMove,s=e.onOffsetChange,a=e.values,l=e.handleRender,c=e.draggingIndex,h=la(e,wa),d=S.useRef({});return S.useImperativeHandle(n,(function(){return{focus:function(e){var t;null===(t=d.current[e])||void 0===t||t.focus()}}})),S.createElement(S.Fragment,null,a.map((function(e,n){return S.createElement(ba,t({ref:function(e){e?d.current[n]=e:delete d.current[n]},dragging:c===n,prefixCls:i,style:ga(r,n),key:n,value:e,valueIndex:n,onStartMove:o,onOffsetChange:s,render:l},h))})))}));function xa(e){var t="touches"in e?e.touches[0]:e;return{pageX:t.pageX,pageY:t.pageY}}function Ca(e){var t,n=e.prefixCls,i=e.style,r=e.start,o=e.end,s=e.index,a=e.onStartMove,l=S.useContext(pa),c=l.direction,h=l.min,d=l.max,u=l.disabled,p=l.range,m="".concat(n,"-track"),f=ma(r,h,d),g=ma(o,h,d),y=function(e){!u&&a&&a(e,-1)},v={};switch(c){case"rtl":v.right="".concat(100*f,"%"),v.width="".concat(100*g-100*f,"%");break;case"btt":v.bottom="".concat(100*f,"%"),v.height="".concat(100*g-100*f,"%");break;case"ttb":v.top="".concat(100*f,"%"),v.height="".concat(100*g-100*f,"%");break;default:v.left="".concat(100*f,"%"),v.width="".concat(100*g-100*f,"%")}return S.createElement("div",{className:Js()(m,(t={},js(t,"".concat(m,"-").concat(s+1),p),js(t,"".concat(n,"-track-draggable"),a),t)),style:ha(ha({},v),i),onMouseDown:y,onTouchStart:y})}function Ea(e){var t=e.prefixCls,n=e.style,i=e.values,r=e.startPoint,o=e.onStartMove,s=S.useContext(pa),a=s.included,l=s.range,c=s.min,h=S.useMemo((function(){if(!l){if(0===i.length)return[];var e=null!=r?r:c,t=i[0];return[{start:Math.min(e,t),end:Math.max(e,t)}]}for(var n=[],o=0;o<i.length-1;o+=1)n.push({start:i[o],end:i[o+1]});return n}),[i,l,r,c]);return a?h.map((function(e,i){var r=e.start,s=e.end;return S.createElement(Ca,{index:i,prefixCls:t,style:ga(n,i),start:r,end:s,key:i,onStartMove:o})})):null}function Sa(e){var t=e.prefixCls,n=e.style,i=e.children,r=e.value,o=e.onClick,s=S.useContext(pa),a=s.min,l=s.max,c=s.direction,h=s.includedStart,d=s.includedEnd,u=s.included,p="".concat(t,"-text"),m=fa(c,r,a,l);return S.createElement("span",{className:Js()(p,js({},"".concat(p,"-active"),u&&h<=r&&r<=d)),style:ha(ha({},m),n),onMouseDown:function(e){e.stopPropagation()},onClick:function(){o(r)}},i)}function Ma(e){var t=e.prefixCls,n=e.marks,i=e.onClick,r="".concat(t,"-mark");return n.length?S.createElement("div",{className:r},n.map((function(e){var t=e.value,n=e.style,o=e.label;return S.createElement(Sa,{key:t,prefixCls:r,style:n,value:t,onClick:i},o)}))):null}function Ia(e){var t=e.prefixCls,n=e.value,i=e.style,r=e.activeStyle,o=S.useContext(pa),s=o.min,a=o.max,l=o.direction,c=o.included,h=o.includedStart,d=o.includedEnd,u="".concat(t,"-dot"),p=c&&h<=n&&n<=d,m=ha(ha({},fa(l,n,s,a)),"function"==typeof i?i(n):i);return p&&(m=ha(ha({},m),"function"==typeof r?r(n):r)),S.createElement("span",{className:Js()(u,js({},"".concat(u,"-active"),p)),style:m})}function ka(e){var t=e.prefixCls,n=e.marks,i=e.dots,r=e.style,o=e.activeStyle,s=S.useContext(pa),a=s.min,l=s.max,c=s.step,h=S.useMemo((function(){var e=new Set;if(n.forEach((function(t){e.add(t.value)})),i&&null!==c)for(var t=a;t<=l;)e.add(t),t+=c;return Array.from(e)}),[a,l,c,i,n]);return S.createElement("div",{className:"".concat(t,"-step")},h.map((function(e){return S.createElement(Ia,{prefixCls:t,key:e,value:e,style:r,activeStyle:o})})))}var Ta=S.forwardRef((function(e,t){var n,i=e.prefixCls,r=void 0===i?"rc-slider":i,o=e.className,s=e.style,a=e.disabled,l=void 0!==a&&a,c=e.keyboard,h=void 0===c||c,d=e.autoFocus,u=e.onFocus,p=e.onBlur,m=e.min,f=void 0===m?0:m,g=e.max,y=void 0===g?100:g,v=e.step,b=void 0===v?1:v,w=e.value,_=e.defaultValue,x=e.range,C=e.count,E=e.onChange,M=e.onBeforeChange,I=e.onAfterChange,k=e.allowCross,T=void 0===k||k,N=e.pushable,R=void 0!==N&&N,A=e.draggableTrack,O=e.reverse,P=e.vertical,D=e.included,L=void 0===D||D,B=e.startPoint,Z=e.trackStyle,z=e.handleStyle,F=e.railStyle,V=e.dotStyle,G=e.activeDotStyle,j=e.marks,W=e.dots,H=e.handleRender,U=e.tabIndex,Y=void 0===U?0:U,X=e.ariaLabelForHandle,J=e.ariaLabelledByForHandle,K=e.ariaValueTextFormatterForHandle,$=S.useRef(),q=S.useRef(),Q=S.useMemo((function(){return P?O?"ttb":"btt":O?"rtl":"ltr"}),[O,P]),ee=S.useMemo((function(){return isFinite(f)?f:0}),[f]),te=S.useMemo((function(){return isFinite(y)?y:100}),[y]),ne=S.useMemo((function(){return null!==b&&b<=0?1:b}),[b]),ie=S.useMemo((function(){return"boolean"==typeof R?!!R&&ne:R>=0&&R}),[R,ne]),re=S.useMemo((function(){return Object.keys(j||{}).map((function(e){var t=j[e],n={value:Number(e)};return t&&"object"===Gs(t)&&!S.isValidElement(t)&&("label"in t||"style"in t)?(n.style=t.style,n.label=t.label):n.label=t,n})).filter((function(e){var t=e.label;return t||"number"==typeof t})).sort((function(e,t){return e.value-t.value}))}),[j]),oe=function(e,t,n,i,r,o){var s=S.useCallback((function(n){var i=isFinite(n);return i=Math.min(t,n),Math.max(e,i)}),[e,t]),a=S.useCallback((function(i){if(null!==n){var r=e+Math.round((s(i)-e)/n)*n,o=function(e){return(String(e).split(".")[1]||"").length},a=Math.max(o(n),o(t),o(e)),l=Number(r.toFixed(a));return e<=l&&l<=t?l:null}return null}),[n,e,t,s]),l=S.useCallback((function(r){var o=s(r),l=i.map((function(e){return e.value}));null!==n&&l.push(a(r)),l.push(e,t);var c=l[0],h=t-e;return l.forEach((function(e){var t=Math.abs(o-e);t<=h&&(c=e,h=t)})),c}),[e,t,i,n,s,a]),c=function r(o,s,l){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit";if("number"==typeof s){var h,d=o[l],u=d+s,p=[];i.forEach((function(e){p.push(e.value)})),p.push(e,t),p.push(a(d));var m=s>0?1:-1;"unit"===c?p.push(a(d+m*n)):p.push(a(u)),p=p.filter((function(e){return null!==e})).filter((function(e){return s<0?e<=d:e>=d})),"unit"===c&&(p=p.filter((function(e){return e!==d})));var f="unit"===c?d:u;h=p[0];var g=Math.abs(h-f);if(p.forEach((function(e){var t=Math.abs(e-f);t<g&&(h=e,g=t)})),void 0===h)return s<0?e:t;if("dist"===c)return h;if(Math.abs(s)>1){var y=Us(o);return y[l]=h,r(y,s-m,l,c)}return h}return"min"===s?e:"max"===s?t:void 0},h=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",r=e[n],o=c(e,t,n,i);return{value:o,changed:o!==r}},d=function(e){return null===o&&0===e||"number"==typeof o&&e<o};return[l,function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",s=e.map(l),a=s[n],u=c(s,t,n,i);if(s[n]=u,!1===r){var p=o||0;n>0&&s[n-1]!==a&&(s[n]=Math.max(s[n],s[n-1]+p)),n<s.length-1&&s[n+1]!==a&&(s[n]=Math.min(s[n],s[n+1]-p))}else if("number"==typeof o||null===o){for(var m=n+1;m<s.length;m+=1)for(var f=!0;d(s[m]-s[m-1])&&f;){var g=h(s,1,m);s[m]=g.value,f=g.changed}for(var y=n;y>0;y-=1)for(var v=!0;d(s[y]-s[y-1])&&v;){var b=h(s,-1,y-1);s[y-1]=b.value,v=b.changed}for(var w=s.length-1;w>0;w-=1)for(var _=!0;d(s[w]-s[w-1])&&_;){var x=h(s,-1,w-1);s[w-1]=x.value,_=x.changed}for(var C=0;C<s.length-1;C+=1)for(var E=!0;d(s[C+1]-s[C])&&E;){var S=h(s,1,C+1);s[C+1]=S.value,E=S.changed}}return{value:s[n],values:s}}]}(ee,te,ne,re,T,ie),se=Ys(oe,2),ae=se[0],le=se[1],ce=function(e,t){var n=t||{},i=n.defaultValue,r=n.value,o=n.onChange,s=n.postState,a=Ys(sa((function(){return aa(r)?r:aa(i)?"function"==typeof i?i():i:"function"==typeof e?e():e})),2),l=a[0],c=a[1],h=void 0!==r?r:l,d=s?s(h):h,u=ia(o),p=Ys(sa([h]),2),m=p[0],f=p[1];return oa((function(){var e=m[0];l!==e&&u(l,e)}),[m]),oa((function(){aa(r)||c(r)}),[r]),[d,ia((function(e,t){c(e,t),f([h],t)}))]}(_,{value:w}),he=Ys(ce,2),de=he[0],ue=he[1],pe=S.useMemo((function(){var e=null==de?[]:Array.isArray(de)?de:[de],t=Ys(e,1)[0],n=null===de?[]:[void 0===t?ee:t];if(x){if(n=Us(e),C||void 0===de){var i=C>=0?C+1:2;for(n=n.slice(0,i);n.length<i;){var r;n.push(null!==(r=n[n.length-1])&&void 0!==r?r:ee)}}n.sort((function(e,t){return e-t}))}return n.forEach((function(e,t){n[t]=ae(e)})),n}),[de,x,ee,C,ae]),me=S.useRef(pe);me.current=pe;var fe=function(e){return x?e:e[0]},ge=function(e){var t=Us(e).sort((function(e,t){return e-t}));E&&!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Set;return function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=i.has(t);if(na(!s,"Warning: There may be circular references"),s)return!1;if(t===r)return!0;if(n&&o>1)return!1;i.add(t);var a=o+1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],r[l],a))return!1;return!0}if(t&&r&&"object"===Gs(t)&&"object"===Gs(r)){var c=Object.keys(t);return c.length===Object.keys(r).length&&c.every((function(n){return e(t[n],r[n],a)}))}return!1}(e,t)}(t,me.current,!0)&&E(fe(t)),ue(t)},ye=function(e){if(!l){var t=0,n=te-ee;pe.forEach((function(i,r){var o=Math.abs(e-i);o<=n&&(n=o,t=r)}));var i=Us(pe);i[t]=e,x&&!pe.length&&void 0===C&&i.push(e),null==M||M(fe(i)),ge(i),null==I||I(fe(i))}},ve=Ys(S.useState(null),2),be=ve[0],we=ve[1];S.useEffect((function(){if(null!==be){var e=pe.indexOf(be);e>=0&&$.current.focus(e)}we(null)}),[be]);var _e=S.useMemo((function(){return(!A||null!==ne)&&A}),[A,ne]),xe=function(e,t,n,i,r,o,s,a,l){var c=Ys(S.useState(null),2),h=c[0],d=c[1],u=Ys(S.useState(-1),2),p=u[0],m=u[1],f=Ys(S.useState(n),2),g=f[0],y=f[1],v=Ys(S.useState(n),2),b=v[0],w=v[1],_=S.useRef(null),x=S.useRef(null);S.useEffect((function(){-1===p&&y(n)}),[n,p]),S.useEffect((function(){return function(){document.removeEventListener("mousemove",_.current),document.removeEventListener("mouseup",x.current),document.removeEventListener("touchmove",_.current),document.removeEventListener("touchend",x.current)}}),[]);var C=function(e,t){g.some((function(t,n){return t!==e[n]}))&&(void 0!==t&&d(t),y(e),s(e))},E=function(e,t){if(-1===e){var n=b[0],s=b[b.length-1],a=i-n,c=r-s,h=t*(r-i);h=Math.max(h,a),h=Math.min(h,c);var d=o(n+h);h=d-n;var u=b.map((function(e){return e+h}));C(u)}else{var p=(r-i)*t,m=Us(g);m[e]=b[e];var f=l(m,p,e,"dist");C(f.values,f.value)}},M=S.useRef(E);M.current=E;var k=S.useMemo((function(){var e=Us(n).sort((function(e,t){return e-t})),t=Us(g).sort((function(e,t){return e-t}));return e.every((function(e,n){return e===t[n]}))?g:n}),[n,g]);return[p,h,k,function(i,r){i.stopPropagation();var o=n[r];m(r),d(o),w(n);var s=xa(i),a=s.pageX,l=s.pageY,c=function(n){n.preventDefault();var i,o=xa(n),s=o.pageX,c=o.pageY,h=s-a,d=c-l,u=e.current.getBoundingClientRect(),p=u.width,m=u.height;switch(t){case"btt":i=-d/m;break;case"ttb":i=d/m;break;case"rtl":i=-h/p;break;default:i=h/p}M.current(r,i)},h=function e(t){t.preventDefault(),document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",c),document.removeEventListener("touchend",e),document.removeEventListener("touchmove",c),_.current=null,x.current=null,m(-1),null==I||I(fe(me.current))};document.addEventListener("mouseup",h),document.addEventListener("mousemove",c),document.addEventListener("touchend",h),document.addEventListener("touchmove",c),_.current=c,x.current=h}]}(q,Q,pe,ee,te,ae,ge,0,le),Ce=Ys(xe,4),Ee=Ce[0],Se=Ce[1],Me=Ce[2],Ie=Ce[3],ke=function(e,t){Ie(e,t),null==M||M(fe(me.current))},Te=-1!==Ee;S.useEffect((function(){if(!Te){var e=pe.lastIndexOf(Se);$.current.focus(e)}}),[Te]);var Ne=S.useMemo((function(){return Us(Me).sort((function(e,t){return e-t}))}),[Me]),Re=Ys(S.useMemo((function(){return x?[Ne[0],Ne[Ne.length-1]]:[ee,Ne[0]]}),[Ne,x,ee]),2),Ae=Re[0],Oe=Re[1];S.useImperativeHandle(t,(function(){return{focus:function(){$.current.focus(0)},blur:function(){var e=document.activeElement;q.current.contains(e)&&(null==e||e.blur())}}})),S.useEffect((function(){d&&$.current.focus(0)}),[]);var Pe=S.useMemo((function(){return{min:ee,max:te,direction:Q,disabled:l,keyboard:h,step:ne,included:L,includedStart:Ae,includedEnd:Oe,range:x,tabIndex:Y,ariaLabelForHandle:X,ariaLabelledByForHandle:J,ariaValueTextFormatterForHandle:K}}),[ee,te,Q,l,h,ne,L,Ae,Oe,x,Y,X,J,K]);return S.createElement(pa.Provider,{value:Pe},S.createElement("div",{ref:q,className:Js()(r,o,(n={},js(n,"".concat(r,"-disabled"),l),js(n,"".concat(r,"-vertical"),P),js(n,"".concat(r,"-horizontal"),!P),js(n,"".concat(r,"-with-marks"),re.length),n)),style:s,onMouseDown:function(e){e.preventDefault();var t,n=q.current.getBoundingClientRect(),i=n.width,r=n.height,o=n.left,s=n.top,a=n.bottom,l=n.right,c=e.clientX,h=e.clientY;switch(Q){case"btt":t=(a-h)/r;break;case"ttb":t=(h-s)/r;break;case"rtl":t=(l-c)/i;break;default:t=(c-o)/i}ye(ae(ee+t*(te-ee)))}},S.createElement("div",{className:"".concat(r,"-rail"),style:F}),S.createElement(Ea,{prefixCls:r,style:Z,values:Ne,startPoint:B,onStartMove:_e?ke:null}),S.createElement(ka,{prefixCls:r,marks:re,dots:W,style:V,activeStyle:G}),S.createElement(_a,{ref:$,prefixCls:r,style:z,values:Me,draggingIndex:Ee,onStartMove:ke,onOffsetChange:function(e,t){if(!l){var n=le(pe,e,t);null==M||M(fe(pe)),ge(n.values),null==I||I(fe(n.values)),we(n.value)}},onFocus:u,onBlur:p,handleRender:H}),S.createElement(Ma,{prefixCls:r,marks:re,onClick:ye})))}));const Na=Ta,Ra="jTzuxqY7RbgAUuRVMWOw",Aa=(0,e.forwardRef)((function({baseClass:t,label:n,value:i,onChange:r,...o},s){const a=(0,e.useRef)("slider-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.BaseControl,{className:t,label:n,id:a},(0,e.createElement)(m.TextControl,{className:Ra,value:i.low,onChange:e=>r({low:e}),type:"number"}),(0,e.createElement)(Na,{range:!0,className:"wDfWo3Zfhrvqm42S1DeT",railStyle:{backgroundColor:"rgb(221, 221, 221)",height:4,borderRadius:4},trackStyle:{backgroundColor:"var(--wp-admin-theme-color, #007cba)",height:4,borderRadius:4},handleStyle:{backgroundColor:"var(--wp-admin-theme-color, #007cba)",border:"0 none",opacity:1,width:12,height:12,marginTop:-4},value:[i.low,i.high],onChange:function(e){i.high!==e[1]&&r({high:e[1]}),i.low!==e[0]&&r({low:e[0]})},...o,ref:s}),(0,e.createElement)(m.TextControl,{className:Ra,value:i.high,onChange:e=>r({high:e}),type:"number"}))})),Oa={canvas:"XjgujO6KzaHIcxfzZm6k"};function Pa({imgSize:t}){const{query:n}=d(),i=(0,e.useMemo)((()=>({name:"",description:"",meta:{initial_bounds:[],zoom:{min:1,max:2}},map:+n.map})),[n.map]),{record:r,status:o,saveRecord:s,delRecord:a}=at(n.layer,"taxonomy","imc-layer",{_fields:"id,name,meta,image_source"},i),l=it({mode:"onTouched",defaultValues:r});(0,e.useEffect)((()=>{("new"===o||"loaded"===o||l.formState.isSubmitSuccessful)&&l.reset(r)}),[o,l.formState.isSubmitSuccessful,l,r]);const[c,h]=(0,e.useState)(),u=(0,e.useRef)("img-"+Math.floor(1e8*Math.random())),p=(0,e.useRef)("map-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.Card,{className:"full-height"},(0,e.createElement)(m.CardBody,null,"none"===o&&(0,e.createElement)("h3",null,(0,f.__)("Select a layer from the list or add a new one.","image-map-connect")),"loading"===o&&(0,e.createElement)(m.Spinner,{style:{width:"100px",height:"100px"}}),("new"===o||"loaded"===o)&&(0,e.createElement)(_t,{form:l},(0,e.createElement)("h2",null,"new"===n.layer?(0,f.__)("Add Layer","image-map-connect"):(0,f.__)("Edit Layer","image-map-connect")),(0,e.createElement)("div",{className:"col-xs-9"},(0,e.createElement)(re,{name:"name",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.TextControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Name","image-map-connect"),tooltip:(0,f.__)("If the map has multiple layers, this name will show for the users in the layer selector.","image-map-connect")}),...t,className:ot(n)})}),(0,e.createElement)(re,{name:"meta.image",rules:{required:!0},render:({field:n,fieldState:i})=>(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Image","image-map-connect"),tooltip:(0,f.__)("If the map has multiple layers, make sure all the layer images are the same size.","image-map-connect")}),className:rt.field,id:u.current},(0,e.createElement)(Vs,{onChange:n.onChange,invalid:i.invalid,id:u.current,matchSize:t}))}),(0,e.createElement)(re,{name:"meta.zoom",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(Aa,{baseClass:ot(n),label:(0,e.createElement)(dt,{name:(0,f.__)("Zoom range","image-map-connect"),tooltip:(0,e.createElement)(e.Fragment,null,(0,f.__)("The zoom range defines the amount you can zoom in and out on the image.","image-map-connect"),(0,e.createElement)("br",null),(0,f.__)("The initial zoom level, will be set in each block where this map is used, along with the center.","image-map-connect"))}),min:0,max:10,allowCross:!1,value:{low:t.value.min,high:t.value.max},onChange:e=>{var n,i;t.onChange({min:null!==(n=e.low)&&void 0!==n?n:t.value.min,max:null!==(i=e.high)&&void 0!==i?i:t.value.max}),h(Object.values(e)[0])},onBlur:t.onBlur,ref:t.ref})}),(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Preview","image-map-connect"),tooltip:(0,e.createElement)(e.Fragment,null,(0,f.__)("You can pan and zoom the image preview to validate the current settings.","image-map-connect"),(0,e.createElement)("br",null),(0,f.__)("When you change the minimum or maximum zoom, this preview will automatically update.","image-map-connect"))}),className:`${rt.field} ${rt.map}`,id:p.current},(0,e.createElement)(bs,{className:`${rt.border} ${rt.input} ${Oa.canvas}`,id:p.current},(0,e.createElement)(zs,{layer:l.watch(),watchZoom:c})))),(0,e.createElement)("div",{className:"col-xs-3"},(0,e.createElement)(wt,{model:"layer",id:n.layer,onSave:s,onDelete:a,confirmDeleteText:(0,f.__)("Are you sure you want to delete this layer?")})))))}function Da(e,t){return[...e].sort(((e,n)=>t.indexOf(e.id)-t.indexOf(n.id)))}function La(){var t;const{query:n,navigate:i}=d(),{record:r}=at(n.map,"postType","imc-map",{_fields:"id,meta"}),{list:o,loading:s}=_("taxonomy","imc-layer",{post:null!==(t=+n.map)&&void 0!==t?t:0,_fields:"name,id,meta,image_source"},[n.map]),[a,l]=(0,e.useState)([]);(0,e.useEffect)((()=>{r?.meta?.layer_order&&l(Da(o,r?.meta?.layer_order))}),[o,r?.meta?.layer_order]);const{saveEntityRecord:c}=(0,g.useDispatch)(w.store),h=(0,e.useRef)({});function u(e){i({layer:e,marker:null})}return(0,e.useEffect)((()=>{h.current=o.length>1||"new"===n.layer&&o.length?{height:o[0].image_source.height,width:o[0].image_source.width}:{}}),[o,n.layer]),(0,e.createElement)(E,{list:a,titleAttr:"name",selected:+n.layer,selectItem:u,loading:s&&!(o&&o.length),addButton:(0,e.createElement)(m.Button,{variant:"primary",className:"medium",onClick:()=>u("new")},(0,f.__)("Add Layer")),sortable:!0,onChangeOrder:function(e){l(Da(o,e)),c("postType","imc-map",{id:r.id,meta:{layer_order:e}})}},(0,e.createElement)(Pa,{imgSize:h}))}function Ba({marker:t,save:n,delete:i}){const{query:r}=d();async function o(e){const t=await n(e);return"imc-marker"!==t?.type&&(0,g.dispatch)(w.store).receiveEntityRecords("postType","imc-marker",[],{},!0),t}return(0,e.createElement)(wt,{model:"marker",id:r.marker,onDelete:async function(){let e;return e="imc-marker"===t.type?await i():await o({id:t.id,imc_loc:{},imc_icons:[],imc_layers:[]}),e},onSave:o,confirmDeleteText:(0,f.__)("Are you sure you want to delete this marker?","image-map-connect")+" "+("imc-marker"===t.type?(0,f.__)("This will remove the marker and all its content.","image-map-connect"):(0,f.__)("This will remove the marker. The related post will not be removed","image-map-connect"))})}function Za({label:t,value:n,onSelect:i,onBlur:r,icons:o,className:s}){const a=(0,e.useMemo)((()=>{var t;return null!==(t=o?.map((t=>({key:t.id,name:(0,e.createElement)("span",null,(0,e.createElement)("i",{className:t.img.ref,style:{color:t.colour}}),(0,e.createElement)("span",{className:rt.iconName},t.name))}))))&&void 0!==t?t:[]}),[o]);return(0,e.createElement)("div",{className:s},(0,e.createElement)(m.CustomSelectControl,{label:t,value:a.find((e=>e.key===n)),onChange:e=>i(e.selectedItem.key),onBlur:r,options:null!=a?a:{name:"Loading..."},__nextUnconstrainedWidth:!0}))}function za(e){this.content=e}za.prototype={constructor:za,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var i=n&&n!=e?this.remove(n):this,r=i.find(e),o=i.content.slice();return-1==r?o.push(n||e,t):(o[r+1]=t,n&&(o[r]=n)),new za(o)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new za(n)},addToStart:function(e,t){return new za([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new za(n)},addBefore:function(e,t,n){var i=this.remove(t),r=i.content.slice(),o=i.find(e);return r.splice(-1==o?r.length:o,0,t,n),new za(r)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=za.from(e)).size?new za(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=za.from(e)).size?new za(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=za.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},za.from=function(e){if(e instanceof za)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new za(t)};const Fa=za;function Va(e,t,n){for(let i=0;;i++){if(i==e.childCount||i==t.childCount)return e.childCount==t.childCount?null:n;let r=e.child(i),o=t.child(i);if(r!=o){if(!r.sameMarkup(o))return n;if(r.isText&&r.text!=o.text){for(let e=0;r.text[e]==o.text[e];e++)n++;return n}if(r.content.size||o.content.size){let e=Va(r.content,o.content,n+1);if(null!=e)return e}n+=r.nodeSize}else n+=r.nodeSize}}function Ga(e,t,n,i){for(let r=e.childCount,o=t.childCount;;){if(0==r||0==o)return r==o?null:{a:n,b:i};let s=e.child(--r),a=t.child(--o),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:i};if(s.isText&&s.text!=a.text){let e=0,t=Math.min(s.text.length,a.text.length);for(;e<t&&s.text[s.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,i--;return{a:n,b:i}}if(s.content.size||a.content.size){let e=Ga(s.content,a.content,n-1,i-1);if(e)return e}n-=l,i-=l}else n-=l,i-=l}}class ja{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,i=0,r){for(let o=0,s=0;s<t;o++){let a=this.content[o],l=s+a.nodeSize;if(l>e&&!1!==n(a,i+s,r||null,o)&&a.content.size){let r=s+1;a.nodesBetween(Math.max(0,e-r),Math.min(a.content.size,t-r),n,i+r)}s=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let r="",o=!0;return this.nodesBetween(e,t,((s,a)=>{s.isText?(r+=s.text.slice(Math.max(e,a)-a,t-a),o=!n):s.isLeaf?(i?r+="function"==typeof i?i(s):i:s.type.spec.leafText&&(r+=s.type.spec.leafText(s)),o=!n):!o&&s.isBlock&&(r+=n,o=!0)}),0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),r=1);r<e.content.length;r++)i.push(e.content[r]);return new ja(i,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],i=0;if(t>e)for(let r=0,o=0;o<t;r++){let s=this.content[r],a=o+s.nodeSize;a>e&&((o<e||a>t)&&(s=s.isText?s.cut(Math.max(0,e-o),Math.min(s.text.length,t-o)):s.cut(Math.max(0,e-o-1),Math.min(s.content.size,t-o-1))),n.push(s),i+=s.nodeSize),o=a}return new ja(n,i)}cutByIndex(e,t){return e==t?ja.empty:0==e&&t==this.content.length?this:new ja(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),r=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ja(i,r)}addToStart(e){return new ja([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ja(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return Va(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Ga(this,e,t,n)}findIndex(e,t=-1){if(0==e)return Ha(0,e);if(e==this.size)return Ha(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=i+this.child(n).nodeSize;if(r>=e)return r==e||t>0?Ha(n+1,r):Ha(n,i);i=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return ja.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ja(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ja.empty;let t,n=0;for(let i=0;i<e.length;i++){let r=e[i];n+=r.nodeSize,i&&r.isText&&e[i-1].sameMarkup(r)?(t||(t=e.slice(0,i)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new ja(t||e,n)}static from(e){if(!e)return ja.empty;if(e instanceof ja)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ja([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ja.empty=new ja([],0);const Wa={index:0,offset:0};function Ha(e,t){return Wa.index=e,Wa.offset=t,Wa}function Ua(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!Ua(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!Ua(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}class Ya{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let r=e[i];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,i));else{if(r.type.excludes(this.type))return e;!n&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(r)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Ua(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return Ya.none;if(e instanceof Ya)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}Ya.none=[];class Xa extends Error{}class Ja{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=$a(this.content,e+this.openStart,t);return n&&new Ja(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Ja(Ka(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Ja.empty;let n=t.openStart||0,i=t.openEnd||0;if("number"!=typeof n||"number"!=typeof i)throw new RangeError("Invalid input for Slice.fromJSON");return new Ja(ja.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)n++;for(let n=e.lastChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.lastChild)i++;return new Ja(e,n,i)}}function Ka(e,t,n){let{index:i,offset:r}=e.findIndex(t),o=e.maybeChild(i),{index:s,offset:a}=e.findIndex(n);if(r==t||o.isText){if(a!=n&&!e.child(s).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(i!=s)throw new RangeError("Removing non-flat range");return e.replaceChild(i,o.copy(Ka(o.content,t-r-1,n-r-1)))}function $a(e,t,n,i){let{index:r,offset:o}=e.findIndex(t),s=e.maybeChild(r);if(o==t||s.isText)return i&&!i.canReplace(r,r,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=$a(s.content,t-o-1,n);return a&&e.replaceChild(r,s.copy(a))}function qa(e,t,n){if(n.openStart>e.depth)throw new Xa("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new Xa("Inconsistent open depths");return Qa(e,t,n,0)}function Qa(e,t,n,i){let r=e.index(i),o=e.node(i);if(r==t.index(i)&&i<e.depth-n.openStart){let s=Qa(e,t,n,i+1);return o.copy(o.content.replaceChild(r,s))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=i||t.depth!=i){let{start:r,end:s}=function(e,t){let n=t.depth-e.openStart,i=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)i=t.node(e).copy(ja.from(i));return{start:i.resolveNoCache(e.openStart+n),end:i.resolveNoCache(i.content.size-e.openEnd-n)}}(n,e);return rl(o,ol(e,r,s,t,i))}{let i=e.parent,r=i.content;return rl(i,r.cut(0,e.parentOffset).append(n.content).append(r.cut(t.parentOffset)))}}return rl(o,sl(e,t,i))}function el(e,t){if(!t.type.compatibleContent(e.type))throw new Xa("Cannot join "+t.type.name+" onto "+e.type.name)}function tl(e,t,n){let i=e.node(n);return el(i,t.node(n)),i}function nl(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function il(e,t,n,i){let r=(t||e).node(n),o=0,s=t?t.index(n):r.childCount;e&&(o=e.index(n),e.depth>n?o++:e.textOffset&&(nl(e.nodeAfter,i),o++));for(let e=o;e<s;e++)nl(r.child(e),i);t&&t.depth==n&&t.textOffset&&nl(t.nodeBefore,i)}function rl(e,t){return e.type.checkContent(t),e.copy(t)}function ol(e,t,n,i,r){let o=e.depth>r&&tl(e,t,r+1),s=i.depth>r&&tl(n,i,r+1),a=[];return il(null,e,r,a),o&&s&&t.index(r)==n.index(r)?(el(o,s),nl(rl(o,ol(e,t,n,i,r+1)),a)):(o&&nl(rl(o,sl(e,t,r+1)),a),il(t,n,r,a),s&&nl(rl(s,sl(n,i,r+1)),a)),il(i,null,r,a),new ja(a)}function sl(e,t,n){let i=[];return il(null,e,n,i),e.depth>n&&nl(rl(tl(e,t,n+1),sl(e,t,n+1)),i),il(t,null,n,i),new ja(i)}Ja.empty=new Ja(ja.empty,0,0);class al{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],i=0==t?0:this.path[3*t-1]+1;for(let t=0;t<e;t++)i+=n.child(t).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return Ya.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let e=n;n=i,i=e}let r=n.marks;for(var o=0;o<r.length;o++)!1!==r[o].type.spec.inclusive||i&&r[o].isInSet(i.marks)||(r=r[o--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||i&&n[r].isInSet(i.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new dl(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,r=t;for(let t=e;;){let{index:e,offset:o}=t.content.findIndex(r),s=r-o;if(n.push(t,e,i+o),!s)break;if(t=t.child(e),t.isText)break;r=s-1,i+=o+1}return new al(t,n,r)}static resolveCached(e,t){for(let n=0;n<ll.length;n++){let i=ll[n];if(i.pos==t&&i.doc==e)return i}let n=ll[cl]=al.resolve(e,t);return cl=(cl+1)%hl,n}}let ll=[],cl=0,hl=12;class dl{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ul=Object.create(null);class pl{constructor(e,t,n,i=Ya.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||ja.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Ua(this.attrs,t||e.defaultAttrs||ul)&&Ya.sameSet(this.marks,n||Ya.none)}copy(e=null){return e==this.content?this:new pl(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new pl(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ja.empty;let i=this.resolve(e),r=this.resolve(t),o=n?0:i.sharedDepth(t),s=i.start(o),a=i.node(o).content.cut(i.pos-s,r.pos-s);return new Ja(a,i.depth-o,r.depth-o)}replace(e,t,n){return qa(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return al.resolveCached(this,e)}resolveNoCache(e){return al.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(i=!0),!i))),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),fl(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=ja.empty,i=0,r=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,r),s=o&&o.matchFragment(this.content,t);if(!s||!s.validEnd)return!1;for(let e=i;e<r;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(e).matchType(n),o=r&&r.matchFragment(this.content,t);return!!o&&o.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=Ya.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!Ya.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=ja.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,n)}}pl.prototype.text=void 0;class ml extends pl{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):fl(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new ml(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new ml(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function fl(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class gl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new yl(e,t);if(null==n.next)return gl.empty;let i=vl(n);n.next&&n.err("Unexpected trailing text");let r=function(e){let t=Object.create(null);return function n(i){let r=[];i.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let i;for(let e=0;e<r.length;e++)r[e][0]==t&&(i=r[e][1]);El(e,n).forEach((e=>{i||r.push([t,i=[]]),-1==i.indexOf(e)&&i.push(e)}))}))}));let o=t[i.join(",")]=new gl(i.indexOf(e.length-1)>-1);for(let e=0;e<r.length;e++){let i=r[e][1].sort(Cl);o.next.push({type:r[e][0],next:t[i.join(",")]||n(i)})}return o}(El(e,0))}(function(e){let t=[[]];return r(function e(t,o){if("choice"==t.type)return t.exprs.reduce(((t,n)=>t.concat(e(n,o))),[]);if("seq"!=t.type){if("star"==t.type){let s=n();return i(o,s),r(e(t.expr,s),s),[i(s)]}if("plus"==t.type){let s=n();return r(e(t.expr,o),s),r(e(t.expr,s),s),[i(s)]}if("opt"==t.type)return[i(o)].concat(e(t.expr,o));if("range"==t.type){let s=o;for(let i=0;i<t.min;i++){let i=n();r(e(t.expr,s),i),s=i}if(-1==t.max)r(e(t.expr,s),s);else for(let o=t.min;o<t.max;o++){let o=n();i(s,o),r(e(t.expr,s),o),s=o}return[i(s)]}if("name"==t.type)return[i(o,void 0,t.value)];throw new Error("Unknown expr type")}for(let i=0;;i++){let s=e(t.exprs[i],o);if(i==t.exprs.length-1)return s;r(s,o=n())}}(e,0),n()),t;function n(){return t.push([])-1}function i(e,n,i){let r={term:i,to:n};return t[e].push(r),r}function r(e,t){e.forEach((e=>e.to=t))}}(i));return function(e,t){for(let n=0,i=[e];n<i.length;n++){let e=i[n],r=!e.validEnd,o=[];for(let t=0;t<e.next.length;t++){let{type:n,next:s}=e.next[t];o.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==i.indexOf(s)&&i.push(s)}r&&t.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let r=t;i&&r<n;r++)i=i.matchType(e.child(r).type);return i}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];return function r(o,s){let a=o.matchFragment(e,n);if(a&&(!t||a.validEnd))return ja.from(s.map((e=>e.createAndFill())));for(let e=0;e<o.next.length;e++){let{type:t,next:n}=o.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==i.indexOf(n)){i.push(n);let e=r(n,s.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),r=i.match;if(r.matchType(e)){let e=[];for(let t=i;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<r.next.length;e++){let{type:o,next:s}=r.next[e];o.isLeaf||o.hasRequiredAttrs()||o.name in t||i.type&&!s.validEnd||(n.push({match:o.contentMatch,type:o,via:i}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let i=0;i<n.next.length;i++)-1==e.indexOf(n.next[i].next)&&t(n.next[i].next)}(this),e.map(((t,n)=>{let i=n+(t.validEnd?"*":" ")+" ";for(let n=0;n<t.next.length;n++)i+=(n?", ":"")+t.next[n].type.name+"->"+e.indexOf(t.next[n].next);return i})).join("\n")}}gl.empty=new gl(!0);class yl{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function vl(e){let t=[];do{t.push(bl(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function bl(e){let t=[];do{t.push(wl(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function wl(e){let t=function(e){if(e.eat("(")){let t=vl(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,i=n[t];if(i)return[i];let r=[];for(let e in n){let i=n[e];i.groups.indexOf(t)>-1&&r.push(i)}return 0==r.length&&e.err("No node type or group '"+t+"' found"),r}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=xl(e,t)}return t}function _l(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function xl(e,t){let n=_l(e),i=n;return e.eat(",")&&(i="}"!=e.next?_l(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:i,expr:t}}function Cl(e,t){return t-e}function El(e,t){let n=[];return function t(i){let r=e[i];if(1==r.length&&!r[0].term)return t(r[0].to);n.push(i);for(let e=0;e<r.length;e++){let{term:i,to:o}=r[e];i||-1!=n.indexOf(o)||t(o)}}(t),n.sort(Cl)}function Sl(e){let t=Object.create(null);for(let n in e){let i=e[n];if(!i.hasDefault)return null;t[n]=i.default}return t}function Ml(e,t){let n=Object.create(null);for(let i in e){let r=t&&t[i];if(void 0===r){let t=e[i];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+i);r=t.default}n[i]=r}return n}function Il(e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Tl(e[n]);return t}class kl{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Il(n.attrs),this.defaultAttrs=Sl(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==gl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Ml(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new pl(this,this.computeAttrs(e),ja.from(t),Ya.setFrom(n))}createChecked(e=null,t,n){return t=ja.from(t),this.checkContent(t),new pl(this,this.computeAttrs(e),t,Ya.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=ja.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let i=this.contentMatch.matchFragment(t),r=i&&i.fillBefore(ja.empty,!0);return r?new pl(this,e,t.append(r),Ya.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Ya.none:e}static compile(e,t){let n=Object.create(null);e.forEach(((e,i)=>n[e]=new kl(e,t,i)));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let e in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Tl{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Nl{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Il(i.attrs),this.excluded=null;let r=Sl(this.attrs);this.instance=r?new Ya(this,r):null}create(e=null){return!e&&this.instance?this.instance:new Ya(this,Ml(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach(((e,r)=>n[e]=new Nl(e,i++,t,r))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class Rl{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=Fa.from(e.nodes),t.marks=Fa.from(e.marks||{}),this.nodes=kl.compile(this.spec.nodes,this),this.marks=Nl.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw new RangeError(e+" can not be both a node and a mark");let t=this.nodes[e],i=t.spec.content||"",r=t.spec.marks;t.contentMatch=n[i]||(n[i]=gl.parse(i,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==r?null:r?Al(this,r.split(" ")):""!=r&&t.inlineContent?null:[]}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=null==n?[t]:""==n?[]:Al(this,n.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof kl))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new ml(n,n.defaultAttrs,e,Ya.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return pl.fromJSON(this,e)}markFromJSON(e){return Ya.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Al(e,t){let n=[];for(let i=0;i<t.length;i++){let r=t[i],o=e.marks[r],s=o;if(o)n.push(o);else for(let t in e.marks){let i=e.marks[t];("_"==r||i.spec.group&&i.spec.group.split(" ").indexOf(r)>-1)&&n.push(s=i)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return n}class Ol{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{e.tag?this.tags.push(e):e.style&&this.styles.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new zl(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new zl(this,t,!0);return n.addAll(e,t.from,t.to),Ja.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let n=this.tags[i];if(Fl(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let i=this.styles[r],o=i.style;if(!(0!=o.indexOf(e)||i.context&&!n.matchesContext(i.context)||o.length>e.length&&(61!=o.charCodeAt(e.length)||o.slice(e.length+1)!=t))){if(i.getAttrs){let e=i.getAttrs(t);if(!1===e)continue;i.attrs=e||void 0}return i}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,i=0;for(;i<t.length;i++){let e=t[i];if((null==e.priority?50:e.priority)<n)break}t.splice(i,0,e)}for(let t in e.marks){let i=e.marks[t].spec.parseDOM;i&&i.forEach((e=>{n(e=Vl(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)}))}for(let t in e.nodes){let i=e.nodes[t].spec.parseDOM;i&&i.forEach((e=>{n(e=Vl(e)),e.node||e.ignore||e.mark||(e.node=t)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ol(e,Ol.schemaRules(e)))}}const Pl={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Dl={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ll={ol:!0,ul:!0};function Bl(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class Zl{constructor(e,t,n,i,r,o,s){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=i,this.solid=r,this.options=s,this.content=[],this.activeMarks=Ya.none,this.stashMarks=[],this.match=o||(4&s?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(ja.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=ja.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(ja.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let i=n[t];(this.type?this.type.allowsMarkType(i.type):Gl(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Pl.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class zl{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let i,r=t.topNode,o=Bl(null,t.preserveWhitespace,0)|(n?4:0);i=r?new Zl(r.type,r.attrs,Ya.none,Ya.none,!0,t.topMatch||r.type.contentMatch,o):new Zl(n?null:e.schema.topNodeType,null,Ya.none,Ya.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){3==e.nodeType?this.addTextNode(e):1==e.nodeType&&this.addElement(e)}withStyleRules(e,t){let n=e.getAttribute("style");if(!n)return t();let i=this.readStyles(function(e){let t,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,i=[];for(;t=n.exec(e);)i.push(t[1],t[2].trim());return i}(n));if(!i)return;let[r,o]=i,s=this.top;for(let e=0;e<o.length;e++)this.removePendingMark(o[e],s);for(let e=0;e<r.length;e++)this.addPendingMark(r[e]);t();for(let e=0;e<r.length;e++)this.removePendingMark(r[e],s);for(let e=0;e<o.length;e++)this.addPendingMark(o[e])}addTextNode(e){let t=e.nodeValue,n=this.top;if(2&n.options||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(1&n.options)t=2&n.options?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],r=e.previousSibling;(!i||r&&"BR"==r.nodeName||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n,i=e.nodeName.toLowerCase();Ll.hasOwnProperty(i)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&Ll.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let r=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(n=this.parser.matchTag(e,this,t));if(r?r.ignore:Dl.hasOwnProperty(i))this.findInside(e),this.ignoreFallback(e);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(e=r.skip);let t,n=this.top,o=this.needsBlock;if(Pl.hasOwnProperty(i))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),t=!0,n.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);r&&r.skip?this.addAll(e):this.withStyleRules(e,(()=>this.addAll(e))),t&&this.sync(n),this.needsBlock=o}else this.withStyleRules(e,(()=>{this.addElementByRule(e,r,!1===r.consuming?n:void 0)}))}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=Ya.none,n=Ya.none;for(let i=0;i<e.length;i+=2)for(let r;;){let o=this.parser.matchStyle(e[i],e[i+1],this,r);if(!o)break;if(o.ignore)return null;if(o.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach((e=>{o.clearMark(e)&&(n=e.addToSet(n))})):t=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(t),!1!==o.consuming)break;r=o}return[t,n]}addElementByRule(e,t,n){let i,r,o;t.node?(r=this.parser.schema.nodes[t.node],r.isLeaf?this.insertNode(r.create(t.attrs))||this.leafFallback(e):i=this.enter(r,t.attrs||null,t.preserveWhitespace)):(o=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(o));let s=this.top;if(r&&r.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let n=e;"string"==typeof t.contentElement?n=e.querySelector(t.contentElement):"function"==typeof t.contentElement?n=t.contentElement(e):t.contentElement&&(n=t.contentElement),this.findAround(e,n,!0),this.addAll(n)}i&&this.sync(s)&&this.open--,o&&this.removePendingMark(o,s)}addAll(e,t,n){let i=t||0;for(let r=t?e.childNodes[t]:e.firstChild,o=null==n?null:e.childNodes[n];r!=o;r=r.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(r);this.findAtPoint(e,i)}findPlace(e){let t,n;for(let i=this.open;i>=0;i--){let r=this.nodes[i],o=r.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,n=r,!o.length))break;if(r.solid)break}if(!t)return!1;this.sync(n);for(let e=0;e<t.length;e++)this.enterInner(t[e],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let i=0;i<e.marks.length;i++)t.type&&!t.type.allowsMarkType(e.marks[i].type)||(n=e.marks[i].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,n),i}enterInner(e,t=null,n=!1,i){this.closeExtra();let r=this.top;r.applyPending(e),r.match=r.match&&r.match.matchType(e);let o=Bl(e,i,r.options);4&r.options&&0==r.content.length&&(o|=4),this.nodes.push(new Zl(e,t,r.activeMarks,r.pendingMarks,n,null,o)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==e.nodeType&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),o=(e,s)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;s>=r;s--)if(o(e-1,s))return!0;return!1}{let e=s>0||0==s&&i?this.nodes[s].type:n&&s>=r?n.node(s-r).type:null;if(!e||e.name!=a&&-1==e.groups.indexOf(a))return!1;s--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(e){let t=function(e,t){for(let n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let t=i.popFromStashMark(e);t&&i.type&&i.type.allowsMarkType(t.type)&&(i.activeMarks=t.addToSet(i.activeMarks))}if(i==t)break}}}function Fl(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Vl(e){let t={};for(let n in e)t[n]=e[n];return t}function Gl(e,t){let n=t.schema.nodes;for(let i in n){let r=n[i];if(!r.allowsMarkType(e))continue;let o=[],s=e=>{o.push(e);for(let n=0;n<e.edgeCount;n++){let{type:i,next:r}=e.edge(n);if(i==t)return!0;if(o.indexOf(r)<0&&s(r))return!0}};if(s(r.contentMatch))return!0}}class jl{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=Hl(t).createDocumentFragment());let i=n,r=[];return e.forEach((e=>{if(r.length||e.marks.length){let n=0,o=0;for(;n<r.length&&o<e.marks.length;){let t=e.marks[o];if(this.marks[t.type.name]){if(!t.eq(r[n][0])||!1===t.type.spec.spanning)break;n++,o++}else o++}for(;n<r.length;)i=r.pop()[1];for(;o<e.marks.length;){let n=e.marks[o++],s=this.serializeMark(n,e.isInline,t);s&&(r.push([n,i]),i.appendChild(s.dom),i=s.contentDOM||s.dom)}}i.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=jl.renderSpec(Hl(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let r=this.serializeMark(e.marks[i],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&jl.renderSpec(Hl(n),i(e,t))}static renderSpec(e,t,n=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let i,r=t[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));let s=n?e.createElementNS(n,r):e.createElement(r),a=t[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let e in a)if(null!=a[e]){let t=e.indexOf(" ");t>0?s.setAttributeNS(e.slice(0,t),e.slice(t+1),a[e]):s.setAttribute(e,a[e])}}for(let r=l;r<t.length;r++){let o=t[r];if(0===o){if(r<t.length-1||r>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}{let{dom:t,contentDOM:r}=jl.renderSpec(e,o,n);if(s.appendChild(t),r){if(i)throw new RangeError("Multiple content holes");i=r}}}return{dom:s,contentDOM:i}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new jl(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Wl(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return Wl(e.marks)}}function Wl(e){let t={};for(let n in e){let i=e[n].spec.toDOM;i&&(t[n]=i)}return t}function Hl(e){return e.document||window.document}const Ul=Math.pow(2,16);function Yl(e){return 65535&e}class Xl{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class Jl{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Jl.empty)return Jl.empty}recover(e){let t=0,n=Yl(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/Ul}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,r=this.inverted?2:1,o=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?i:0);if(a>e)break;let l=this.ranges[s+r],c=this.ranges[s+o],h=a+l;if(e<=h){let r=a+i+((l?e==a?-1:e==h?1:t:t)<0?0:c);if(n)return r;let o=e==(t<0?a:h)?null:s/3+(e-a)*Ul,d=e==a?2:e==h?1:4;return(t<0?e!=a:e!=h)&&(d|=8),new Xl(r,d,o)}i+=c-l}return n?e+i:new Xl(e+i,0,null)}touches(e,t){let n=0,i=Yl(t),r=this.inverted?2:1,o=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let s=this.ranges[t]-(this.inverted?n:0);if(s>e)break;let a=this.ranges[t+r];if(e<=s+a&&t==3*i)return!0;n+=this.ranges[t+o]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let o=this.ranges[i],s=o-(this.inverted?r:0),a=o+(this.inverted?0:r),l=this.ranges[i+t],c=this.ranges[i+n];e(s,s+l,a,a+c),r+=c-l}}invert(){return new Jl(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?Jl.empty:new Jl(e<0?[0,-e,0]:[0,0,e])}}Jl.empty=new Jl([]);class Kl{constructor(e=[],t,n=0,i=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=i}slice(e=0,t=this.maps.length){return new Kl(this.maps,this.mirror,e,t)}copy(){return new Kl(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],null!=i&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=i&&i>t?n-i-1:void 0)}}invert(){let e=new Kl;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let n=this.from;n<this.to;n++){let r=this.maps[n].mapResult(e,t);if(null!=r.recover){let t=this.getMirror(n);if(null!=t&&t>n&&t<this.to){n=t,e=this.maps[t].recover(r.recover);continue}}i|=r.delInfo,e=r.pos}return n?e:new Xl(e,i,null)}}const $l=Object.create(null);class ql{getMap(){return Jl.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=$l[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in $l)throw new RangeError("Duplicate use of step JSON ID "+e);return $l[e]=t,t.prototype.jsonID=e,t}}class Ql{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Ql(e,null)}static fail(e){return new Ql(null,e)}static fromReplace(e,t,n,i){try{return Ql.ok(e.replace(t,n,i))}catch(e){if(e instanceof Xa)return Ql.fail(e.message);throw e}}}function ec(e,t,n){let i=[];for(let r=0;r<e.childCount;r++){let o=e.child(r);o.content.size&&(o=o.copy(ec(o.content,t,o))),o.isInline&&(o=t(o,n,r)),i.push(o)}return ja.fromArray(i)}class tc extends ql{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),r=new Ja(ec(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),i),t.openStart,t.openEnd);return Ql.fromReplace(e,this.from,this.to,r)}invert(){return new nc(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new tc(t.pos,n.pos,this.mark)}merge(e){return e instanceof tc&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new tc(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new tc(t.from,t.to,e.markFromJSON(t.mark))}}ql.jsonID("addMark",tc);class nc extends ql{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ja(ec(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return Ql.fromReplace(e,this.from,this.to,n)}invert(){return new tc(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new nc(t.pos,n.pos,this.mark)}merge(e){return e instanceof nc&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new nc(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new nc(t.from,t.to,e.markFromJSON(t.mark))}}ql.jsonID("removeMark",nc);class ic extends ql{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ql.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Ql.fromReplace(e,this.pos,this.pos+1,new Ja(ja.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new ic(this.pos,t.marks[n]);return new ic(this.pos,this.mark)}}return new rc(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ic(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ic(t.pos,e.markFromJSON(t.mark))}}ql.jsonID("addNodeMark",ic);class rc extends ql{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ql.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Ql.fromReplace(e,this.pos,this.pos+1,new Ja(ja.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new ic(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new rc(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new rc(t.pos,e.markFromJSON(t.mark))}}ql.jsonID("removeNodeMark",rc);class oc extends ql{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&ac(e,this.from,this.to)?Ql.fail("Structure replace would overwrite content"):Ql.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Jl([this.from,this.to-this.from,this.slice.size])}invert(e){return new oc(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new oc(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof oc)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?Ja.empty:new Ja(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new oc(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?Ja.empty:new Ja(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new oc(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new oc(t.from,t.to,Ja.fromJSON(e,t.slice),!!t.structure)}}ql.jsonID("replace",oc);class sc extends ql{constructor(e,t,n,i,r,o,s=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=r,this.insert=o,this.structure=s}apply(e){if(this.structure&&(ac(e,this.from,this.gapFrom)||ac(e,this.gapTo,this.to)))return Ql.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Ql.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Ql.fromReplace(e,this.from,this.to,n):Ql.fail("Content does not fit in gap")}getMap(){return new Jl([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new sc(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),r=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||r>n.pos?null:new sc(t.pos,n.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new sc(t.from,t.to,t.gapFrom,t.gapTo,Ja.fromJSON(e,t.slice),t.insert,!!t.structure)}}function ac(e,t,n){let i=e.resolve(t),r=n-t,o=i.depth;for(;r>0&&o>0&&i.indexAfter(o)==i.node(o).childCount;)o--,r--;if(r>0){let e=i.node(o).maybeChild(i.indexAfter(o));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function lc(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function cc(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let i=e.$from.node(n),r=e.$from.index(n),o=e.$to.indexAfter(n);if(n<e.depth&&i.canReplace(r,o,t))return n;if(0==n||i.type.spec.isolating||!lc(i,r,o))break}return null}function hc(e,t,n=null,i=e){let r=function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,o=n.contentMatchAt(i).findWrapping(t);if(!o)return null;let s=o.length?o[0]:t;return n.canReplaceWith(i,r,s)?o:null}(e,t),o=r&&function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,o=n.child(i),s=t.contentMatch.findWrapping(o.type);if(!s)return null;let a=(s.length?s[s.length-1]:t).contentMatch;for(let e=i;a&&e<r;e++)a=a.matchType(n.child(e).type);return a&&a.validEnd?s:null}(i,t);return o?r.map(dc).concat({type:t,attrs:n}).concat(o.map(dc)):null}function dc(e){return{type:e,attrs:null}}function uc(e,t,n=1,i){let r=e.resolve(t),o=r.depth-n,s=i&&i[i.length-1]||r.parent;if(o<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!s.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let e=r.depth-1,t=n-2;e>o;e--,t--){let n=r.node(e),o=r.index(e);if(n.type.spec.isolating)return!1;let s=n.content.cutByIndex(o,n.childCount),a=i&&i[t+1];a&&(s=s.replaceChild(0,a.type.create(a.attrs)));let l=i&&i[t]||n;if(!n.canReplace(o+1,n.childCount)||!l.type.validContent(s))return!1}let a=r.indexAfter(o),l=i&&i[0];return r.node(o).canReplaceWith(a,a,l?l.type:r.node(o+1).type)}function pc(e,t){let n=e.resolve(t),i=n.index();return mc(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(i,i+1)}function mc(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function fc(e,t,n=-1){let i=e.resolve(t);for(let e=i.depth;;e--){let r,o,s=i.index(e);if(e==i.depth?(r=i.nodeBefore,o=i.nodeAfter):n>0?(r=i.node(e+1),s++,o=i.node(e).maybeChild(s)):(r=i.node(e).maybeChild(s-1),o=i.node(e+1)),r&&!r.isTextblock&&mc(r,o)&&i.node(e).canReplace(s,s+1))return t;if(0==e)break;t=n<0?i.before(e):i.after(e)}}function gc(e,t,n){let i=e.resolve(t);if(!n.content.size)return t;let r=n.content;for(let e=0;e<n.openStart;e++)r=r.firstChild.content;for(let e=1;e<=(0==n.openStart&&n.size?2:1);e++)for(let t=i.depth;t>=0;t--){let n=t==i.depth?0:i.pos<=(i.start(t+1)+i.end(t+1))/2?-1:1,o=i.index(t)+(n>0?1:0),s=i.node(t),a=!1;if(1==e)a=s.canReplace(o,o,r);else{let e=s.contentMatchAt(o).findWrapping(r.firstChild.type);a=e&&s.canReplaceWith(o,o,e[0])}if(a)return 0==n?i.pos:n<0?i.before(t+1):i.after(t+1)}return null}function yc(e,t,n=t,i=Ja.empty){if(t==n&&!i.size)return null;let r=e.resolve(t),o=e.resolve(n);return vc(r,o,i)?new oc(t,n,i):new bc(r,o,i).fit()}function vc(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}ql.jsonID("replaceAround",sc);class bc{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=ja.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=ja.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let r=this.placed,o=n.depth,s=i.depth;for(;o&&s&&1==r.childCount;)r=r.firstChild.content,o--,s--;let a=new Ja(r,o,s);return e>-1?new sc(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new oc(n.pos,i.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(i=0),r.type.spec.isolating&&i<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,i=null;n?(i=xc(this.unplaced.content,n-1).firstChild,e=i.content):e=this.unplaced.content;let r=e.firstChild;for(let e=this.depth;e>=0;e--){let o,{type:s,match:a}=this.frontier[e],l=null;if(1==t&&(r?a.matchType(r.type)||(l=a.fillBefore(ja.from(r),!1)):i&&s.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:e,parent:i,inject:l};if(2==t&&r&&(o=a.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:e,parent:i,wrap:o};if(i&&a.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=xc(e,t);return!(!i.childCount||i.firstChild.isLeaf||(this.unplaced=new Ja(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),0))}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=xc(e,t);if(i.childCount<=1&&t>0){let r=e.size-t<=t+i.size;this.unplaced=new Ja(wc(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new Ja(wc(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let e=0;e<r.length;e++)this.openFrontierNode(r[e]);let o=this.unplaced,s=n?n.content:o.content,a=o.openStart-e,l=0,c=[],{match:h,type:d}=this.frontier[t];if(i){for(let e=0;e<i.childCount;e++)c.push(i.child(e));h=h.matchFragment(i)}let u=s.size+e-(o.content.size-o.openEnd);for(;l<s.childCount;){let e=s.child(l),t=h.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(h=t,c.push(Cc(e.mark(d.allowedMarks(e.marks)),1==l?a:0,l==s.childCount?u:-1)))}let p=l==s.childCount;p||(u=-1),this.placed=_c(this.placed,t,ja.from(c)),this.frontier[t].match=h,p&&u<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=s;e<u;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=p?0==e?Ja.empty:new Ja(wc(o.content,e-1,1),e-1,u<0?o.openEnd:e-1):new Ja(wc(o.content,e,l),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Ec(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=Ec(e,t,i,n,r);if(o){for(let n=t-1;n>=0;n--){let{match:t,type:i}=this.frontier[n],r=Ec(e,n,i,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:o,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=_c(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),i=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,i)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=_c(this.placed,this.depth,ja.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(ja.empty,!0);e.childCount&&(this.placed=_c(this.placed,this.frontier.length,e))}}function wc(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(wc(e.firstChild.content,t-1,n)))}function _c(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(_c(e.lastChild.content,t-1,n)))}function xc(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Cc(e,t,n){if(t<=0)return e;let i=e.content;return t>1&&(i=i.replaceChild(0,Cc(i.firstChild,t-1,1==i.childCount?n-1:0))),t>0&&(i=e.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(ja.empty,!0)))),e.copy(i)}function Ec(e,t,n,i,r){let o=e.node(t),s=r?e.indexAfter(t):e.index(t);if(s==o.childCount&&!n.compatibleContent(o.type))return null;let a=i.fillBefore(o.content,!0,s);return a&&!function(e,t,n){for(let i=n;i<t.childCount;i++)if(!e.allowsMarks(t.child(i).marks))return!0;return!1}(n,o.content,s)?a:null}function Sc(e){return e.spec.defining||e.spec.definingForContent}function Mc(e,t,n,i,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(Mc(r.content,t+1,n,i,r)))}if(t>i){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(ja.empty,!0))}return e}function Ic(e,t){let n=[];for(let i=Math.min(e.depth,t.depth);i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}class kc extends ql{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ql.fail("No node at attribute step's position");let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return Ql.fromReplace(e,this.pos,this.pos+1,new Ja(ja.from(i),0,t.isLeaf?0:1))}getMap(){return Jl.empty}invert(e){return new kc(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new kc(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new kc(t.pos,t.attr,t.value)}}ql.jsonID("attr",kc);let Tc=class extends Error{};Tc=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Tc.prototype=Object.create(Error.prototype)).constructor=Tc,Tc.prototype.name="TransformError";class Nc{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Kl}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Tc(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ja.empty){let i=yc(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Ja(ja.from(n),0,0))}delete(e,t){return this.replace(e,t,Ja.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,i){if(!i.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),o=e.doc.resolve(n);if(vc(r,o,i))return e.step(new oc(t,n,i));let s=Ic(r,e.doc.resolve(n));0==s[s.length-1]&&s.pop();let a=-(r.depth+1);s.unshift(a);for(let e=r.depth,t=r.pos-1;e>0;e--,t--){let n=r.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;s.indexOf(e)>-1?a=e:r.before(e)==t&&s.splice(1,0,-e)}let l=s.indexOf(a),c=[],h=i.openStart;for(let e=i.content,t=0;;t++){let n=e.firstChild;if(c.push(n),t==i.openStart)break;e=n.content}for(let e=h-1;e>=0;e--){let t=c[e].type,n=Sc(t);if(n&&r.node(l).type!=t)h=e;else if(n||!t.isTextblock)break}for(let t=i.openStart;t>=0;t--){let a=(t+h+1)%(i.openStart+1),d=c[a];if(d)for(let t=0;t<s.length;t++){let c=s[(t+l)%s.length],h=!0;c<0&&(h=!1,c=-c);let u=r.node(c-1),p=r.index(c-1);if(u.canReplaceWith(p,p,d.type,d.marks))return e.replace(r.before(c),h?o.after(c):n,new Ja(Mc(i.content,0,i.openStart,a),a,i.openEnd))}}let d=e.steps.length;for(let a=s.length-1;a>=0&&(e.replace(t,n,i),!(e.steps.length>d));a--){let e=s[a];e<0||(t=r.before(e),n=o.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,i){if(!i.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let i=e.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),n))return t;if(0==i.parentOffset)for(let e=i.depth-1;e>=0;e--){let t=i.index(e);if(i.node(e).canReplaceWith(t,t,n))return i.before(e+1);if(t>0)return null}if(i.parentOffset==i.parent.content.size)for(let e=i.depth-1;e>=0;e--){let t=i.indexAfter(e);if(i.node(e).canReplaceWith(t,t,n))return i.after(e+1);if(t<i.node(e).childCount)return null}return null}(e.doc,t,i.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new Ja(ja.from(i),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let i=e.doc.resolve(t),r=e.doc.resolve(n),o=Ic(i,r);for(let t=0;t<o.length;t++){let n=o[t],s=t==o.length-1;if(s&&0==n||i.node(n).type.contentMatch.validEnd)return e.delete(i.start(n),r.end(n));if(n>0&&(s||i.node(n-1).canReplace(i.index(n-1),r.indexAfter(n-1))))return e.delete(i.before(n),r.after(n))}for(let o=1;o<=i.depth&&o<=r.depth;o++)if(t-i.start(o)==i.depth-o&&n>i.end(o)&&r.end(o)-n!=r.depth-o)return e.delete(i.before(o),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:i,$to:r,depth:o}=t,s=i.before(o+1),a=r.after(o+1),l=s,c=a,h=ja.empty,d=0;for(let e=o,t=!1;e>n;e--)t||i.index(e)>0?(t=!0,h=ja.from(i.node(e).copy(h)),d++):l--;let u=ja.empty,p=0;for(let e=o,t=!1;e>n;e--)t||r.after(e+1)<r.end(e)?(t=!0,u=ja.from(r.node(e).copy(u)),p++):c++;e.step(new sc(l,c,s,a,new Ja(h.append(u),d,p),h.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let i=new oc(t-n,t+n,Ja.empty,!0);e.step(i)}(this,e,t),this}wrap(e,t){return function(e,t,n){let i=ja.empty;for(let e=n.length-1;e>=0;e--){if(i.size){let t=n[e].type.contentMatch.matchFragment(i);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=ja.from(n[e].type.create(n[e].attrs,i))}let r=t.start,o=t.end;e.step(new sc(r,o,r,o,new Ja(i,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,i=null){return function(e,t,n,i,r){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{if(t.isTextblock&&!t.hasMarkup(i,r)&&function(e,t,n){let i=e.resolve(t),r=i.index();return i.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(o).map(n),i)){e.clearIncompatible(e.mapping.slice(o).map(n,1),i);let s=e.mapping.slice(o),a=s.map(n,1),l=s.map(n+t.nodeSize,1);return e.step(new sc(a,l,a+1,l-1,new Ja(ja.from(i.create(r,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return function(e,t,n,i,r){let o=e.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let s=n.create(i,null,r||o.marks);if(o.isLeaf)return e.replaceWith(t,t+o.nodeSize,s);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new sc(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new Ja(ja.from(s),0,0),1,!0))}(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new kc(e,t,n)),this}addNodeMark(e,t){return this.step(new ic(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Ya)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new rc(e,t)),this}split(e,t=1,n){return function(e,t,n=1,i){let r=e.doc.resolve(t),o=ja.empty,s=ja.empty;for(let e=r.depth,t=r.depth-n,a=n-1;e>t;e--,a--){o=ja.from(r.node(e).copy(o));let t=i&&i[a];s=ja.from(t?t.type.create(t.attrs,s):r.node(e).copy(s))}e.step(new oc(t,t,new Ja(o.append(s),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,i){let r,o,s=[],a=[];e.doc.nodesBetween(t,n,((e,l,c)=>{if(!e.isInline)return;let h=e.marks;if(!i.isInSet(h)&&c.type.allowsMarkType(i.type)){let c=Math.max(l,t),d=Math.min(l+e.nodeSize,n),u=i.addToSet(h);for(let e=0;e<h.length;e++)h[e].isInSet(u)||(r&&r.to==c&&r.mark.eq(h[e])?r.to=d:s.push(r=new nc(c,d,h[e])));o&&o.to==c?o.to=d:a.push(o=new tc(c,d,i))}})),s.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,i){let r=[],o=0;e.doc.nodesBetween(t,n,((e,s)=>{if(!e.isInline)return;o++;let a=null;if(i instanceof Nl){let t,n=e.marks;for(;t=i.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else i?i.isInSet(e.marks)&&(a=[i]):a=e.marks;if(a&&a.length){let i=Math.min(s+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==o-1&&l.eq(r[e].style)&&(n=t)}n?(n.to=i,n.step=o):r.push({style:l,from:Math.max(s,t),to:i,step:o})}}})),r.forEach((t=>e.step(new nc(t.from,t.to,t.style))))}(this,e,t,n),this}clearIncompatible(e,t,n){return function(e,t,n,i=n.contentMatch){let r=e.doc.nodeAt(t),o=[],s=t+1;for(let t=0;t<r.childCount;t++){let a=r.child(t),l=s+a.nodeSize,c=i.matchType(a.type);if(c){i=c;for(let t=0;t<a.marks.length;t++)n.allowsMarkType(a.marks[t].type)||e.step(new nc(s,l,a.marks[t]))}else o.push(new oc(s,l,Ja.empty));s=l}if(!i.validEnd){let t=i.fillBefore(ja.empty,!0);e.replace(s,s,new Ja(t,0,0))}for(let t=o.length-1;t>=0;t--)e.step(o[t])}(this,e,t,n),this}}const Rc=Object.create(null);class Ac{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Oc(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ja.empty){let n=t.content.lastChild,i=null;for(let e=0;e<t.openEnd;e++)i=n,n=n.lastChild;let r=e.steps.length,o=this.ranges;for(let s=0;s<o.length;s++){let{$from:a,$to:l}=o[s],c=e.mapping.slice(r);e.replaceRange(c.map(a.pos),c.map(l.pos),s?Ja.empty:t),0==s&&jc(e,r,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:o,$to:s}=i[r],a=e.mapping.slice(n),l=a.map(o.pos),c=a.map(s.pos);r?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),jc(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Lc(e):Gc(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let i=e.depth-1;i>=0;i--){let r=t<0?Gc(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):Gc(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(r)return r}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Fc(e.node(0))}static atStart(e){return Gc(e,e,0,0,1)||new Fc(e)}static atEnd(e){return Gc(e,e,e.content.size,e.childCount,-1)||new Fc(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Rc[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Rc)throw new RangeError("Duplicate use of selection JSON ID "+e);return Rc[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Lc.between(this.$anchor,this.$head).getBookmark()}}Ac.prototype.visible=!0;class Oc{constructor(e,t){this.$from=e,this.$to=t}}let Pc=!1;function Dc(e){Pc||e.parent.inlineContent||(Pc=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class Lc extends Ac{constructor(e,t=e){Dc(e),Dc(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Ac.near(n);let i=e.resolve(t.map(this.anchor));return new Lc(i.parent.inlineContent?i:n,n)}replace(e,t=Ja.empty){if(super.replace(e,t),t==Ja.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof Lc&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Bc(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new Lc(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if(n&&!i||(n=i>=0?1:-1),!t.parent.inlineContent){let e=Ac.findFrom(t,n,!0)||Ac.findFrom(t,-n,!0);if(!e)return Ac.near(t,n);t=e.$head}return e.parent.inlineContent||(0==i||(e=(Ac.findFrom(e,-n,!0)||Ac.findFrom(e,n,!0)).$anchor).pos<t.pos!=i<0)&&(e=t),new Lc(e,t)}}Ac.jsonID("text",Lc);class Bc{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Bc(e.map(this.anchor),e.map(this.head))}resolve(e){return Lc.between(e.resolve(this.anchor),e.resolve(this.head))}}class Zc extends Ac{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return n?Ac.near(r):new Zc(r)}content(){return new Ja(ja.from(this.node),0,0)}eq(e){return e instanceof Zc&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new zc(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Zc(e.resolve(t.anchor))}static create(e,t){return new Zc(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}Zc.prototype.visible=!1,Ac.jsonID("node",Zc);class zc{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Bc(n,n):new zc(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Zc.isSelectable(n)?new Zc(t):Ac.near(t)}}class Fc extends Ac{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ja.empty){if(t==Ja.empty){e.delete(0,e.doc.content.size);let t=Ac.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Fc(e)}map(e){return new Fc(e)}eq(e){return e instanceof Fc}getBookmark(){return Vc}}Ac.jsonID("all",Fc);const Vc={map(){return this},resolve:e=>new Fc(e)};function Gc(e,t,n,i,r,o=!1){if(t.inlineContent)return Lc.create(e,n);for(let s=i-(r>0?0:1);r>0?s<t.childCount:s>=0;s+=r){let i=t.child(s);if(i.isAtom){if(!o&&Zc.isSelectable(i))return Zc.create(e,n-(r<0?i.nodeSize:0))}else{let t=Gc(e,i,n+r,r<0?i.childCount:0,r,o);if(t)return t}n+=i.nodeSize*r}return null}function jc(e,t,n){let i=e.steps.length-1;if(i<t)return;let r,o=e.steps[i];(o instanceof oc||o instanceof sc)&&(e.mapping.maps[i].forEach(((e,t,n,i)=>{null==r&&(r=i)})),e.setSelection(Ac.near(e.doc.resolve(r),n)))}class Wc extends Nc{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return Ya.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Ya.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let i=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let r=this.storedMarks;if(!r){let e=this.doc.resolve(t);r=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,i.text(e,r)),this.selection.empty||this.setSelection(Ac.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function Hc(e,t){return t&&e?e.bind(t):e}class Uc{constructor(e,t,n){this.name=e,this.init=Hc(t.init,n),this.apply=Hc(t.apply,n)}}const Yc=[new Uc("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new Uc("selection",{init:(e,t)=>e.selection||Ac.atStart(t.doc),apply:e=>e.selection}),new Uc("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,i)=>i.selection.$cursor?e.storedMarks:null}),new Uc("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class Xc{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Yc.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new Uc(e.key,e.spec.state,e))}))}}class Jc{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),i=null;for(;;){let r=!1;for(let o=0;o<this.config.plugins.length;o++){let s=this.config.plugins[o];if(s.spec.appendTransaction){let a=i?i[o].n:0,l=i?i[o].state:this,c=a<t.length&&s.spec.appendTransaction.call(s,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let e=0;e<this.config.plugins.length;e++)i.push(e<o?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),r=!0}i&&(i[o]={state:n,n:t.length})}}if(!r)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Jc(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let r=n[i];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new Wc(this)}static create(e){let t=new Xc(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Jc(t);for(let i=0;i<t.fields.length;i++)n[t.fields[i].name]=t.fields[i].init(e,n);return n}reconfigure(e){let t=new Xc(this.schema,e.plugins),n=t.fields,i=new Jc(t);for(let t=0;t<n.length;t++){let r=n[t].name;i[r]=this.hasOwnProperty(r)?this[r]:n[t].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],r=i.spec.state;r&&r.toJSON&&(t[n]=r.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Xc(e.schema,e.plugins),r=new Jc(i);return i.fields.forEach((i=>{if("doc"==i.name)r.doc=pl.fromJSON(e.schema,t.doc);else if("selection"==i.name)r.selection=Ac.fromJSON(r.doc,t.selection);else if("storedMarks"==i.name)t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let s=n[o],a=s.spec.state;if(s.key==i.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,o))return void(r[i.name]=a.fromJSON.call(s,e,t[o],r))}r[i.name]=i.init(e,r)}})),r}}function Kc(e,t,n){for(let i in e){let r=e[i];r instanceof Function?r=r.bind(t):"handleDOMEvents"==i&&(r=Kc(r,t,{})),n[i]=r}return n}class $c{constructor(e){this.spec=e,this.props={},e.props&&Kc(e.props,this,this.props),this.key=e.key?e.key.key:Qc("plugin")}getState(e){return e[this.key]}}const qc=Object.create(null);function Qc(e){return e in qc?e+"$"+ ++qc[e]:(qc[e]=0,e+"$")}class eh{constructor(e="key"){this.key=Qc(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const th=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},nh=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let ih=null;const rh=function(e,t,n){let i=ih||(ih=document.createRange());return i.setEnd(e,null==n?e.nodeValue.length:n),i.setStart(e,t||0),i},oh=function(e,t,n,i){return n&&(ah(e,t,n,i,-1)||ah(e,t,n,i,1))},sh=/^(img|br|input|textarea|hr)$/i;function ah(e,t,n,i,r){for(;;){if(e==n&&t==i)return!0;if(t==(r<0?0:lh(e))){let n=e.parentNode;if(!n||1!=n.nodeType||ch(e)||sh.test(e.nodeName)||"false"==e.contentEditable)return!1;t=th(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(r<0?-1:0)]).contentEditable)return!1;t=r<0?lh(e):0}}}function lh(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function ch(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const hh=function(e){return e.focusNode&&oh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function dh(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const uh="undefined"!=typeof navigator?navigator:null,ph="undefined"!=typeof document?document:null,mh=uh&&uh.userAgent||"",fh=/Edge\/(\d+)/.exec(mh),gh=/MSIE \d/.exec(mh),yh=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(mh),vh=!!(gh||yh||fh),bh=gh?document.documentMode:yh?+yh[1]:fh?+fh[1]:0,wh=!vh&&/gecko\/(\d+)/i.test(mh);wh&&(/Firefox\/(\d+)/.exec(mh)||[0,0])[1];const _h=!vh&&/Chrome\/(\d+)/.exec(mh),xh=!!_h,Ch=_h?+_h[1]:0,Eh=!vh&&!!uh&&/Apple Computer/.test(uh.vendor),Sh=Eh&&(/Mobile\/\w+/.test(mh)||!!uh&&uh.maxTouchPoints>2),Mh=Sh||!!uh&&/Mac/.test(uh.platform),Ih=!!uh&&/Win/.test(uh.platform),kh=/Android \d/.test(mh),Th=!!ph&&"webkitFontSmoothing"in ph.documentElement.style,Nh=Th?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Rh(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Ah(e,t){return"number"==typeof e?e:e[t]}function Oh(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,i=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*i}}function Ph(e,t,n){let i=e.someProp("scrollThreshold")||0,r=e.someProp("scrollMargin")||5,o=e.dom.ownerDocument;for(let s=n||e.dom;s;s=nh(s)){if(1!=s.nodeType)continue;let e=s,n=e==o.body,a=n?Rh(o):Oh(e),l=0,c=0;if(t.top<a.top+Ah(i,"top")?c=-(a.top-t.top+Ah(r,"top")):t.bottom>a.bottom-Ah(i,"bottom")&&(c=t.bottom-a.bottom+Ah(r,"bottom")),t.left<a.left+Ah(i,"left")?l=-(a.left-t.left+Ah(r,"left")):t.right>a.right-Ah(i,"right")&&(l=t.right-a.right+Ah(r,"right")),l||c)if(n)o.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,i=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let r=e.scrollLeft-n,o=e.scrollTop-i;t={left:t.left-r,top:t.top-o,right:t.right-r,bottom:t.bottom-o}}if(n||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}function Dh(e){let t=[],n=e.ownerDocument;for(let i=e;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),e!=n);i=nh(i));return t}function Lh(e,t){for(let n=0;n<e.length;n++){let{dom:i,top:r,left:o}=e[n];i.scrollTop!=r+t&&(i.scrollTop=r+t),i.scrollLeft!=o&&(i.scrollLeft=o)}}let Bh=null;function Zh(e,t){let n,i,r,o,s=2e8,a=0,l=t.top,c=t.top;for(let h=e.firstChild,d=0;h;h=h.nextSibling,d++){let e;if(1==h.nodeType)e=h.getClientRects();else{if(3!=h.nodeType)continue;e=rh(h).getClientRects()}for(let u=0;u<e.length;u++){let p=e[u];if(p.top<=l&&p.bottom>=c){l=Math.max(p.bottom,l),c=Math.min(p.top,c);let e=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(e<s){n=h,s=e,i=e&&3==n.nodeType?{left:p.right<t.left?p.right:p.left,top:t.top}:t,1==h.nodeType&&e&&(a=d+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!r&&p.left<=t.left&&p.right>=t.left&&(r=h,o={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!n&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(a=d+1)}}return!n&&r&&(n=r,i=o,s=0),n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,i=document.createRange();for(let r=0;r<n;r++){i.setEnd(e,r+1),i.setStart(e,r);let n=jh(i,1);if(n.top!=n.bottom&&zh(t,n))return{node:e,offset:r+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,i):!n||s&&1==n.nodeType?{node:e,offset:a}:Zh(n,i)}function zh(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Fh(e,t,n){let i=e.childNodes.length;if(i&&n.top<n.bottom)for(let r=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-n.top)/(n.bottom-n.top))-2)),o=r;;){let n=e.childNodes[o];if(1==n.nodeType){let e=n.getClientRects();for(let i=0;i<e.length;i++){let r=e[i];if(zh(t,r))return Fh(n,t,r)}}if((o=(o+1)%i)==r)break}return e}function Vh(e,t){let n,i=e.dom.ownerDocument,r=0,o=function(e,t,n){if(e.caretPositionFromPoint)try{let i=e.caretPositionFromPoint(t,n);if(i)return{node:i.offsetNode,offset:i.offset}}catch(e){}if(e.caretRangeFromPoint){let i=e.caretRangeFromPoint(t,n);if(i)return{node:i.startContainer,offset:i.startOffset}}}(i,t.left,t.top);o&&({node:n,offset:r}=o);let s,a=(e.root.elementFromPoint?e.root:i).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=e.dom.getBoundingClientRect();if(!zh(t,n))return null;if(a=Fh(e.dom,t,n),!a)return null}if(Eh)for(let e=a;n&&e;e=nh(e))e.draggable&&(n=void 0);if(a=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(a,t),n){if(wh&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let e,i=n.childNodes[r];"IMG"==i.nodeName&&(e=i.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&r++}n==e.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(s=function(e,t,n,i){let r=-1;for(let n=t,o=!1;n!=e.dom;){let t=e.docView.nearestDesc(n,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent&&!o||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&!o&&(o=!0,e.left>i.left||e.top>i.top?r=t.posBefore:(e.right<i.left||e.bottom<i.top)&&(r=t.posAfter)),!t.contentDOM&&r<0&&!t.node.isText)return(t.node.isBlock?i.top<(e.top+e.bottom)/2:i.left<(e.left+e.right)/2)?t.posBefore:t.posAfter}n=t.dom.parentNode}return r>-1?r:e.docView.posFromDOM(t,n,-1)}(e,n,r,t))}null==s&&(s=function(e,t,n){let{node:i,offset:r}=Zh(t,n),o=-1;if(1==i.nodeType&&!i.firstChild){let e=i.getBoundingClientRect();o=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(i,r,o)}(e,a,t));let l=e.docView.nearestDesc(a,!0);return{pos:s,inside:l?l.posAtStart-l.border:-1}}function Gh(e){return e.top<e.bottom||e.left<e.right}function jh(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(Gh(e))return e}return Array.prototype.find.call(n,Gh)||e.getBoundingClientRect()}const Wh=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Hh(e,t,n){let{node:i,offset:r,atom:o}=e.docView.domFromPos(t,n<0?-1:1),s=Th||wh;if(3==i.nodeType){if(!s||!Wh.test(i.nodeValue)&&(n<0?r:r!=i.nodeValue.length)){let e=r,t=r,o=n<0?1:-1;return n<0&&!r?(t++,o=-1):n>=0&&r==i.nodeValue.length?(e--,o=1):n<0?e--:t++,Uh(jh(rh(i,e,t),o),o<0)}{let e=jh(rh(i,r,r),n);if(wh&&r&&/\s/.test(i.nodeValue[r-1])&&r<i.nodeValue.length){let t=jh(rh(i,r-1,r-1),-1);if(t.top==e.top){let n=jh(rh(i,r,r+1),-1);if(n.top!=e.top)return Uh(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(o||0)).parent.inlineContent){if(null==o&&r&&(n<0||r==lh(i))){let e=i.childNodes[r-1];if(1==e.nodeType)return Yh(e.getBoundingClientRect(),!1)}if(null==o&&r<lh(i)){let e=i.childNodes[r];if(1==e.nodeType)return Yh(e.getBoundingClientRect(),!0)}return Yh(i.getBoundingClientRect(),n>=0)}if(null==o&&r&&(n<0||r==lh(i))){let e=i.childNodes[r-1],t=3==e.nodeType?rh(e,lh(e)-(s?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Uh(jh(t,1),!1)}if(null==o&&r<lh(i)){let e=i.childNodes[r];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?rh(e,0,s?0:1):1==e.nodeType?e:null:null;if(t)return Uh(jh(t,-1),!0)}return Uh(jh(3==i.nodeType?rh(i):i,-n),n>=0)}function Uh(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Yh(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function Xh(e,t,n){let i=e.state,r=e.root.activeElement;i!=t&&e.updateState(t),r!=e.dom&&e.focus();try{return n()}finally{i!=t&&e.updateState(i),r!=e.dom&&r&&r.focus()}}const Jh=/[\u0590-\u08ac]/;let Kh=null,$h=null,qh=!1;class Qh{constructor(e,t,n,i){this.parent=e,this.children=t,this.dom=n,this.contentDOM=i,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let i=this.children[t];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,i;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(i)+i.size:this.posAtStart}{let n,i;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(i):this.posAtEnd}}let i;if(e==this.dom&&this.contentDOM)i=t>th(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!1;break}if(t.previousSibling)break}if(null==i&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!0;break}if(t.nextSibling)break}}return(null==i?n>0:i)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,i=e;i;i=i.parentNode){let r,o=this.getDesc(i);if(o&&(!t||o.node)){if(!n||!(r=o.nodeDOM)||(1==r.nodeType?r.contains(1==e.nodeType?e:e.parentNode):r==e))return o;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,n){for(let i=e;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let i=this.children[t],r=n+i.size;if(n==e&&r!=n){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<r)return i.descAt(e-n-i.border);n=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let t=0;n<this.children.length;n++){let r=this.children[n],o=t+r.size;if(o>e||r instanceof sd){i=e-t;break}t=o}if(i)return this.children[n].domFromPos(i-this.children[n].border,t);for(let e;n&&!(e=this.children[n-1]).size&&e instanceof ed&&e.side>=0;n--);if(t<=0){let e,i=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,i=!1);return e&&t&&i&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?th(e.dom)+1:0}}{let e,i=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,i=!1);return e&&i&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?th(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let o=n,s=0;;s++){let n=this.children[s],a=o+n.size;if(-1==i&&e<=a){let r=o+n.border;if(e>=r&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,r);e=o;for(let t=s;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){i=th(n.dom)+1;break}e-=n.size}-1==i&&(i=0)}if(i>-1&&(a>t||s==this.children.length-1)){t=a;for(let e=s+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=th(n.dom);break}t+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}o=a}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,i=!1){let r=Math.min(e,t),o=Math.max(e,t);for(let s=0,a=0;s<this.children.length;s++){let l=this.children[s],c=a+l.size;if(r>a&&o<c)return l.setSelection(e-a-l.border,t-a-l.border,n,i);a=c}let s=this.domFromPos(e,e?-1:1),a=t==e?s:this.domFromPos(t,t?-1:1),l=n.getSelection(),c=!1;if((wh||Eh)&&e==t){let{node:e,offset:t}=s;if(3==e.nodeType){if(c=!(!t||"\n"!=e.nodeValue[t-1]),c&&t==e.nodeValue.length)for(let t,n=e;n;n=n.parentNode){if(t=n.nextSibling){"BR"==t.nodeName&&(s=a={node:t.parentNode,offset:th(t)+1});break}let e=n.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];c=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(wh&&l.focusNode&&l.focusNode!=a.node&&1==l.focusNode.nodeType){let e=l.focusNode.childNodes[l.focusOffset];e&&"false"==e.contentEditable&&(i=!0)}if(!(i||c&&Eh)&&oh(s.node,s.offset,l.anchorNode,l.anchorOffset)&&oh(a.node,a.offset,l.focusNode,l.focusOffset))return;let h=!1;if((l.extend||e==t)&&!c){l.collapse(s.node,s.offset);try{e!=t&&l.extend(a.node,a.offset),h=!0}catch(e){}}if(!h){if(e>t){let e=s;s=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(s.node,s.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,i=0;i<this.children.length;i++){let r=this.children[i],o=n+r.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let i=n+r.border,s=o-r.border;if(e>=i&&t<=s)return this.dirty=e==n||t==o?2:1,void(e!=i||t!=s||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(e-i,t-i):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=o}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class ed extends Qh{constructor(e,t,n,i){let r,o=t.type.toDOM;if("function"==typeof o&&(o=o(n,(()=>r?r.parent?r.parent.posBeforeChild(r):void 0:i))),!t.type.spec.raw){if(1!=o.nodeType){let e=document.createElement("span");e.appendChild(o),o=e}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class td extends Qh{constructor(e,t,n,i){super(e,[],t,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class nd extends Qh{constructor(e,t,n,i){super(e,[],n,i),this.mark=t}static create(e,t,n,i){let r=i.nodeViews[t.type.name],o=r&&r(t,i,n);return o&&o.dom||(o=jl.renderSpec(document,t.type.spec.toDOM(t,n))),new nd(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let i=nd.create(this.parent,this.mark,!0,n),r=this.children,o=this.size;t<o&&(r=bd(r,t,o,n)),e>0&&(r=bd(r,0,e,n));for(let e=0;e<r.length;e++)r[e].parent=i;return i.children=r,i}}class id extends Qh{constructor(e,t,n,i,r,o,s,a,l){super(e,[],r,o),this.node=t,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=s}static create(e,t,n,i,r,o){let s,a=r.nodeViews[t.type.name],l=a&&a(t,r,(()=>s?s.parent?s.parent.posBeforeChild(s):void 0:o),n,i),c=l&&l.dom,h=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else c||({dom:c,contentDOM:h}=jl.renderSpec(document,t.type.spec.toDOM(t)));h||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let d=c;return c=md(c,n,t),l?s=new ad(e,t,n,i,c,h||null,d,l,r,o+1):t.isText?new od(e,t,n,i,c,d,r):new id(e,t,n,i,c,h||null,d,r,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>ja.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&fd(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,i=t,r=e.composing?this.localCompositionInfo(e,t):null,o=r&&r.pos>-1?r:null,s=r&&r.pos<0,a=new yd(this,o&&o.node,e);!function(e,t,n,i){let r=t.locals(e),o=0;if(0==r.length){for(let n=0;n<e.childCount;n++){let s=e.child(n);i(s,r,t.forChild(o,s),n),o+=s.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){if(s<r.length&&r[s].to==o){let e,t=r[s++];for(;s<r.length&&r[s].to==o;)(e||(e=[t])).push(r[s++]);if(e){e.sort(vd);for(let t=0;t<e.length;t++)n(e[t],c,!!l)}else n(t,c,!!l)}let h,d;if(l)d=-1,h=l,l=null;else{if(!(c<e.childCount))break;d=c,h=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=o&&a.splice(e--,1);for(;s<r.length&&r[s].from<=o&&r[s].to>o;)a.push(r[s++]);let u=o+h.nodeSize;if(h.isText){let e=u;s<r.length&&r[s].from<e&&(e=r[s].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<u&&(l=h.cut(e-o),h=h.cut(0,e-o),u=e,d=-1)}i(h,h.isInline&&!h.isLeaf?a.filter((e=>!e.inline)):a.slice(),t.forChild(o,h),d),o=u}}(this.node,this.innerDeco,((t,r,o)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!o&&a.syncToMarks(r==this.node.childCount?Ya.none:this.node.child(r).marks,n,e),a.placeWidget(t,e,i)}),((t,o,l,c)=>{let h;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,o,l,c)||s&&e.state.selection.from>i&&e.state.selection.to<i+t.nodeSize&&(h=a.findIndexWithChild(r.node))>-1&&a.updateNodeAt(t,o,l,h,e)||a.updateNextNode(t,o,l,e,c,i)||a.addNode(t,o,l,e,i),i+=t.nodeSize})),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(o&&this.protectLocalComposition(e,o),ld(this.contentDOM,this.children,e),Sh&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof Lc)||n<t||i>t+this.node.content.size)return null;let r=e.domSelectionRange(),o=function(e,t){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0){if(e.childNodes.length>t&&3==e.childNodes[t].nodeType)return e.childNodes[t];t=lh(e=e.childNodes[t-1])}else{if(!(1==e.nodeType&&t<e.childNodes.length))return null;e=e.childNodes[t],t=0}}}(r.focusNode,r.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let e=o.nodeValue,r=function(e,t,n,i){for(let r=0,o=0;r<e.childCount&&o<=i;){let s=e.child(r++),a=o;if(o+=s.nodeSize,!s.isText)continue;let l=s.text;for(;r<e.childCount;){let t=e.child(r++);if(o+=t.nodeSize,!t.isText)break;l+=t.text}if(o>=n){let e=a<i?l.lastIndexOf(t,i-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==i&&l.length>=i+t.length-a&&l.slice(i-a,i-a+t.length)==t)return i}}return-1}(this.node.content,e,n-t,i-t);return r<0?null:{node:o,pos:r,text:e}}return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:i}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let o=new td(this,r,t,i);e.input.compositionNodes.push(o),this.children=bd(this.children,n,n+i.length,e,o)}update(e,t,n,i){return!(3==this.dirty||!e.sameMarkup(this.node)||(this.updateInner(e,t,n,i),0))}updateInner(e,t,n,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(fd(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=ud(this.dom,this.nodeDOM,dd(this.outerDeco,this.node,t),dd(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function rd(e,t,n,i,r){md(i,t,e);let o=new id(void 0,e,t,n,i,i,i,r,0);return o.contentDOM&&o.updateChildren(r,0),o}class od extends id{constructor(e,t,n,i,r,o,s){super(e,t,n,i,r,null,o,s,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,i){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node)||(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=0,0))}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let i=this.node.cut(e,t),r=document.createTextNode(i.text);return new od(this.parent,i,this.outerDeco,this.innerDeco,r,r,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class sd extends Qh{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class ad extends id{constructor(e,t,n,i,r,o,s,a,l,c){super(e,t,n,i,r,o,s,l,c),this.spec=a}update(e,t,n,i){if(3==this.dirty)return!1;if(this.spec.update){let r=this.spec.update(e,t,n);return r&&this.updateInner(e,t,n,i),r}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,i){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function ld(e,t,n){let i=e.firstChild,r=!1;for(let o=0;o<t.length;o++){let s=t[o],a=s.dom;if(a.parentNode==e){for(;a!=i;)i=gd(i),r=!0;i=i.nextSibling}else r=!0,e.insertBefore(a,i);if(s instanceof nd){let t=i?i.previousSibling:e.lastChild;ld(s.contentDOM,s.children,n),i=t?t.nextSibling:e.firstChild}}for(;i;)i=gd(i),r=!0;r&&n.trackWrites==e&&(n.trackWrites=null)}const cd=function(e){e&&(this.nodeName=e)};cd.prototype=Object.create(null);const hd=[new cd];function dd(e,t,n){if(0==e.length)return hd;let i=n?hd[0]:new cd,r=[i];for(let o=0;o<e.length;o++){let s=e[o].type.attrs;if(s){s.nodeName&&r.push(i=new cd(s.nodeName));for(let e in s){let o=s[e];null!=o&&(n&&1==r.length&&r.push(i=new cd(t.isInline?"span":"div")),"class"==e?i.class=(i.class?i.class+" ":"")+o:"style"==e?i.style=(i.style?i.style+";":"")+o:"nodeName"!=e&&(i[e]=o))}}}return r}function ud(e,t,n,i){if(n==hd&&i==hd)return t;let r=t;for(let t=0;t<i.length;t++){let o=i[t],s=n[t];if(t){let t;s&&s.nodeName==o.nodeName&&r!=e&&(t=r.parentNode)&&t.nodeName.toLowerCase()==o.nodeName||(t=document.createElement(o.nodeName),t.pmIsDeco=!0,t.appendChild(r),s=hd[0]),r=t}pd(r,s||hd[0],o)}return r}function pd(e,t,n){for(let i in t)"class"==i||"style"==i||"nodeName"==i||i in n||e.removeAttribute(i);for(let i in n)"class"!=i&&"style"!=i&&"nodeName"!=i&&n[i]!=t[i]&&e.setAttribute(i,n[i]);if(t.class!=n.class){let i=t.class?t.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<i.length;t++)-1==r.indexOf(i[t])&&e.classList.remove(i[t]);for(let t=0;t<r.length;t++)-1==i.indexOf(r[t])&&e.classList.add(r[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=i.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function md(e,t,n){return ud(e,e,hd,dd(t,n,1!=e.nodeType))}function fd(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function gd(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class yd{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,i=n.children.length,r=e.childCount,o=new Map,s=[];e:for(;r>0;){let a;for(;;)if(i){let e=n.children[i-1];if(!(e instanceof nd)){a=e,i--;break}n=e,i=e.children.length}else{if(n==t)break e;i=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(r-1))break;--r,o.set(a,r),s.push(a)}}return{index:r,matched:o,matches:s.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let i=0,r=this.stack.length>>1,o=Math.min(r,e.length);for(;i<o&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&!1!==e[i].type.spec.spanning;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let i=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[r])&&!this.isLocked(n.dom)){i=t;break}}if(i>-1)i>this.index&&(this.changed=!0,this.destroyBetween(this.index,i)),this.top=this.top.children[this.index];else{let i=nd.create(this.top,e[r],t,n);this.top.children.splice(this.index,0,i),this.top=i,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,n,i){let r,o=-1;if(i>=this.preMatch.index&&(r=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&r.matchesNode(e,t,n))o=this.top.children.indexOf(r,this.index);else for(let i=this.index,r=Math.min(this.top.children.length,i+5);i<r;i++){let r=this.top.children[i];if(r.matchesNode(e,t,n)&&!this.preMatch.matched.has(r)){o=i;break}}return!(o<0||(this.destroyBetween(this.index,o),this.index++,0))}updateNodeAt(e,t,n,i,r){let o=this.top.children[i];return 3==o.dirty&&o.dom==o.contentDOM&&(o.dirty=2),!!o.update(e,t,n,r)&&(this.destroyBetween(this.index,i),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,i,r,o){for(let s=this.index;s<this.top.children.length;s++){let a=this.top.children[s];if(a instanceof id){let l=this.preMatch.matched.get(a);if(null!=l&&l!=r)return!1;let c,h=a.dom,d=this.isLocked(h)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&fd(t,a.outerDeco));if(!d&&a.update(e,t,n,i))return this.destroyBetween(this.index,s),a.dom!=h&&(this.changed=!0),this.index++,!0;if(!d&&(c=this.recreateWrapper(a,e,t,n,i,o)))return this.top.children[this.index]=c,c.dirty=2,c.updateChildren(i,o+1),c.dirty=0,this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,i,r,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let s=id.create(this.top,t,n,i,r,o);if(!s.contentDOM)return null;s.children=e.children,e.children=[],e.destroy();for(let e of s.children)e.parent=s;return s}addNode(e,t,n,i,r){let o=id.create(this.top,e,t,n,i,r);o.contentDOM&&o.updateChildren(i,r+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(!i||!i.matchesWidget(e)||e!=i.widget&&i.widget.type.toDOM.parentNode){let i=new ed(this.top,e,t,n);this.top.children.splice(this.index++,0,i),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof nd;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof od)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Eh||xh)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let i=new sd(this.top,[],n,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function vd(e,t){return e.type.side-t.type.side}function bd(e,t,n,i,r){let o=[];for(let s=0,a=0;s<e.length;s++){let l=e[s],c=a,h=a+=l.size;c>=n||h<=t?o.push(l):(c<t&&o.push(l.slice(0,t-c,i)),r&&(o.push(r),r=void 0),h>n&&o.push(l.slice(n-c,l.size,i)))}return o}function wd(e,t=null){let n=e.domSelectionRange(),i=e.state.doc;if(!n.focusNode)return null;let r=e.docView.nearestDesc(n.focusNode),o=r&&0==r.size,s=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a,l,c=i.resolve(s);if(hh(n)){for(a=c;r&&!r.node;)r=r.parent;let e=r.node;if(r&&e.isAtom&&Zc.isSelectable(e)&&r.parent&&(!e.isInline||!function(e,t,n){for(let i=0==t,r=t==lh(e);i||r;){if(e==n)return!0;let t=th(e);if(!(e=e.parentNode))return!1;i=i&&0==t,r=r&&t==lh(e)}}(n.focusNode,n.focusOffset,r.dom))){let e=r.posBefore;l=new Zc(s==e?c:i.resolve(e))}}else{let t=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(t<0)return null;a=i.resolve(t)}return l||(l=Td(e,a,c,"pointer"==t||e.state.selection.head<c.pos&&!o?1:-1)),l}function _d(e){return e.editable?e.hasFocus():Rd(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function xd(e,t=!1){let n=e.state.selection;if(Id(e,n),_d(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&xh){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&oh(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange(),i=e.cursorWrapper.dom,r="IMG"==i.nodeName;r?n.setEnd(i.parentNode,th(i)+1):n.setEnd(i,0),n.collapse(!1),t.removeAllRanges(),t.addRange(n),!r&&!e.state.selection.visible&&vh&&bh<=11&&(i.disabled=!0,i.disabled=!1)}(e);else{let i,r,{anchor:o,head:s}=n;!Cd||n instanceof Lc||(n.$from.parent.inlineContent||(i=Ed(e,n.from)),n.empty||n.$from.parent.inlineContent||(r=Ed(e,n.to))),e.docView.setSelection(o,s,e.root,t),Cd&&(i&&Md(i),r&&Md(r)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),i=n.anchorNode,r=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==i&&n.anchorOffset==r||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{_d(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Cd=Eh||xh&&Ch<63;function Ed(e,t){let{node:n,offset:i}=e.docView.domFromPos(t,0),r=i<n.childNodes.length?n.childNodes[i]:null,o=i?n.childNodes[i-1]:null;if(Eh&&r&&"false"==r.contentEditable)return Sd(r);if(!(r&&"false"!=r.contentEditable||o&&"false"!=o.contentEditable)){if(r)return Sd(r);if(o)return Sd(o)}}function Sd(e){return e.contentEditable="true",Eh&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Md(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Id(e,t){if(t instanceof Zc){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(kd(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else kd(e)}function kd(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Td(e,t,n,i){return e.someProp("createSelectionBetween",(i=>i(e,t,n)))||Lc.between(t,n,i)}function Nd(e){return!(e.editable&&!e.hasFocus())&&Rd(e)}function Rd(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function Ad(e,t){let{$anchor:n,$head:i}=e.selection,r=t>0?n.max(i):n.min(i),o=r.parent.inlineContent?r.depth?e.doc.resolve(t>0?r.after():r.before()):null:r;return o&&Ac.findFrom(o,t)}function Od(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Pd(e,t,n){let i=e.state.selection;if(!(i instanceof Lc)){if(i instanceof Zc&&i.node.isInline)return Od(e,new Lc(t>0?i.$to:i.$from));{let n=Ad(e.state,t);return!!n&&Od(e,n)}}if(!i.empty||n.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=Ad(e.state,t);return!!(n&&n instanceof Zc)&&Od(e,n)}if(!(Mh&&n.indexOf("m")>-1)){let n,r=i.$head,o=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!o||o.isText)return!1;let s=t<0?r.pos-o.nodeSize:r.pos;return!!(o.isAtom||(n=e.docView.descAt(s))&&!n.contentDOM)&&(Zc.isSelectable(o)?Od(e,new Zc(t<0?e.state.doc.resolve(r.pos-o.nodeSize):r)):!!Th&&Od(e,new Lc(e.state.doc.resolve(t<0?s:s+o.nodeSize))))}}function Dd(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Ld(e){let t=e.pmViewDesc;return t&&0==t.size&&(e.nextSibling||"BR"!=e.nodeName)}function Bd(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,o,s=!1;for(wh&&1==n.nodeType&&i<Dd(n)&&Ld(n.childNodes[i])&&(s=!0);;)if(i>0){if(1!=n.nodeType)break;{let e=n.childNodes[i-1];if(Ld(e))r=n,o=--i;else{if(3!=e.nodeType)break;n=e,i=n.nodeValue.length}}}else{if(zd(n))break;{let t=n.previousSibling;for(;t&&Ld(t);)r=n.parentNode,o=th(t),t=t.previousSibling;if(t)n=t,i=Dd(n);else{if(n=n.parentNode,n==e.dom)break;i=0}}}s?Fd(e,n,i):r&&Fd(e,r,o)}(e):Zd(e)}function Zd(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,o,s=Dd(n);for(;;)if(i<s){if(1!=n.nodeType)break;if(!Ld(n.childNodes[i]))break;r=n,o=++i}else{if(zd(n))break;{let t=n.nextSibling;for(;t&&Ld(t);)r=t.parentNode,o=th(t)+1,t=t.nextSibling;if(t)n=t,i=0,s=Dd(n);else{if(n=n.parentNode,n==e.dom)break;i=s=0}}}r&&Fd(e,r,o)}function zd(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Fd(e,t,n){let i=e.domSelection();if(hh(i)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),i.removeAllRanges(),i.addRange(e)}else i.extend&&i.extend(t,n);e.domObserver.setCurSelection();let{state:r}=e;setTimeout((()=>{e.state==r&&xd(e)}),50)}function Vd(e,t){let n=e.state.doc.resolve(t);if(!xh&&!Ih&&n.parent.inlineContent){let i=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),r=(n.top+n.bottom)/2;if(r>i.top&&r<i.bottom&&Math.abs(n.left-i.left)>1)return n.left<i.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),r=(n.top+n.bottom)/2;if(r>i.top&&r<i.bottom&&Math.abs(n.left-i.left)>1)return n.left>i.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function Gd(e,t,n){let i=e.state.selection;if(i instanceof Lc&&!i.empty||n.indexOf("s")>-1)return!1;if(Mh&&n.indexOf("m")>-1)return!1;let{$from:r,$to:o}=i;if(!r.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=Ad(e.state,t);if(n&&n instanceof Zc)return Od(e,n)}if(!r.parent.inlineContent){let n=t<0?r:o,s=i instanceof Fc?Ac.near(n,t):Ac.findFrom(n,t);return!!s&&Od(e,s)}return!1}function jd(e,t){if(!(e.state.selection instanceof Lc))return!0;let{$head:n,$anchor:i,empty:r}=e.state.selection;if(!n.sameParent(i))return!0;if(!r)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let i=e.state.tr;return t<0?i.delete(n.pos-o.nodeSize,n.pos):i.delete(n.pos,n.pos+o.nodeSize),e.dispatch(i),!0}return!1}function Wd(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Hd(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:i,openStart:r,openEnd:o}=t;for(;r>1&&o>1&&1==i.childCount&&1==i.firstChild.childCount;){r--,o--;let e=i.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),i=e.content}let s=e.someProp("clipboardSerializer")||jl.fromSchema(e.state.schema),a=tu(),l=a.createElement("div");l.appendChild(s.serializeFragment(i,{document:a}));let c,h=l.firstChild,d=0;for(;h&&1==h.nodeType&&(c=Qd[h.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),d++}h=l.firstChild}return h&&1==h.nodeType&&h.setAttribute("data-pm-slice",`${r} ${o}${d?` -${d}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n")}}function Ud(e,t,n,i,r){let o,s,a=r.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(i||a||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,a||i,e)})),a)return t?new Ja(ja.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):Ja.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,r,i,e)));if(n)s=n;else{let n=r.marks(),{schema:i}=e.state,s=jl.fromSchema(i);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=o.appendChild(document.createElement("p"));e&&t.appendChild(s.serializeNode(i.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),o=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,i=tu().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e);if((n=r&&Qd[r[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join("")),i.innerHTML=e,n)for(let e=0;e<n.length;e++)i=i.querySelector(n[e])||i;return i}(n),Th&&function(e){let t=e.querySelectorAll(xh?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let i=t[n];1==i.childNodes.length&&" "==i.textContent&&i.parentNode&&i.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),i)}}(o);let c=o&&o.querySelector("[data-pm-slice]"),h=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let e=+h[3];e>0;e--){let e=o.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;o=e}if(!s){let t=e.someProp("clipboardParser")||e.someProp("domParser")||Ol.fromSchema(e.state.schema);s=t.parseSlice(o,{preserveWhitespace:!(!l&&!h),context:r,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Yd.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(h)s=function(e,t){if(!e.size)return e;let n,i=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(t){return e}let{content:r,openStart:o,openEnd:s}=e;for(let e=n.length-2;e>=0;e-=2){let t=i.nodes[n[e]];if(!t||t.hasRequiredAttrs())break;r=ja.from(t.create(n[e+1],r)),o++,s++}return new Ja(r,o,s)}(qd(s,+h[1],+h[2]),h[4]);else if(s=Ja.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let i,r=t.node(n).contentMatchAt(t.index(n)),o=[];if(e.forEach((e=>{if(!o)return;let t,n=r.findWrapping(e.type);if(!n)return o=null;if(t=o.length&&i.length&&Jd(n,i,e,o[o.length-1],0))o[o.length-1]=t;else{o.length&&(o[o.length-1]=Kd(o[o.length-1],i.length));let t=Xd(e,n);o.push(t),r=r.matchType(t.type),i=n}})),o)return ja.from(o)}return e}(s.content,r),!0),s.openStart||s.openEnd){let e=0,t=0;for(let t=s.content.firstChild;e<s.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=s.content.lastChild;t<s.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);s=qd(s,e,t)}return e.someProp("transformPasted",(t=>{s=t(s,e)})),s}const Yd=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Xd(e,t,n=0){for(let i=t.length-1;i>=n;i--)e=t[i].create(null,ja.from(e));return e}function Jd(e,t,n,i,r){if(r<e.length&&r<t.length&&e[r]==t[r]){let o=Jd(e,t,n,i.lastChild,r+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(r==e.length-1?n.type:e[r+1]))return i.copy(i.content.append(ja.from(Xd(n,e,r+1))))}}function Kd(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Kd(e.lastChild,t-1)),i=e.contentMatchAt(e.childCount).fillBefore(ja.empty,!0);return e.copy(n.append(i))}function $d(e,t,n,i,r,o){let s=t<0?e.firstChild:e.lastChild,a=s.content;return e.childCount>1&&(o=0),r<i-1&&(a=$d(a,t,n,i,r+1,o)),r>=n&&(a=t<0?s.contentMatchAt(0).fillBefore(a,o<=r).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(ja.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,s.copy(a))}function qd(e,t,n){return t<e.openStart&&(e=new Ja($d(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new Ja($d(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const Qd={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let eu=null;function tu(){return eu||(eu=document.implementation.createHTMLDocument("title"))}const nu={},iu={},ru={touchstart:!0,touchmove:!0};class ou{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function su(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function au(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>lu(e,t))}))}function lu(e,t){return e.someProp("handleDOMEvents",(n=>{let i=n[t.type];return!!i&&(i(e,t)||t.defaultPrevented)}))}function cu(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function hu(e){return{left:e.clientX,top:e.clientY}}function du(e,t,n,i,r){if(-1==i)return!1;let o=e.state.doc.resolve(i);for(let i=o.depth+1;i>0;i--)if(e.someProp(t,(t=>i>o.depth?t(e,n,o.nodeAfter,o.before(i),r,!0):t(e,n,o.node(i),o.before(i),r,!1))))return!0;return!1}function uu(e,t,n){e.focused||e.focus();let i=e.state.tr.setSelection(t);"pointer"==n&&i.setMeta("pointer",!0),e.dispatch(i)}function pu(e,t,n,i){return du(e,"handleDoubleClickOn",t,n,i)||e.someProp("handleDoubleClick",(n=>n(e,t,i)))}function mu(e,t,n,i){return du(e,"handleTripleClickOn",t,n,i)||e.someProp("handleTripleClick",(n=>n(e,t,i)))||function(e,t,n){if(0!=n.button)return!1;let i=e.state.doc;if(-1==t)return!!i.inlineContent&&(uu(e,Lc.create(i,0,i.content.size),"pointer"),!0);let r=i.resolve(t);for(let t=r.depth+1;t>0;t--){let n=t>r.depth?r.nodeAfter:r.node(t),o=r.before(t);if(n.inlineContent)uu(e,Lc.create(i,o+1,o+1+n.content.size),"pointer");else{if(!Zc.isSelectable(n))continue;uu(e,Zc.create(i,o),"pointer")}return!0}}(e,n,i)}function fu(e){return xu(e)}iu.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!vu(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!kh||!xh||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!Sh||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||function(e,t){let n=t.keyCode,i=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||Mh&&72==n&&"c"==i)return jd(e,-1)||Bd(e,-1);if(46==n&&!t.shiftKey||Mh&&68==n&&"c"==i)return jd(e,1)||Bd(e,1);if(13==n||27==n)return!0;if(37==n||Mh&&66==n&&"c"==i){let t=37==n?"ltr"==Vd(e,e.state.selection.from)?-1:1:-1;return Pd(e,t,i)||Bd(e,t)}if(39==n||Mh&&70==n&&"c"==i){let t=39==n?"ltr"==Vd(e,e.state.selection.from)?1:-1:1;return Pd(e,t,i)||Bd(e,t)}return 38==n||Mh&&80==n&&"c"==i?Gd(e,-1,i)||Bd(e,-1):40==n||Mh&&78==n&&"c"==i?function(e){if(!Eh||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;Wd(e,n,"true"),setTimeout((()=>Wd(e,n,"false")),20)}return!1}(e)||Gd(e,1,i)||Zd(e):i==(Mh?"m":"c")&&(66==n||73==n||89==n||90==n)}(e,n)?n.preventDefault():su(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,dh(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},iu.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},iu.keypress=(e,t)=>{let n=t;if(vu(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Mh&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let i=e.state.selection;if(!(i instanceof Lc&&i.$from.sameParent(i.$to))){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,i.$from.pos,i.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const gu=Mh?"metaKey":"ctrlKey";nu.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let i=fu(e),r=Date.now(),o="singleClick";r-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,i=t.y-e.clientY;return n*n+i*i<100}(n,e.input.lastClick)&&!n[gu]&&("singleClick"==e.input.lastClick.type?o="doubleClick":"doubleClick"==e.input.lastClick.type&&(o="tripleClick")),e.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:o};let s=e.posAtCoords(hu(n));s&&("singleClick"==o?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new yu(e,s,n,!!i)):("doubleClick"==o?pu:mu)(e,s.pos,s.inside,n)?n.preventDefault():su(e,"pointer"))};class yu{constructor(e,t,n,i){let r,o;if(this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[gu],this.allowDefault=n.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),o=t.inside;else{let n=e.state.doc.resolve(t.pos);r=n.parent,o=n.depth?n.before():0}const s=i?null:n.target,a=s?e.docView.nearestDesc(s,!0):null;this.target=a?a.dom:null;let{selection:l}=e.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||l instanceof Zc&&l.from<=o&&l.to>o)&&(this.mightDrag={node:r,pos:o,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!wh||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),su(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>xd(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(hu(e))),this.updateAllowDefault(e),this.allowDefault||!t?su(this.view,"pointer"):function(e,t,n,i,r){return du(e,"handleClickOn",t,n,i)||e.someProp("handleClick",(n=>n(e,t,i)))||(r?function(e,t){if(-1==t)return!1;let n,i,r=e.state.selection;r instanceof Zc&&(n=r.node);let o=e.state.doc.resolve(t);for(let e=o.depth+1;e>0;e--){let t=e>o.depth?o.nodeAfter:o.node(e);if(Zc.isSelectable(t)){i=n&&r.$from.depth>0&&e>=r.$from.depth&&o.before(r.$from.depth+1)==r.$from.pos?o.before(r.$from.depth):o.before(e);break}}return null!=i&&(uu(e,Zc.create(e.state.doc,i),"pointer"),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),i=n.nodeAfter;return!!(i&&i.isAtom&&Zc.isSelectable(i))&&(uu(e,new Zc(n),"pointer"),!0)}(e,n))}(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Eh&&this.mightDrag&&!this.mightDrag.node.isAtom||xh&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(uu(this.view,Ac.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):su(this.view,"pointer")}move(e){this.updateAllowDefault(e),su(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function vu(e,t){return!!e.composing||!!(Eh&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}nu.touchstart=e=>{e.input.lastTouch=Date.now(),fu(e),su(e,"pointer")},nu.touchmove=e=>{e.input.lastTouch=Date.now(),su(e,"pointer")},nu.contextmenu=e=>fu(e);const bu=kh?5e3:-1;function wu(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>xu(e)),t))}function _u(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function xu(e,t=!1){if(!(kh&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),_u(e),t||e.docView&&e.docView.dirty){let t=wd(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}iu.compositionstart=iu.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),xu(e,!0),e.markCursor=null;else if(xu(e),wh&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,i=t.focusOffset;n&&1==n.nodeType&&0!=i;){let t=i<0?n.lastChild:n.childNodes[i-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}n=t,i=-1}}e.input.composing=!0}wu(e,bu)},iu.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionID++,wu(e,20))};const Cu=vh&&bh<15||Sh&&Nh<604;function Eu(e,t,n,i,r){let o=Ud(e,t,n,i,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,r,o||Ja.empty))))return!0;if(!o)return!1;let s=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(o),a=s?e.state.tr.replaceSelectionWith(s,i):e.state.tr.replaceSelection(o);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}nu.copy=iu.cut=(e,t)=>{let n=t,i=e.state.selection,r="cut"==n.type;if(i.empty)return;let o=Cu?null:n.clipboardData,s=i.content(),{dom:a,text:l}=Hd(e,s);o?(n.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),r=document.createRange();r.selectNodeContents(t),e.dom.blur(),i.removeAllRanges(),i.addRange(r),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,a),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},iu.paste=(e,t)=>{let n=t;if(e.composing&&!kh)return;let i=Cu?null:n.clipboardData,r=e.input.shiftKey&&45!=e.input.lastKeyCode;i&&Eu(e,i.getData("text/plain"),i.getData("text/html"),r,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,i=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus();let r=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout((()=>{e.focus(),i.parentNode&&i.parentNode.removeChild(i),n?Eu(e,i.value,null,r,t):Eu(e,i.textContent,i.innerHTML,r,t)}),50)}(e,n)};class Su{constructor(e,t){this.slice=e,this.move=t}}const Mu=Mh?"altKey":"ctrlKey";nu.dragstart=(e,t)=>{let n=t,i=e.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let r=e.state.selection,o=r.empty?null:e.posAtCoords(hu(n));if(o&&o.pos>=r.from&&o.pos<=(r instanceof Zc?r.to-1:r.to));else if(i&&i.mightDrag)e.dispatch(e.state.tr.setSelection(Zc.create(e.state.doc,i.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&e.dispatch(e.state.tr.setSelection(Zc.create(e.state.doc,t.posBefore)))}let s=e.state.selection.content(),{dom:a,text:l}=Hd(e,s);n.dataTransfer.clearData(),n.dataTransfer.setData(Cu?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",Cu||n.dataTransfer.setData("text/plain",l),e.dragging=new Su(s,!n[Mu])},nu.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},iu.dragover=iu.dragenter=(e,t)=>t.preventDefault(),iu.drop=(e,t)=>{let n=t,i=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let r=e.posAtCoords(hu(n));if(!r)return;let o=e.state.doc.resolve(r.pos),s=i&&i.slice;s?e.someProp("transformPasted",(t=>{s=t(s,e)})):s=Ud(e,n.dataTransfer.getData(Cu?"Text":"text/plain"),Cu?null:n.dataTransfer.getData("text/html"),!1,o);let a=!(!i||n[Mu]);if(e.someProp("handleDrop",(t=>t(e,n,s||Ja.empty,a))))return void n.preventDefault();if(!s)return;n.preventDefault();let l=s?gc(e.state.doc,o.pos,s):o.pos;null==l&&(l=o.pos);let c=e.state.tr;a&&c.deleteSelection();let h=c.mapping.map(l),d=0==s.openStart&&0==s.openEnd&&1==s.content.childCount,u=c.doc;if(d?c.replaceRangeWith(h,h,s.content.firstChild):c.replaceRange(h,h,s),c.doc.eq(u))return;let p=c.doc.resolve(h);if(d&&Zc.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new Zc(p));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((e,n,i,r)=>t=r)),c.setSelection(Td(e,p,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},nu.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&xd(e)}),20))},nu.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},nu.beforeinput=(e,t)=>{if(xh&&kh&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,dh(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let e in iu)nu[e]=iu[e];function Iu(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class ku{constructor(e,t){this.toDOM=e,this.spec=t||Ou,this.side=this.spec.side||0}map(e,t,n,i){let{pos:r,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new Ru(r-n,r-n,this)}valid(){return!0}eq(e){return this==e||e instanceof ku&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Iu(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Tu{constructor(e,t){this.attrs=e,this.spec=t||Ou}map(e,t,n,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return r>=o?null:new Ru(r,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Tu&&Iu(this.attrs,e.attrs)&&Iu(this.spec,e.spec)}static is(e){return e.type instanceof Tu}destroy(){}}class Nu{constructor(e,t){this.attrs=e,this.spec=t||Ou}map(e,t,n,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=r.pos?null:new Ru(r.pos-n,o.pos-n,this)}valid(e,t){let n,{index:i,offset:r}=e.content.findIndex(t.from);return r==t.from&&!(n=e.child(i)).isText&&r+n.nodeSize==t.to}eq(e){return this==e||e instanceof Nu&&Iu(this.attrs,e.attrs)&&Iu(this.spec,e.spec)}destroy(){}}class Ru{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Ru(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Ru(e,e,new ku(t,n))}static inline(e,t,n,i){return new Ru(e,t,new Tu(n,i))}static node(e,t,n,i){return new Ru(e,t,new Nu(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Tu}}const Au=[],Ou={};class Pu{constructor(e,t){this.local=e.length?e:Au,this.children=t.length?t:Au}static create(e,t){return t.length?Fu(t,e,0,Ou):Du}find(e,t,n){let i=[];return this.findInner(null==e?0:e,null==t?1e9:t,i,0,n),i}findInner(e,t,n,i,r){for(let o=0;o<this.local.length;o++){let s=this.local[o];s.from<=t&&s.to>=e&&(!r||r(s.spec))&&n.push(s.copy(s.from+i,s.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let s=this.children[o]+1;this.children[o+2].findInner(e-s,t-s,n,i+s,r)}}map(e,t,n){return this==Du||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Ou)}mapInner(e,t,n,i,r){let o;for(let s=0;s<this.local.length;s++){let a=this.local[s].map(e,n,i);a&&a.type.valid(t,a)?(o||(o=[])).push(a):r.onRemove&&r.onRemove(this.local[s].spec)}return this.children.length?function(e,t,n,i,r,o,s){let a=e.slice();for(let e=0,t=o;e<n.maps.length;e++){let i=0;n.maps[e].forEach(((e,n,o,s)=>{let l=s-o-(n-e);for(let s=0;s<a.length;s+=3){let c=a[s+1];if(c<0||e>c+t-i)continue;let h=a[s]+t-i;n>=h?a[s+1]=e<=h?-2:-1:o>=r&&l&&(a[s]+=l,a[s+1]+=l)}i+=l})),t=n.maps[e].map(t,-1)}let l=!1;for(let t=0;t<a.length;t+=3)if(a[t+1]<0){if(-2==a[t+1]){l=!0,a[t+1]=-1;continue}let c=n.map(e[t]+o),h=c-r;if(h<0||h>=i.content.size){l=!0;continue}let d=n.map(e[t+1]+o,-1)-r,{index:u,offset:p}=i.content.findIndex(h),m=i.maybeChild(u);if(m&&p==h&&p+m.nodeSize==d){let i=a[t+2].mapInner(n,m,c+1,e[t]+o+1,s);i!=Du?(a[t]=h,a[t+1]=d,a[t+2]=i):(a[t+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,i,r,o,s){function a(e,t){for(let o=0;o<e.local.length;o++){let a=e.local[o].map(i,r,t);a?n.push(a):s.onRemove&&s.onRemove(e.local[o].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)-1==e[n+1]&&a(e[n+2],t[n]+o+1);return n}(a,e,t,n,r,o,s),c=Fu(l,i,0,s);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new Pu(t.sort(Vu),a)}(this.children,o||[],e,t,n,i,r):o?new Pu(o.sort(Vu),Au):Du}add(e,t){return t.length?this==Du?Pu.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,r=0;e.forEach(((e,o)=>{let s,a=o+n;if(s=Zu(t,e,a)){for(i||(i=this.children.slice());r<i.length&&i[r]<o;)r+=3;i[r]==o?i[r+2]=i[r+2].addInner(e,s,a+1):i.splice(r,0,o,o+e.nodeSize,Fu(s,e,a+1,Ou)),r+=3}}));let o=Bu(r?zu(t):t,-n);for(let t=0;t<o.length;t++)o[t].type.valid(e,o[t])||o.splice(t--,1);return new Pu(o.length?this.local.concat(o).sort(Vu):this.local,i||this.children)}remove(e){return 0==e.length||this==Du?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let i=0;i<n.length;i+=3){let r,o=n[i]+t,s=n[i+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>o&&t.to<s&&(e[n]=null,(r||(r=[])).push(t));if(!r)continue;n==this.children&&(n=this.children.slice());let a=n[i+2].removeInner(r,o+1);a!=Du?n[i+2]=a:(n.splice(i,3),i-=3)}if(i.length)for(let n,r=0;r<e.length;r++)if(n=e[r])for(let e=0;e<i.length;e++)i[e].eq(n,t)&&(i==this.local&&(i=this.local.slice()),i.splice(e--,1));return n==this.children&&i==this.local?this:i.length||n.length?new Pu(i,n):Du}forChild(e,t){if(this==Du)return this;if(t.isLeaf)return Pu.empty;let n,i;for(let t=0;t<this.children.length;t+=3)if(this.children[t]>=e){this.children[t]==e&&(n=this.children[t+2]);break}let r=e+1,o=r+t.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<o&&t.to>r&&t.type instanceof Tu){let e=Math.max(r,t.from)-r,n=Math.min(o,t.to)-r;e<n&&(i||(i=[])).push(t.copy(e,n))}}if(i){let e=new Pu(i.sort(Vu),Au);return n?new Lu([e,n]):e}return n||Du}eq(e){if(this==e)return!0;if(!(e instanceof Pu)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Gu(this.localsInner(e))}localsInner(e){if(this==Du)return Au;if(e.inlineContent||!this.local.some(Tu.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof Tu||t.push(this.local[e]);return t}}Pu.empty=new Pu([],[]),Pu.removeOverlap=Gu;const Du=Pu.empty;class Lu{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,Ou)));return Lu.from(n)}forChild(e,t){if(t.isLeaf)return Pu.empty;let n=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=Du&&(r instanceof Lu?n=n.concat(r.members):n.push(r))}return Lu.from(n)}eq(e){if(!(e instanceof Lu)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<r.length;e++)t.push(r[e])}else t=r}return t?Gu(n?t:t.sort(Vu)):Au}static from(e){switch(e.length){case 0:return Du;case 1:return e[0];default:return new Lu(e.every((e=>e instanceof Pu))?e:e.reduce(((e,t)=>e.concat(t instanceof Pu?t:t.members)),[]))}}}function Bu(e,t){if(!t||!e.length)return e;let n=[];for(let i=0;i<e.length;i++){let r=e[i];n.push(new Ru(r.from+t,r.to+t,r.type))}return n}function Zu(e,t,n){if(t.isLeaf)return null;let i=n+t.nodeSize,r=null;for(let t,o=0;o<e.length;o++)(t=e[o])&&t.from>n&&t.to<i&&((r||(r=[])).push(t),e[o]=null);return r}function zu(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function Fu(e,t,n,i){let r=[],o=!1;t.forEach(((t,s)=>{let a=Zu(e,t,s+n);if(a){o=!0;let e=Fu(a,t,n+s+1,i);e!=Du&&r.push(s,s+t.nodeSize,e)}}));let s=Bu(o?zu(e):e,-n).sort(Vu);for(let e=0;e<s.length;e++)s[e].type.valid(t,s[e])||(i.onRemove&&i.onRemove(s[e].spec),s.splice(e--,1));return s.length||r.length?new Pu(s,r):Du}function Vu(e,t){return e.from-t.from||e.to-t.to}function Gu(e){let t=e;for(let n=0;n<t.length-1;n++){let i=t[n];if(i.from!=i.to)for(let r=n+1;r<t.length;r++){let o=t[r];if(o.from!=i.from){o.from<i.to&&(t==e&&(t=e.slice()),t[n]=i.copy(i.from,o.from),ju(t,r,i.copy(o.from,i.to)));break}o.to!=i.to&&(t==e&&(t=e.slice()),t[r]=o.copy(o.from,i.to),ju(t,r+1,o.copy(i.to,o.to)))}}return t}function ju(e,t,n){for(;t<e.length&&Vu(n,e[t])>0;)t++;e.splice(t,0,n)}function Wu(e){let t=[];return e.someProp("decorations",(n=>{let i=n(e.state);i&&i!=Du&&t.push(i)})),e.cursorWrapper&&t.push(Pu.create(e.state.doc,[e.cursorWrapper.deco])),Lu.from(t)}const Hu={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Uu=vh&&bh<=11;class Yu{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Xu{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Yu,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);vh&&bh<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Uu&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Hu)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(Nd(this.view)){if(this.suppressingSelectionUpdates)return xd(this.view);if(vh&&bh<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&oh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let t=e.focusNode;t;t=nh(t))n.add(t);for(let i=e.anchorNode;i;i=nh(i))if(n.has(i)){t=i;break}let i=t&&this.view.docView.nearestDesc(t);return i&&i.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Nd(e)&&!this.ignoreSelectionChange(n),r=-1,o=-1,s=!1,a=[];if(e.editable)for(let e=0;e<t.length;e++){let n=this.registerMutation(t[e],a);n&&(r=r<0?n.from:Math.min(n.from,r),o=o<0?n.to:Math.max(n.to,o),n.typeOver&&(s=!0))}if(wh&&a.length>1){let e=a.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],n=e[1];t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}}let l=null;r<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&hh(n)&&(l=wd(e))&&l.eq(Ac.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,xd(e),this.currentSelection.set(n),e.scrollToSelection()):(r>-1||i)&&(r>-1&&(e.docView.markDirty(r,o),function(e){if(!Ju.has(e)&&(Ju.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace))){if(e.requiresGeckoHackNode=wh,Ku)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Ku=!0}}(e)),this.handleDOMChange(r,o,s,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||xd(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++)t.push(e.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,r=e.nextSibling;if(vh&&bh<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:o}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(i=n),(!o||Array.prototype.indexOf.call(e.addedNodes,o)<0)&&(r=o)}let o=i&&i.parentNode==e.target?th(i)+1:0,s=n.localPosFromDOM(e.target,o,-1),a=r&&r.parentNode==e.target?th(r):e.target.childNodes.length;return{from:s,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let Ju=new WeakMap,Ku=!1;function $u(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Eh&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Eh&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const qu=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Qu(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Td(e,t.resolve(n.anchor),t.resolve(n.head))}function ep(e,t,n){let i=e.depth,r=t?e.end():e.pos;for(;i>0&&(t||e.indexAfter(i)==e.node(i).childCount);)i--,r++,t=!1;if(n){let t=e.node(i).maybeChild(e.indexAfter(i));for(;t&&!t.isLeaf;)t=t.firstChild,r++}return r}class tp{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new ou,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(sp),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=rp(this),ip(this),this.nodeViews=op(this),this.docView=rd(this.state.doc,np(this),Wu(this),this.dom,this),this.domObserver=new Xu(this,((e,t,n,i)=>function(e,t,n,i,r){if(t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=wd(e,t);if(n&&!e.state.selection.eq(n)){if(xh&&kh&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,dh(13,"Enter")))))return;let i=e.state.tr.setSelection(n);"pointer"==t?i.setMeta("pointer",!0):"key"==t&&i.scrollIntoView(),e.composing&&i.setMeta("composition",e.input.compositionID),e.dispatch(i)}return}let o=e.state.doc.resolve(t),s=o.sharedDepth(n);t=o.before(s+1),n=e.state.doc.resolve(n).after(s+1);let a,l,c=e.state.selection,h=function(e,t,n){let i,{node:r,fromOffset:o,toOffset:s,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),h=c.anchorNode;if(h&&e.dom.contains(1==h.nodeType?h:h.parentNode)&&(i=[{node:h,offset:c.anchorOffset}],hh(c)||i.push({node:c.focusNode,offset:c.focusOffset})),xh&&8===e.input.lastKeyCode)for(let e=s;e>o;e--){let t=r.childNodes[e-1],n=t.pmViewDesc;if("BR"==t.nodeName&&!n){s=e;break}if(!n||n.size)break}let d=e.state.doc,u=e.someProp("domParser")||Ol.fromSchema(e.state.schema),p=d.resolve(a),m=null,f=u.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:o,to:s,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:i,ruleFromNode:$u,context:p});if(i&&null!=i[0].pos){let e=i[0].pos,t=i[1]&&i[1].pos;null==t&&(t=e),m={anchor:e+a,head:t+a}}return{doc:f,sel:m,from:a,to:l}}(e,t,n),d=e.state.doc,u=d.slice(h.from,h.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(a=e.state.selection.to,l="end"):(a=e.state.selection.from,l="start"),e.input.lastKeyCode=null;let p=function(e,t,n,i,r){let o=e.findDiffStart(t,n);if(null==o)return null;let{a:s,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);return"end"==r&&(i-=s+Math.max(0,o-Math.min(s,a))-o),s<o&&e.size<t.size?(o-=i<=o&&i>=s?o-i:0,a=o+(a-s),s=o):a<o&&(o-=i<=o&&i>=a?o-i:0,s=o+(s-a),a=o),{start:o,endA:s,endB:a}}(u.content,h.doc.content,h.from,a,l);if((Sh&&e.input.lastIOSEnter>Date.now()-225||kh)&&r.some((e=>1==e.nodeType&&!qu.test(e.nodeName)))&&(!p||p.endA>=p.endB)&&e.someProp("handleKeyDown",(t=>t(e,dh(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!p){if(!(i&&c instanceof Lc&&!c.empty&&c.$head.sameParent(c.$anchor))||e.composing||h.sel&&h.sel.anchor!=h.sel.head){if(h.sel){let t=Qu(e,e.state.doc,h.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);e.composing&&n.setMeta("composition",e.input.compositionID),e.dispatch(n)}}return}p={start:c.from,endA:c.to,endB:c.to}}if(xh&&e.cursorWrapper&&h.sel&&h.sel.anchor==e.cursorWrapper.deco.from&&h.sel.head==h.sel.anchor){let e=p.endB-p.start;h.sel={anchor:h.sel.anchor+e,head:h.sel.anchor+e}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&p.start==p.endB&&e.state.selection instanceof Lc&&(p.start>e.state.selection.from&&p.start<=e.state.selection.from+2&&e.state.selection.from>=h.from?p.start=e.state.selection.from:p.endA<e.state.selection.to&&p.endA>=e.state.selection.to-2&&e.state.selection.to<=h.to&&(p.endB+=e.state.selection.to-p.endA,p.endA=e.state.selection.to)),vh&&bh<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>h.from&&"  "==h.doc.textBetween(p.start-h.from-1,p.start-h.from+1)&&(p.start--,p.endA--,p.endB--);let m,f=h.doc.resolveNoCache(p.start-h.from),g=h.doc.resolveNoCache(p.endB-h.from),y=d.resolve(p.start),v=f.sameParent(g)&&f.parent.inlineContent&&y.end()>=p.endA;if((Sh&&e.input.lastIOSEnter>Date.now()-225&&(!v||r.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!v&&f.pos<h.doc.content.size&&!f.sameParent(g)&&(m=Ac.findFrom(h.doc.resolve(f.pos+1),1,!0))&&m.head==g.pos)&&e.someProp("handleKeyDown",(t=>t(e,dh(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>p.start&&function(e,t,n,i,r){if(!i.parent.isTextblock||n-t<=r.pos-i.pos||ep(i,!0,!1)<r.pos)return!1;let o=e.resolve(t);if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=e.resolve(ep(o,!0,!0));return!(!s.parent.isTextblock||s.pos>n||ep(s,!0,!1)<n)&&i.parent.content.cut(i.parentOffset).eq(s.parent.content)}(d,p.start,p.endA,f,g)&&e.someProp("handleKeyDown",(t=>t(e,dh(8,"Backspace")))))return void(kh&&xh&&e.domObserver.suppressSelectionUpdates());xh&&kh&&p.endB==p.start&&(e.input.lastAndroidDelete=Date.now()),kh&&!v&&f.start()!=g.start()&&0==g.parentOffset&&f.depth==g.depth&&h.sel&&h.sel.anchor==h.sel.head&&h.sel.head==p.endA&&(p.endB-=2,g=h.doc.resolveNoCache(p.endB-h.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,dh(13,"Enter"))}))}),20));let b,w,_,x=p.start,C=p.endA;if(v)if(f.pos==g.pos)vh&&bh<=11&&0==f.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>xd(e)),20)),b=e.state.tr.delete(x,C),w=d.resolve(p.start).marksAcross(d.resolve(p.endA));else if(p.endA==p.endB&&(_=function(e,t){let n,i,r,o=e.firstChild.marks,s=t.firstChild.marks,a=o,l=s;for(let e=0;e<s.length;e++)a=s[e].removeFromSet(a);for(let e=0;e<o.length;e++)l=o[e].removeFromSet(l);if(1==a.length&&0==l.length)i=a[0],n="add",r=e=>e.mark(i.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;i=l[0],n="remove",r=e=>e.mark(i.removeFromSet(e.marks))}let c=[];for(let e=0;e<t.childCount;e++)c.push(r(t.child(e)));if(ja.from(c).eq(e))return{mark:i,type:n}}(f.parent.content.cut(f.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start()))))b=e.state.tr,"add"==_.type?b.addMark(x,C,_.mark):b.removeMark(x,C,_.mark);else if(f.parent.child(f.index()).isText&&f.index()==g.index()-(g.textOffset?0:1)){let t=f.parent.textBetween(f.parentOffset,g.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,x,C,t))))return;b=e.state.tr.insertText(t,x,C)}if(b||(b=e.state.tr.replace(x,C,h.doc.slice(p.start-h.from,p.endB-h.from))),h.sel){let t=Qu(e,b.doc,h.sel);t&&!(xh&&kh&&e.composing&&t.empty&&(p.start!=p.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==x||t.head==b.mapping.map(C)-1)||vh&&t.empty&&t.head==x)&&b.setSelection(t)}w&&b.ensureMarks(w),e.composing&&b.setMeta("composition",e.input.compositionID),e.dispatch(b.scrollIntoView())}(this,e,t,n,i))),this.domObserver.start(),function(e){for(let t in nu){let n=nu[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!cu(e,t)||lu(e,t)||!e.editable&&t.type in iu||n(e,t)},ru[t]?{passive:!0}:void 0)}Eh&&e.dom.addEventListener("input",(()=>null)),au(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&au(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(sp),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,i=!1,r=!1;e.storedMarks&&this.composing&&(_u(this),r=!0),this.state=e;let o=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(o||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=op(this);(function(e,t){let n=0,i=0;for(let i in e){if(e[i]!=t[i])return!0;n++}for(let e in t)i++;return n!=i})(e,this.nodeViews)&&(this.nodeViews=e,i=!0)}(o||t.handleDOMEvents!=this._props.handleDOMEvents)&&au(this),this.editable=rp(this),ip(this);let s=Wu(this),a=np(this),l=n.plugins==e.plugins||n.doc.eq(e.doc)?e.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",c=i||!this.docView.matchesNode(e.doc,a,s);!c&&e.selection.eq(n.selection)||(r=!0);let h="preserve"==l&&r&&null==this.dom.style.overflowAnchor&&function(e){let t,n,i=e.dom.getBoundingClientRect(),r=Math.max(0,i.top);for(let o=(i.left+i.right)/2,s=r+1;s<Math.min(innerHeight,i.bottom);s+=5){let i=e.root.elementFromPoint(o,s);if(!i||i==e.dom||!e.dom.contains(i))continue;let a=i.getBoundingClientRect();if(a.top>=r-20){t=i,n=a.top;break}}return{refDOM:t,refTop:n,stack:Dh(e.dom)}}(this);if(r){this.domObserver.stop();let t=c&&(vh||xh)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(n.selection,e.selection);if(c){let n=xh?this.trackWrites=this.domSelectionRange().focusNode:null;!i&&this.docView.update(e.doc,a,s,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=rd(e.doc,a,s,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return oh(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?xd(this,t):(Id(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():h&&function({refDOM:e,refTop:t,stack:n}){let i=e?e.getBoundingClientRect().top:0;Lh(n,0==i?0:i-t)}(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof Zc){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&Ph(this,t.getBoundingClientRect(),e)}else Ph(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}someProp(e,t){let n,i=this._props&&this._props[e];if(null!=i&&(n=t?t(i):i))return n;for(let i=0;i<this.directPlugins.length;i++){let r=this.directPlugins[i].props[e];if(null!=r&&(n=t?t(r):r))return n}let r=this.state.plugins;if(r)for(let i=0;i<r.length;i++){let o=r[i].props[e];if(null!=o&&(n=t?t(o):o))return n}}hasFocus(){if(vh){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(Bh)return e.focus(Bh);let t=Dh(e);e.focus(null==Bh?{get preventScroll(){return Bh={preventScroll:!0},!0}}:void 0),Bh||(Bh=!1,Lh(t,0))}(this.dom),xd(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return e||document}posAtCoords(e){return Vh(this,e)}coordsAtPos(e,t=1){return Hh(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let i=this.docView.posFromDOM(e,t,n);if(null==i)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return function(e,t,n){return Kh==t&&$h==n?qh:(Kh=t,$h=n,qh="up"==n||"down"==n?function(e,t,n){let i=t.selection,r="up"==n?i.$from:i.$to;return Xh(e,t,(()=>{let{node:t}=e.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let i=Hh(e,r.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=rh(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let r=t[e];if(r.bottom>r.top+1&&("up"==n?i.top-r.top>2*(r.bottom-i.top):r.bottom-i.bottom>2*(i.bottom-r.top)))return!1}}return!0}))}(e,t,n):function(e,t,n){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let r=i.parentOffset,o=!r,s=r==i.parent.content.size,a=e.domSelection();return Jh.test(i.parent.textContent)&&a.modify?Xh(e,t,(()=>{let{focusNode:t,focusOffset:r,anchorNode:o,anchorOffset:s}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=i.depth?e.docView.domAfterPos(i.before()):e.dom,{focusNode:h,focusOffset:d}=e.domSelectionRange(),u=h&&!c.contains(1==h.nodeType?h:h.parentNode)||t==h&&r==d;try{a.collapse(o,s),t&&(t!=o||r!=s)&&a.extend&&a.extend(t,r)}catch(e){}return null!=l&&(a.caretBidiLevel=l),u})):"left"==n||"backward"==n?o:s}(e,t,n))}(this,t||this.state,e)}pasteHTML(e,t){return Eu(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Eu(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Wu(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){lu(e,t)||!nu[t.type]||!e.editable&&t.type in iu||nu[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Eh&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom?function(e){let t;function n(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}e.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",n,!0);let i=t.startContainer,r=t.startOffset,o=t.endContainer,s=t.endOffset,a=e.domAtPos(e.state.selection.anchor);return oh(a.node,a.offset,o,s)&&([i,r,o,s]=[o,s,i,r]),{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:s}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function np(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e?t.class+=" "+n[e]:"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),t.translate||(t.translate="no"),[Ru.node(0,e.state.doc.content.size,t)]}function ip(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Ru.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function rp(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function op(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function sp(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var ap={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},lp={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},cp="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),hp="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),dp=0;dp<10;dp++)ap[48+dp]=ap[96+dp]=String(dp);for(dp=1;dp<=24;dp++)ap[dp+111]="F"+dp;for(dp=65;dp<=90;dp++)ap[dp]=String.fromCharCode(dp+32),lp[dp]=String.fromCharCode(dp);for(var up in ap)lp.hasOwnProperty(up)||(lp[up]=ap[up]);const pp="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function mp(e){let t,n,i,r,o=e.split(/-(?!$)/),s=o[o.length-1];"Space"==s&&(s=" ");for(let e=0;e<o.length-1;e++){let s=o[e];if(/^(cmd|meta|m)$/i.test(s))r=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else if(/^s(hift)?$/i.test(s))i=!0;else{if(!/^mod$/i.test(s))throw new Error("Unrecognized modifier name: "+s);pp?r=!0:n=!0}}return t&&(s="Alt-"+s),n&&(s="Ctrl-"+s),r&&(s="Meta-"+s),i&&(s="Shift-"+s),s}function fp(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function gp(e){let t=function(e){let t=Object.create(null);for(let n in e)t[mp(n)]=e[n];return t}(e);return function(e,n){let i,r=function(e){var t=!(cp&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||hp&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?lp:ap)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),o=t[fp(r,n)];if(o&&o(e.state,e.dispatch,e))return!0;if(1==r.length&&" "!=r){if(n.shiftKey){let i=t[fp(r,n,!1)];if(i&&i(e.state,e.dispatch,e))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(i=ap[n.keyCode])&&i!=r){let r=t[fp(i,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}const yp=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);const vp=(e,t,n)=>{let i=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}(e,n);if(!i)return!1;let r=xp(i);if(!r){let n=i.blockRange(),r=n&&cc(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let o=r.nodeBefore;if(!o.type.spec.isolating&&Ap(e,r,t))return!0;if(0==i.parent.content.size&&(bp(o,"end")||Zc.isSelectable(o))){let n=yc(e.doc,i.before(),i.after(),Ja.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(bp(o,"end")?Ac.findFrom(i.doc.resolve(i.mapping.map(r.pos,-1)),-1):Zc.create(i.doc,r.pos-o.nodeSize)),t(i.scrollIntoView())}return!0}}return!(!o.isAtom||r.depth!=i.depth-1||(t&&t(e.tr.delete(r.pos-o.nodeSize,r.pos).scrollIntoView()),0))};function bp(e,t,n=!1){for(let i=e;i;i="start"==t?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(n&&1!=i.childCount)return!1}return!1}const _p=(e,t,n)=>{let{$head:i,empty:r}=e.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):i.parentOffset>0)return!1;o=xp(i)}let s=o&&o.nodeBefore;return!(!s||!Zc.isSelectable(s)||(t&&t(e.tr.setSelection(Zc.create(e.doc,o.pos-s.nodeSize)).scrollIntoView()),0))};function xp(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}const Cp=(e,t,n)=>{let i=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}(e,n);if(!i)return!1;let r=Sp(i);if(!r)return!1;let o=r.nodeAfter;if(Ap(e,r,t))return!0;if(0==i.parent.content.size&&(bp(o,"start")||Zc.isSelectable(o))){let n=yc(e.doc,i.before(),i.after(),Ja.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(bp(o,"start")?Ac.findFrom(i.doc.resolve(i.mapping.map(r.pos)),1):Zc.create(i.doc,i.mapping.map(r.pos))),t(i.scrollIntoView())}return!0}}return!(!o.isAtom||r.depth!=i.depth-1||(t&&t(e.tr.delete(r.pos,r.pos+o.nodeSize).scrollIntoView()),0))},Ep=(e,t,n)=>{let{$head:i,empty:r}=e.selection,o=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):i.parentOffset<i.parent.content.size)return!1;o=Sp(i)}let s=o&&o.nodeAfter;return!(!s||!Zc.isSelectable(s)||(t&&t(e.tr.setSelection(Zc.create(e.doc,o.pos)).scrollIntoView()),0))};function Sp(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const Mp=(e,t)=>{let{$head:n,$anchor:i}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(i)||(t&&t(e.tr.insertText("\n").scrollIntoView()),0))};function Ip(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const kp=(e,t)=>{let{$head:n,$anchor:i}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(i))return!1;let r=n.node(-1),o=n.indexAfter(-1),s=Ip(r.contentMatchAt(o));if(!s||!r.canReplaceWith(o,o,s))return!1;if(t){let i=n.after(),r=e.tr.replaceWith(i,i,s.createAndFill());r.setSelection(Ac.near(r.doc.resolve(i),1)),t(r.scrollIntoView())}return!0},Tp=(e,t)=>{let n=e.selection,{$from:i,$to:r}=n;if(n instanceof Fc||i.parent.inlineContent||r.parent.inlineContent)return!1;let o=Ip(r.parent.contentMatchAt(r.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let n=(!i.parentOffset&&r.index()<r.parent.childCount?i:r).pos,s=e.tr.insert(n,o.createAndFill());s.setSelection(Lc.create(s.doc,n+1)),t(s.scrollIntoView())}return!0},Np=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(uc(e.doc,i))return t&&t(e.tr.split(i).scrollIntoView()),!0}let i=n.blockRange(),r=i&&cc(i);return null!=r&&(t&&t(e.tr.lift(i,r).scrollIntoView()),!0)};var Rp;function Ap(e,t,n){let i,r,o=t.nodeBefore,s=t.nodeAfter;if(o.type.spec.isolating||s.type.spec.isolating)return!1;if(function(e,t,n){let i=t.nodeBefore,r=t.nodeAfter,o=t.index();return!(!(i&&r&&i.type.compatibleContent(r.type))||(!i.content.size&&t.parent.canReplace(o-1,o)?(n&&n(e.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(o,o+1)||!r.isTextblock&&!pc(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,i.type,i.contentMatchAt(i.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(i=(r=o.contentMatchAt(o.childCount)).findWrapping(s.type))&&r.matchType(i[0]||s.type).validEnd){if(n){let r=t.pos+s.nodeSize,a=ja.empty;for(let e=i.length-1;e>=0;e--)a=ja.from(i[e].create(null,a));a=ja.from(o.copy(a));let l=e.tr.step(new sc(t.pos-1,r,t.pos,r,new Ja(a,1,0),i.length,!0)),c=r+2*i.length;pc(l.doc,c)&&l.join(c),n(l.scrollIntoView())}return!0}let l=Ac.findFrom(t,1),c=l&&l.$from.blockRange(l.$to),h=c&&cc(c);if(null!=h&&h>=t.depth)return n&&n(e.tr.lift(c,h).scrollIntoView()),!0;if(a&&bp(s,"start",!0)&&bp(o,"end")){let i=o,r=[];for(;r.push(i),!i.isTextblock;)i=i.lastChild;let a=s,l=1;for(;!a.isTextblock;a=a.firstChild)l++;if(i.canReplace(i.childCount,i.childCount,a.content)){if(n){let i=ja.empty;for(let e=r.length-1;e>=0;e--)i=ja.from(r[e].copy(i));n(e.tr.step(new sc(t.pos-r.length,t.pos+s.nodeSize,t.pos+l,t.pos+s.nodeSize-l,new Ja(i,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Op(e){return function(t,n){let i=t.selection,r=e<0?i.$from:i.$to,o=r.depth;for(;r.node(o).isInline;){if(!o)return!1;o--}return!!r.node(o).isTextblock&&(n&&n(t.tr.setSelection(Lc.create(t.doc,e<0?r.start(o):r.end(o)))),!0)}}const Pp=Op(-1),Dp=Op(1);function Lp(e,t=null){return function(n,i){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:o},$to:{pos:s}}=n.selection.ranges[i];n.doc.nodesBetween(o,s,((i,o)=>{if(r)return!1;if(i.isTextblock&&!i.hasMarkup(e,t))if(i.type==e)r=!0;else{let t=n.doc.resolve(o),i=t.index();r=t.parent.canReplaceWith(i,i+1,e)}}))}if(!r)return!1;if(i){let r=n.tr;for(let i=0;i<n.selection.ranges.length;i++){let{$from:{pos:o},$to:{pos:s}}=n.selection.ranges[i];r.setBlockType(o,s,e,t)}i(r.scrollIntoView())}return!0}}function Bp(...e){return function(t,n,i){for(let r=0;r<e.length;r++)if(e[r](t,n,i))return!0;return!1}}let Zp=Bp(yp,vp,_p),zp=Bp(yp,Cp,Ep);const Fp={Enter:Bp(Mp,Tp,Np,((e,t)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof Zc&&e.selection.node.isBlock)return!(!n.parentOffset||!uc(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.parent.isBlock)return!1;if(t){let r=i.parentOffset==i.parent.content.size,o=e.tr;(e.selection instanceof Lc||e.selection instanceof Fc)&&o.deleteSelection();let s=0==n.depth?null:Ip(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=Rp?[Rp]:r&&s?[{type:s}]:void 0,l=uc(o.doc,o.mapping.map(n.pos),1,a);if(a||l||!uc(o.doc,o.mapping.map(n.pos),1,s?[{type:s}]:void 0)||(s&&(a=[{type:s}]),l=!0),l&&(o.split(o.mapping.map(n.pos),1,a),!r&&!n.parentOffset&&n.parent.type!=s)){let e=o.mapping.map(n.before()),t=o.doc.resolve(e);s&&n.node(-1).canReplaceWith(t.index(),t.index()+1,s)&&o.setNodeMarkup(o.mapping.map(n.before()),s)}t(o.scrollIntoView())}return!0})),"Mod-Enter":kp,Backspace:Zp,"Mod-Backspace":Zp,"Shift-Backspace":Zp,Delete:zp,"Mod-Delete":zp,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new Fc(e.doc))),!0)},Vp={"Ctrl-h":Fp.Backspace,"Alt-Backspace":Fp["Mod-Backspace"],"Ctrl-d":Fp.Delete,"Ctrl-Alt-Backspace":Fp["Mod-Delete"],"Alt-Delete":Fp["Mod-Delete"],"Alt-d":Fp["Mod-Delete"],"Ctrl-a":Pp,"Ctrl-e":Dp};for(let e in Fp)Vp[e]=Fp[e];function Gp(e){const{state:t,transaction:n}=e;let{selection:i}=n,{doc:r}=n,{storedMarks:o}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return r},get tr(){return i=n.selection,r=n.doc,o=n.storedMarks,n}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();class jp{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:r}=n,o=this.buildProps(r);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(o);return r.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(r),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:o}=i,s=[],a=!!e,l=e||r.tr,c={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const i=this.buildProps(l,t),r=n(...e)(i);return s.push(r),c}]))),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||o.dispatch(l),s.every((e=>!0===e)))};return c}createCan(e){const{rawCommands:t,state:n}=this,i=e||n.tr,r=this.buildProps(i,!1);return{...Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...r,dispatch:void 0})]))),chain:()=>this.createChain(i,!1)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:o}=i;r.storedMarks&&e.setStoredMarks(r.storedMarks);const s={tr:e,editor:i,view:o,state:Gp({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(s)])))}};return s}}class Wp{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function Hp(e,t,n){return void 0===e.config[t]&&e.parent?Hp(e.parent,t,n):"function"==typeof e.config[t]?e.config[t].bind({...n,parent:e.parent?Hp(e.parent,t,n):null}):e.config[t]}function Up(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function Yp(e){const t=[],{nodeExtensions:n,markExtensions:i}=Up(e),r=[...n,...i],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const n=Hp(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage});n&&n().forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,i])=>{t.push({type:n,name:e,attribute:{...o,...i}})}))}))}))})),r.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},i=Hp(e,"addAttributes",n);if(!i)return;const r=i();Object.entries(r).forEach((([n,i])=>{const r={...o,...i};"function"==typeof(null==r?void 0:r.default)&&(r.default=r.default()),(null==r?void 0:r.isRequired)&&void 0===(null==r?void 0:r.default)&&delete r.default,t.push({type:e.name,name:n,attribute:r})}))})),t}function Xp(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function Jp(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{n[e]?n[e]="class"===e?[n[e],t].join(" "):"style"===e?[n[e],t].join("; "):t:n[e]=t})),n}),{})}function Kp(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>Jp(e,t)),{})}function $p(e){return"function"==typeof e}function qp(e,t=void 0,...n){return $p(e)?t?e.bind(t)(...n):e(...n):e}function Qp(e,t){return e.style?e:{...e,getAttrs:n=>{const i=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===i)return!1;const r=t.reduce(((e,t)=>{const i=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==i?e:{...e,[t.name]:i}}),{});return{...i,...r}}}}function em(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function tm(e,t){return t.nodes[e]||t.marks[e]||null}function nm(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}const im=(e,t=500)=>{let n="";const i=e.parentOffset;return e.parent.nodesBetween(Math.max(0,i-t),i,((e,t,r,o)=>{var s,a;const l=(null===(a=(s=e.type.spec).toText)||void 0===a?void 0:a.call(s,{node:e,pos:t,parent:r,index:o}))||e.textContent||"%leaf%";n+=l.slice(0,Math.max(0,i-t))})),n};function rm(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class om{constructor(e){this.find=e.find,this.handler=e.handler}}const sm=(e,t)=>{if(rm(t))return t.exec(e);const n=t(e);if(!n)return null;const i=[n.text];return i.index=n.index,i.input=e,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(n.replaceWith)),i};function am(e){var t;const{editor:n,from:i,to:r,text:o,rules:s,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(i);if(c.parent.type.spec.code||(null===(t=c.nodeBefore||c.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let h=!1;const d=im(c)+o;return s.forEach((e=>{if(h)return;const t=sm(d,e.find);if(!t)return;const s=l.state.tr,c=Gp({state:l.state,transaction:s}),u={from:i-(t[0].length-o.length),to:r},{commands:p,chain:m,can:f}=new jp({editor:n,state:c});null!==e.handler({state:c,range:u,match:t,commands:p,chain:m,can:f})&&s.steps.length&&(s.setMeta(a,{transform:s,from:i,to:r,text:o}),l.dispatch(s),h=!0)})),h}function lm(e){const{editor:t,rules:n}=e,i=new $c({state:{init:()=>null,apply:(e,t)=>e.getMeta(i)||(e.selectionSet||e.docChanged?null:t)},props:{handleTextInput:(e,r,o,s)=>am({editor:t,from:r,to:o,text:s,rules:n,plugin:i}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:r}=e.state.selection;r&&am({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:i})})),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:o}=e.state.selection;return!!o&&am({editor:t,from:o.pos,to:o.pos,text:"\n",rules:n,plugin:i})}},isInputRules:!0});return i}class cm{constructor(e){this.find=e.find,this.handler=e.handler}}function hm(e){const{editor:t,rules:n}=e;let i=null,r=!1,o=!1;const s=n.map((e=>new $c({view(e){const t=t=>{var n;i=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(o=i===e.dom.parentElement,!1),paste:(e,t)=>{var n;const i=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return r=!!(null==i?void 0:i.includes("data-pm-slice")),!1}}},appendTransaction:(n,i,s)=>{const a=n[0],l="paste"===a.getMeta("uiEvent")&&!r,c="drop"===a.getMeta("uiEvent")&&!o;if(!l&&!c)return;const h=i.doc.content.findDiffStart(s.doc.content),d=i.doc.content.findDiffEnd(s.doc.content);if("number"!=typeof h||!d||h===d.b)return;const u=s.tr,p=Gp({state:s,transaction:u}),m=function(e){const{editor:t,state:n,from:i,to:r,rule:o}=e,{commands:s,chain:a,can:l}=new jp({editor:t,state:n}),c=[];return n.doc.nodesBetween(i,r,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const h=Math.max(i,t),d=Math.min(r,t+e.content.size);((e,t)=>{if(rm(t))return[...e.matchAll(t)];const n=t(e);return n?n.map((t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n})):[]})(e.textBetween(h-t,d-t,void 0,"￼"),o.find).forEach((e=>{if(void 0===e.index)return;const t=h+e.index+1,i=t+e[0].length,r={from:n.tr.mapping.map(t),to:n.tr.mapping.map(i)},d=o.handler({state:n,range:r,match:e,commands:s,chain:a,can:l});c.push(d)}))})),c.every((e=>null!==e))}({editor:t,state:p,from:Math.max(h-1,0),to:d.b-1,rule:e});return m&&u.steps.length?u:void 0}})));return s}class dm{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=dm.resolve(e),this.schema=function(e,t){var n;const i=Yp(e),{nodeExtensions:r,markExtensions:o}=Up(e),s=null===(n=r.find((e=>Hp(e,"topNode"))))||void 0===n?void 0:n.name,a=Object.fromEntries(r.map((n=>{const r=i.filter((e=>e.type===n.name)),o={name:n.name,options:n.options,storage:n.storage,editor:t},s=em({...e.reduce(((e,t)=>{const i=Hp(t,"extendNodeSchema",o);return{...e,...i?i(n):{}}}),{}),content:qp(Hp(n,"content",o)),marks:qp(Hp(n,"marks",o)),group:qp(Hp(n,"group",o)),inline:qp(Hp(n,"inline",o)),atom:qp(Hp(n,"atom",o)),selectable:qp(Hp(n,"selectable",o)),draggable:qp(Hp(n,"draggable",o)),code:qp(Hp(n,"code",o)),defining:qp(Hp(n,"defining",o)),isolating:qp(Hp(n,"isolating",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=qp(Hp(n,"parseHTML",o));a&&(s.parseDOM=a.map((e=>Qp(e,r))));const l=Hp(n,"renderHTML",o);l&&(s.toDOM=e=>l({node:e,HTMLAttributes:Kp(e,r)}));const c=Hp(n,"renderText",o);return c&&(s.toText=c),[n.name,s]}))),l=Object.fromEntries(o.map((n=>{const r=i.filter((e=>e.type===n.name)),o={name:n.name,options:n.options,storage:n.storage,editor:t},s=em({...e.reduce(((e,t)=>{const i=Hp(t,"extendMarkSchema",o);return{...e,...i?i(n):{}}}),{}),inclusive:qp(Hp(n,"inclusive",o)),excludes:qp(Hp(n,"excludes",o)),group:qp(Hp(n,"group",o)),spanning:qp(Hp(n,"spanning",o)),code:qp(Hp(n,"code",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=qp(Hp(n,"parseHTML",o));a&&(s.parseDOM=a.map((e=>Qp(e,r))));const l=Hp(n,"renderHTML",o);return l&&(s.toDOM=e=>l({mark:e,HTMLAttributes:Kp(e,r)})),[n.name,s]})));return new Rl({topNode:s,nodes:a,marks:l})}(this.extensions,t),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:tm(e.name,this.schema)};"mark"===e.type&&(null===(t=qp(Hp(e,"keepOnSplit",n)))||void 0===t||t)&&this.splittableMarks.push(e.name);const i=Hp(e,"onBeforeCreate",n);i&&this.editor.on("beforeCreate",i);const r=Hp(e,"onCreate",n);r&&this.editor.on("create",r);const o=Hp(e,"onUpdate",n);o&&this.editor.on("update",o);const s=Hp(e,"onSelectionUpdate",n);s&&this.editor.on("selectionUpdate",s);const a=Hp(e,"onTransaction",n);a&&this.editor.on("transaction",a);const l=Hp(e,"onFocus",n);l&&this.editor.on("focus",l);const c=Hp(e,"onBlur",n);c&&this.editor.on("blur",c);const h=Hp(e,"onDestroy",n);h&&this.editor.on("destroy",h)}))}static resolve(e){const t=dm.sort(dm.flatten(e)),n=function(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return[...new Set(t)]}(t.map((e=>e.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t=Hp(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const n=Hp(e,"priority")||100,i=Hp(t,"priority")||100;return n>i?-1:n<i?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n=Hp(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:tm(t.name,this.schema)});return n?{...e,...n()}:e}),{})}get plugins(){const{editor:e}=this,t=dm.sort([...this.extensions].reverse()),n=[],i=[],r=t.map((t=>{const r={name:t.name,options:t.options,storage:t.storage,editor:e,type:tm(t.name,this.schema)},o=[],s=Hp(t,"addKeyboardShortcuts",r);let a={};if("mark"===t.type&&t.config.exitable&&(a.ArrowRight=()=>ef.handleExit({editor:e,mark:t})),s){const t=Object.fromEntries(Object.entries(s()).map((([t,n])=>[t,()=>n({editor:e})])));a={...a,...t}}const l=new $c({props:{handleKeyDown:gp(a)}});o.push(l);const c=Hp(t,"addInputRules",r);nm(t,e.options.enableInputRules)&&c&&n.push(...c());const h=Hp(t,"addPasteRules",r);nm(t,e.options.enablePasteRules)&&h&&i.push(...h());const d=Hp(t,"addProseMirrorPlugins",r);if(d){const e=d();o.push(...e)}return o})).flat();return[lm({editor:e,rules:n}),...hm({editor:e,rules:i}),...r]}get attributes(){return Yp(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Up(this.extensions);return Object.fromEntries(t.filter((e=>!!Hp(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),i={name:t.name,options:t.options,storage:t.storage,editor:e,type:Xp(t.name,this.schema)},r=Hp(t,"addNodeView",i);return r?[t.name,(i,o,s,a)=>{const l=Kp(i,n);return r()({editor:e,node:i,getPos:s,decorations:a,HTMLAttributes:l,extension:t})}]:[]})))}}function um(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function pm(e,t){const n={...e};return um(e)&&um(t)&&Object.keys(t).forEach((i=>{um(t[i])?i in e?n[i]=pm(e[i],t[i]):Object.assign(n,{[i]:t[i]}):Object.assign(n,{[i]:t[i]})})),n}class mm{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=qp(Hp(this,"addOptions",{name:this.name}))),this.storage=qp(Hp(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new mm(e)}configure(e={}){const t=this.extend();return t.options=pm(this.options,e),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new mm(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=qp(Hp(t,"addOptions",{name:t.name})),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}}function fm(e,t,n){const{from:i,to:r}=t,{blockSeparator:o="\n\n",textSerializers:s={}}=n||{};let a="",l=!0;return e.nodesBetween(i,r,((e,n,c,h)=>{var d;const u=null==s?void 0:s[e.type.name];u?(e.isBlock&&!l&&(a+=o,l=!0),c&&(a+=u({node:e,pos:n,parent:c,index:h,range:t}))):e.isText?(a+=null===(d=null==e?void 0:e.text)||void 0===d?void 0:d.slice(Math.max(i,n)-n,r-n),l=!1):e.isBlock&&!l&&(a+=o,l=!0)})),a}function gm(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const ym=mm.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new $c({key:new eh("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:i,selection:r}=t,{ranges:o}=r;return fm(i,{from:Math.min(...o.map((e=>e.$from.pos))),to:Math.max(...o.map((e=>e.$to.pos)))},{textSerializers:gm(n)})}}})]}});function vm(e,t,n={strict:!0}){const i=Object.keys(t);return!i.length||i.every((i=>n.strict?t[i]===e[i]:rm(t[i])?t[i].test(e[i]):t[i]===e[i]))}function bm(e,t,n={}){return e.find((e=>e.type===t&&vm(e.attrs,n)))}function wm(e,t,n={}){return!!bm(e,t,n)}function _m(e,t,n={}){if(!e||!t)return;let i=e.parent.childAfter(e.parentOffset);if(e.parentOffset===i.offset&&0!==i.offset&&(i=e.parent.childBefore(e.parentOffset)),!i.node)return;const r=bm([...i.node.marks],t,n);if(!r)return;let o=i.index,s=e.start()+i.offset,a=o+1,l=s+i.node.nodeSize;for(bm([...i.node.marks],t,n);o>0&&r.isInSet(e.parent.child(o-1).marks);)o-=1,s-=e.parent.child(o).nodeSize;for(;a<e.parent.childCount&&wm([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}function xm(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function Cm(e){return e instanceof Lc}function Em(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Sm(e,t=null){if(!t)return null;const n=Ac.atStart(e),i=Ac.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return i;const r=n.from,o=i.to;return"all"===t?Lc.create(e,Em(0,r,o),Em(e.content.size,r,o)):Lc.create(e,Em(t,r,o),Em(t,r,o))}function Mm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Im(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function km(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"==typeof e&&null!==e)try{return Array.isArray(e)&&e.length>0?ja.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(i){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",i),km("",t,n)}if("string"==typeof e){const i=Ol.fromSchema(t);return n.slice?i.parseSlice(Im(e),n.parseOptions).content:i.parse(Im(e),n.parseOptions)}return km("",t,n)}function Tm(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function Nm(e,t,n={}){const{from:i,to:r,empty:o}=e.selection,s=t?Xp(t,e.schema):null,a=[];e.doc.nodesBetween(i,r,((e,t)=>{if(e.isText)return;const n=Math.max(i,t),o=Math.min(r,t+e.nodeSize);a.push({node:e,from:n,to:o})}));const l=r-i,c=a.filter((e=>!s||s.name===e.node.type.name)).filter((e=>vm(e.node.attrs,n,{strict:!1})));return o?!!c.length:c.reduce(((e,t)=>e+t.to-t.from),0)>=l}function Rm(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Am(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,i)=>(n.includes(i)||(t[i]=e[i]),t)),{})}function Om(e,t,n={}){return km(e,t,{slice:!1,parseOptions:n})}function Pm(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}}(t.$from,e)}function Dm(e,t){const n=xm(t,e.schema),{from:i,to:r,empty:o}=e.selection,s=[];o?(e.storedMarks&&s.push(...e.storedMarks),s.push(...e.selection.$head.marks())):e.doc.nodesBetween(i,r,(e=>{s.push(...e.marks)}));const a=s.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}function Lm(e,t,n){const i=[];return e===t?n.resolve(e).marks().forEach((t=>{const r=_m(n.resolve(e-1),t.type);r&&i.push({mark:t,...r})})):n.nodesBetween(e,t,((e,t)=>{i.push(...e.marks.map((n=>({from:t,to:t+e.nodeSize,mark:n}))))})),i}function Bm(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const i=e.find((e=>e.type===t&&e.name===n));return!!i&&i.attribute.keepOnSplit})))}function Zm(e,t,n={}){const{empty:i,ranges:r}=e.selection,o=t?xm(t,e.schema):null;if(i)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!o||o.name===e.type.name)).find((e=>vm(e.attrs,n,{strict:!1})));let s=0;const a=[];if(r.forEach((({$from:t,$to:n})=>{const i=t.pos,r=n.pos;e.doc.nodesBetween(i,r,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(i,t),o=Math.min(r,t+e.nodeSize);s+=o-n,a.push(...e.marks.map((e=>({mark:e,from:n,to:o}))))}))})),0===s)return!1;const l=a.filter((e=>!o||o.name===e.mark.type.name)).filter((e=>vm(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),c=a.filter((e=>!o||e.mark.type!==o&&e.mark.type.excludes(o))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+c:l)>=s}function zm(e,t){const{nodeExtensions:n}=Up(t),i=n.find((t=>t.name===e));if(!i)return!1;const r=qp(Hp(i,"group",{name:i.name,options:i.options,storage:i.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function Fm(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const i=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(i)}}const Vm=(e,t)=>{const n=Pm((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!pc(e.doc,n.pos)||(e.join(n.pos),!0)},Gm=(e,t)=>{const n=Pm((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(n.start).after(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!pc(e.doc,i)||(e.join(i),!0)};var jm=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:i}=t,{ranges:r}=i;return!n||(r.forEach((({$from:n,$to:i})=>{e.doc.nodesBetween(n.pos,i.pos,((e,n)=>{if(e.type.isText)return;const{doc:i,mapping:r}=t,o=i.resolve(r.map(n)),s=i.resolve(r.map(n+e.nodeSize)),a=o.blockRange(s);if(!a)return;const l=cc(a);if(e.type.isTextblock){const{defaultType:e}=o.parent.contentMatchAt(o.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>Tp(e,t),deleteCurrentNode:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,i=n.$anchor.node();if(i.content.size>0)return!1;const r=e.selection.$anchor;for(let n=r.depth;n>0;n-=1)if(r.node(n).type===i.type){if(t){const t=r.before(n),i=r.after(n);e.delete(t,i).scrollIntoView()}return!0}return!1},deleteNode:e=>({tr:t,state:n,dispatch:i})=>{const r=Xp(e,n.schema),o=t.selection.$anchor;for(let e=o.depth;e>0;e-=1)if(o.node(e).type===r){if(i){const n=o.before(e),i=o.after(e);t.delete(n,i).scrollIntoView()}return!0}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{const{from:i,to:r}=e;return n&&t.delete(i,r),!0},deleteSelection:()=>({state:e,dispatch:t})=>yp(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>kp(e,t),extendMarkRange:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const o=xm(e,i.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:h}=a;if(r){const e=_m(l,o,t);if(e&&e.from<=c&&e.to>=h){const t=Lc.create(s,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:i,tr:r,dispatch:o})=>{t={scrollIntoView:!0,...t};const s=()=>{Mm()&&i.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(i.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(i.hasFocus()&&null===e||!1===e)return!0;if(o&&null===e&&!Cm(n.state.selection))return s(),!0;const a=Sm(r.doc,e)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),s()),!0},forEach:(e,t)=>n=>e.every(((e,i)=>t(e,{...n,index:i}))),insertContent:(e,t)=>({tr:n,commands:i})=>i.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:i,dispatch:r,editor:o})=>{if(r){n={parseOptions:{},updateSelection:!0,...n};const r=km(t,o.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===r.toString())return!0;let{from:s,to:a}="number"==typeof e?{from:e,to:e}:e,l=!0,c=!0;if((r.toString().startsWith("<")?r:[r]).forEach((e=>{e.check(),l=!!l&&e.isText&&0===e.marks.length,c=!!c&&e.isBlock})),s===a&&c){const{parent:e}=i.doc.resolve(s);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(s-=1,a+=1)}l?Array.isArray(t)?i.insertText(t.map((e=>e.text||"")).join(""),s,a):"object"==typeof t&&t&&t.text?i.insertText(t.text,s,a):i.insertText(t,s,a):i.replaceWith(s,a,r),n.updateSelection&&function(e,t,n){const i=e.steps.length-1;if(i<t)return;const r=e.steps[i];if(!(r instanceof oc||r instanceof sc))return;const o=e.mapping.maps[i];let s=0;o.forEach(((e,t,n,i)=>{0===s&&(s=i)})),e.setSelection(Ac.near(e.doc.resolve(s),-1))}(i,i.steps.length-1)}return!0},joinUp:()=>({state:e,dispatch:t})=>((e,t)=>{let n,i=e.selection,r=i instanceof Zc;if(r){if(i.node.isTextblock||!pc(e.doc,i.from))return!1;n=i.from}else if(n=fc(e.doc,i.from,-1),null==n)return!1;if(t){let i=e.tr.join(n);r&&i.setSelection(Zc.create(i.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(i.scrollIntoView())}return!0})(e,t),joinDown:()=>({state:e,dispatch:t})=>((e,t)=>{let n,i=e.selection;if(i instanceof Zc){if(i.node.isTextblock||!pc(e.doc,i.to))return!1;n=i.to}else if(n=fc(e.doc,i.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),joinBackward:()=>({state:e,dispatch:t})=>vp(e,t),joinForward:()=>({state:e,dispatch:t})=>Cp(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:i,dispatch:r})=>{const o=function(e){const t=e.split(/-(?!$)/);let n,i,r,o,s=t[t.length-1];"Space"===s&&(s=" ");for(let e=0;e<t.length-1;e+=1){const s=t[e];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))n=!0;else if(/^(c|ctrl|control)$/i.test(s))i=!0;else if(/^s(hift)?$/i.test(s))r=!0;else{if(!/^mod$/i.test(s))throw new Error(`Unrecognized modifier name: ${s}`);Mm()||Tm()?o=!0:i=!0}}return n&&(s=`Alt-${s}`),i&&(s=`Ctrl-${s}`),o&&(s=`Meta-${s}`),r&&(s=`Shift-${s}`),s}(e).split(/-(?!$)/),s=o.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null==l||l.steps.forEach((e=>{const t=e.map(i.mapping);t&&r&&i.maybeStep(t)})),!0},lift:(e,t={})=>({state:n,dispatch:i})=>!!Nm(n,Xp(e,n.schema),t)&&((e,t)=>{let{$from:n,$to:i}=e.selection,r=n.blockRange(i),o=r&&cc(r);return null!=o&&(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)})(n,i),liftEmptyBlock:()=>({state:e,dispatch:t})=>Np(e,t),liftListItem:e=>({state:t,dispatch:n})=>{return(i=Xp(e,t.schema),function(e,t){let{$from:n,$to:r}=e.selection,o=n.blockRange(r,(e=>e.childCount>0&&e.firstChild.type==i));return!!o&&(!t||(n.node(o.depth-1).type==i?function(e,t,n,i){let r=e.tr,o=i.end,s=i.$to.end(i.depth);o<s&&(r.step(new sc(o-1,s,o,s,new Ja(ja.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new dl(r.doc.resolve(i.$from.pos),r.doc.resolve(s),i.depth));const a=cc(i);if(null==a)return!1;r.lift(i,a);let l=r.mapping.map(o,-1)-1;return pc(r.doc,l)&&r.join(l),t(r.scrollIntoView()),!0}(e,t,i,o):function(e,t,n){let i=e.tr,r=n.parent;for(let e=n.end,t=n.endIndex-1,o=n.startIndex;t>o;t--)e-=r.child(t).nodeSize,i.delete(e-1,e+1);let o=i.doc.resolve(n.start),s=o.nodeAfter;if(i.mapping.map(n.end)!=n.start+o.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==r.childCount,c=o.node(-1),h=o.index(-1);if(!c.canReplace(h+(a?0:1),h+1,s.content.append(l?ja.empty:ja.from(r))))return!1;let d=o.pos,u=d+s.nodeSize;return i.step(new sc(d-(a?1:0),u+(l?1:0),d+1,u-1,new Ja((a?ja.empty:ja.from(r.copy(ja.empty))).append(l?ja.empty:ja.from(r.copy(ja.empty))),a?0:1,l?0:1),a?0:1)),t(i.scrollIntoView()),!0}(e,t,o)))})(t,n);var i},newlineInCode:()=>({state:e,dispatch:t})=>Mp(e,t),resetAttributes:(e,t)=>({tr:n,state:i,dispatch:r})=>{let o=null,s=null;const a=Rm("string"==typeof e?e:e.name,i.schema);return!!a&&("node"===a&&(o=Xp(e,i.schema)),"mark"===a&&(s=xm(e,i.schema)),r&&n.selection.ranges.forEach((e=>{i.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,i)=>{o&&o===e.type&&n.setNodeMarkup(i,void 0,Am(e.attrs,t)),s&&e.marks.length&&e.marks.forEach((r=>{s===r.type&&n.addMark(i,i+e.nodeSize,s.create(Am(r.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>_p(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>Ep(e,t),selectParentNode:()=>({state:e,dispatch:t})=>((e,t)=>{let n,{$from:i,to:r}=e.selection,o=i.sharedDepth(r);return 0!=o&&(n=i.before(o),t&&t(e.tr.setSelection(Zc.create(e.doc,n))),!0)})(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>Dp(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Pp(e,t),setContent:(e,t=!1,n={})=>({tr:i,editor:r,dispatch:o})=>{const{doc:s}=i,a=Om(e,r.schema,n);return o&&i.replaceWith(0,s.content.size,a).setMeta("preventUpdate",!t),!0},setMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const{selection:o}=n,{empty:s,ranges:a}=o,l=xm(e,i.schema);if(r)if(s){const e=Dm(i,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach((e=>{const r=e.$from.pos,o=e.$to.pos;i.doc.nodesBetween(r,o,((e,i)=>{const s=Math.max(i,r),a=Math.min(i+e.nodeSize,o);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&n.addMark(s,a,l.create({...e.attrs,...t}))})):n.addMark(s,a,l.create(t))}))}));return function(e,t,n){var i;const{selection:r}=t;let o=null;if(Cm(r)&&(o=r.$cursor),o){const t=null!==(i=e.storedMarks)&&void 0!==i?i:o.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:s}=r;return s.some((({$from:t,$to:i})=>{let r=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,i.pos,((e,t,i)=>{if(r)return!1;if(e.isInline){const t=!i||i.type.allowsMarkType(n),o=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));r=t&&o}return!r})),r}))}(i,n,l)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:i,chain:r})=>{const o=Xp(e,n.schema);return o.isTextblock?r().command((({commands:e})=>!!Lp(o,t)(n)||e.clearNodes())).command((({state:e})=>Lp(o,t)(e,i))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,i=Em(e,0,n.content.size),r=Zc.create(n,i);t.setSelection(r)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:i,to:r}="number"==typeof e?{from:e,to:e}:e,o=Lc.atStart(n).from,s=Lc.atEnd(n).to,a=Em(i,o,s),l=Em(r,o,s),c=Lc.create(n,a,l);t.setSelection(c)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>{const i=Xp(e,t.schema);return(r=i,function(e,t){let{$from:n,$to:i}=e.selection,o=n.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==r));if(!o)return!1;let s=o.startIndex;if(0==s)return!1;let a=o.parent,l=a.child(s-1);if(l.type!=r)return!1;if(t){let n=l.lastChild&&l.lastChild.type==a.type,i=ja.from(n?r.create():null),s=new Ja(ja.from(r.create(null,ja.from(a.type.create(null,i)))),n?3:1,0),c=o.start,h=o.end;t(e.tr.step(new sc(c-(n?3:1),h,c,h,s,1,!0)).scrollIntoView())}return!0})(t,n);var r},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:i,editor:r})=>{const{selection:o,doc:s}=t,{$from:a,$to:l}=o,c=Bm(r.extensionManager.attributes,a.node().type.name,a.node().attrs);if(o instanceof Zc&&o.node.isBlock)return!(!a.parentOffset||!uc(s,a.pos)||(i&&(e&&Fm(n,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),0));if(!a.parent.isBlock)return!1;if(i){const i=l.parentOffset===l.parent.content.size;o instanceof Lc&&t.deleteSelection();const s=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=i&&s?[{type:s,attrs:c}]:void 0,d=uc(t.doc,t.mapping.map(a.pos),1,h);if(h||d||!uc(t.doc,t.mapping.map(a.pos),1,s?[{type:s}]:void 0)||(d=!0,h=s?[{type:s,attrs:c}]:void 0),d&&(t.split(t.mapping.map(a.pos),1,h),s&&!i&&!a.parentOffset&&a.parent.type!==s)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,s)&&t.setNodeMarkup(t.mapping.map(a.before()),s)}e&&Fm(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return!0},splitListItem:e=>({tr:t,state:n,dispatch:i,editor:r})=>{var o;const s=Xp(e,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const h=a.node(-1);if(h.type!==s)return!1;const d=r.extensionManager.attributes;if(0===a.parent.content.size&&a.node(-1).childCount===a.indexAfter(-1)){if(2===a.depth||a.node(-3).type!==s||a.index(-2)!==a.node(-2).childCount-1)return!1;if(i){let e=ja.empty;const n=a.index(-1)?1:a.index(-2)?2:3;for(let t=a.depth-n;t>=a.depth-3;t-=1)e=ja.from(a.node(t).copy(e));const i=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,r=Bm(d,a.node().type.name,a.node().attrs),l=(null===(o=s.contentMatch.defaultType)||void 0===o?void 0:o.createAndFill(r))||void 0;e=e.append(ja.from(s.createAndFill(null,l)||void 0));const c=a.before(a.depth-(n-1));t.replace(c,a.after(-i),new Ja(e,4-n,0));let h=-1;t.doc.nodesBetween(c,t.doc.content.size,((e,t)=>{if(h>-1)return!1;e.isTextblock&&0===e.content.size&&(h=t+1)})),h>-1&&t.setSelection(Lc.near(t.doc.resolve(h))),t.scrollIntoView()}return!0}const u=l.pos===a.end()?h.contentMatchAt(0).defaultType:null,p=Bm(d,h.type.name,h.attrs),m=Bm(d,a.node().type.name,a.node().attrs);t.delete(a.pos,l.pos);const f=u?[{type:s,attrs:p},{type:u,attrs:m}]:[{type:s,attrs:p}];if(!uc(t.doc,a.pos,2))return!1;if(i){const{selection:e,storedMarks:o}=n,{splittableMarks:s}=r.extensionManager,l=o||e.$to.parentOffset&&e.$from.marks();if(t.split(a.pos,2,f).scrollIntoView(),!l||!i)return!0;const c=l.filter((e=>s.includes(e.type.name)));t.ensureMarks(c)}return!0},toggleList:(e,t,n,i={})=>({editor:r,tr:o,state:s,dispatch:a,chain:l,commands:c,can:h})=>{const{extensions:d,splittableMarks:u}=r.extensionManager,p=Xp(e,s.schema),m=Xp(t,s.schema),{selection:f,storedMarks:g}=s,{$from:y,$to:v}=f,b=y.blockRange(v),w=g||f.$to.parentOffset&&f.$from.marks();if(!b)return!1;const _=Pm((e=>zm(e.type.name,d)))(f);if(b.depth>=1&&_&&b.depth-_.depth<=1){if(_.node.type===p)return c.liftListItem(m);if(zm(_.node.type.name,d)&&p.validContent(_.node.content)&&a)return l().command((()=>(o.setNodeMarkup(_.pos,p),!0))).command((()=>Vm(o,p))).command((()=>Gm(o,p))).run()}return n&&w&&a?l().command((()=>{const e=h().wrapInList(p,i),t=w.filter((e=>u.includes(e.type.name)));return o.ensureMarks(t),!!e||c.clearNodes()})).wrapInList(p,i).command((()=>Vm(o,p))).command((()=>Gm(o,p))).run():l().command((()=>!!h().wrapInList(p,i)||c.clearNodes())).wrapInList(p,i).command((()=>Vm(o,p))).command((()=>Gm(o,p))).run()},toggleMark:(e,t={},n={})=>({state:i,commands:r})=>{const{extendEmptyMarkRange:o=!1}=n,s=xm(e,i.schema);return Zm(i,s,t)?r.unsetMark(s,{extendEmptyMarkRange:o}):r.setMark(s,t)},toggleNode:(e,t,n={})=>({state:i,commands:r})=>{const o=Xp(e,i.schema),s=Xp(t,i.schema);return Nm(i,o,n)?r.setNode(s):r.setNode(o,n)},toggleWrap:(e,t={})=>({state:n,commands:i})=>{const r=Xp(e,n.schema);return Nm(n,r,t)?i.lift(r):i.wrapIn(r,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let i=0;i<n.length;i+=1){const r=n[i];let o;if(r.spec.isInputRules&&(o=r.getState(e))){if(t){const t=e.tr,n=o.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(o.text){const n=t.doc.resolve(o.from).marks();t.replaceWith(o.from,o.to,e.schema.text(o.text,n))}else t.delete(o.from,o.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:i,ranges:r}=n;return i||t&&r.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{var o;const{extendEmptyMarkRange:s=!1}=t,{selection:a}=n,l=xm(e,i.schema),{$from:c,empty:h,ranges:d}=a;if(!r)return!0;if(h&&s){let{from:e,to:t}=a;const i=null===(o=c.marks().find((e=>e.type===l)))||void 0===o?void 0:o.attrs,r=_m(c,l,i);r&&(e=r.from,t=r.to),n.removeMark(e,t,l)}else d.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,l)}));return n.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:n,state:i,dispatch:r})=>{let o=null,s=null;const a=Rm("string"==typeof e?e:e.name,i.schema);return!!a&&("node"===a&&(o=Xp(e,i.schema)),"mark"===a&&(s=xm(e,i.schema)),r&&n.selection.ranges.forEach((e=>{const r=e.$from.pos,a=e.$to.pos;i.doc.nodesBetween(r,a,((e,i)=>{o&&o===e.type&&n.setNodeMarkup(i,void 0,{...e.attrs,...t}),s&&e.marks.length&&e.marks.forEach((o=>{if(s===o.type){const l=Math.max(i,r),c=Math.min(i+e.nodeSize,a);n.addMark(l,c,s.create({...o.attrs,...t}))}}))}))})),!0)},wrapIn:(e,t={})=>({state:n,dispatch:i})=>function(e,t=null){return function(n,i){let{$from:r,$to:o}=n.selection,s=r.blockRange(o),a=s&&hc(s,e,t);return!!a&&(i&&i(n.tr.wrap(s,a).scrollIntoView()),!0)}}(Xp(e,n.schema),t)(n,i),wrapInList:(e,t={})=>({state:n,dispatch:i})=>function(e,t=null){return function(n,i){let{$from:r,$to:o}=n.selection,s=r.blockRange(o),a=!1,l=s;if(!s)return!1;if(s.depth>=2&&r.node(s.depth-1).type.compatibleContent(e)&&0==s.startIndex){if(0==r.index(s.depth-1))return!1;let e=n.doc.resolve(s.start-2);l=new dl(e,e,s.depth),s.endIndex<s.parent.childCount&&(s=new dl(r,n.doc.resolve(o.end(s.depth)),s.depth)),a=!0}let c=hc(l,e,t,s);return!!c&&(i&&i(function(e,t,n,i,r){let o=ja.empty;for(let e=n.length-1;e>=0;e--)o=ja.from(n[e].type.create(n[e].attrs,o));e.step(new sc(t.start-(i?2:0),t.end,t.start,t.end,new Ja(o,0,0),n.length,!0));let s=0;for(let e=0;e<n.length;e++)n[e].type==r&&(s=e+1);let a=n.length-s,l=t.start+n.length-(i?2:0),c=t.parent;for(let n=t.startIndex,i=t.endIndex,r=!0;n<i;n++,r=!1)!r&&uc(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(n).nodeSize;return e}(n.tr,s,c,a,e).scrollIntoView()),!0)}}(Xp(e,n.schema),t)(n,i)});const Wm=mm.create({name:"commands",addCommands:()=>({...jm})}),Hm=mm.create({name:"editable",addProseMirrorPlugins(){return[new $c({key:new eh("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Um=mm.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new $c({key:new eh("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const i=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,n)=>{e.isFocused=!1;const i=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),Ym=mm.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:i}=t,{empty:r,$anchor:o}=n,{pos:s,parent:a}=o,l=Ac.atStart(i).from===s;return!(!(r&&l&&a.type.isTextblock)||a.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},r={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Mm()||Tm()?r:i},addProseMirrorPlugins(){return[new $c({key:new eh("clearDocument"),appendTransaction:(e,t,n)=>{if(!e.some((e=>e.docChanged))||t.doc.eq(n.doc))return;const{empty:i,from:r,to:o}=t.selection,s=Ac.atStart(t.doc).from,a=Ac.atEnd(t.doc).to;if(i||r!==s||o!==a)return;if(0!==n.doc.textBetween(0,n.doc.content.size," "," ").length)return;const l=n.tr,c=Gp({state:n,transaction:l}),{commands:h}=new jp({editor:this.editor,state:c});return h.clearNodes(),l.steps.length?l:void 0}})]}}),Xm=mm.create({name:"tabindex",addProseMirrorPlugins(){return[new $c({key:new eh("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Jm=Object.freeze({__proto__:null,ClipboardTextSerializer:ym,Commands:Wm,Editable:Hm,FocusEvents:Um,Keymap:Ym,Tabindex:Xm});class Km extends Wp{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t,n){const i=document.querySelector("style[data-tiptap-style]");if(null!==i)return i;const r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute("data-tiptap-style",""),r.innerHTML='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',document.getElementsByTagName("head")[0].appendChild(r),r}(0,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=$p(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:n});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"==typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(n)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(Jm):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new dm(e,this)}createCommandManager(){this.commandManager=new jp({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Om(this.options.content,this.schema,this.options.parseOptions),t=Sm(e,this.options.autofocus);this.view=new tp(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:Jc.create({doc:e,selection:t||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.view.dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),r=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),r&&this.emit("blur",{editor:this,event:r.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return function(e,t){const n=Rm("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=Xp(t,e.schema),{from:i,to:r}=e.selection,o=[];e.doc.nodesBetween(i,r,(e=>{o.push(e)}));const s=o.reverse().find((e=>e.type.name===n.name));return s?{...s.attrs}:{}}(e,t):"mark"===n?Dm(e,t):{}}(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,i="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return Nm(e,null,n)||Zm(e,null,n);const i=Rm(t,e.schema);return"node"===i?Nm(e,t,n):"mark"===i&&Zm(e,t,n)}(this.state,n,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return function(e,t){const n=jl.fromSchema(t).serializeFragment(e),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){return fm(e,{from:0,to:e.content.size},t)}(this.state.doc,{blockSeparator:t,textSerializers:{...gm(this.schema),...n}})}get isEmpty(){return function(e){var t;const n=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),i=e.toJSON();return JSON.stringify(n)===JSON.stringify(i)}(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}}function $m(e){return new om({find:e.find,handler:({state:t,range:n,match:i})=>{const r=qp(e.getAttributes,void 0,i);if(!1===r||null===r)return null;const{tr:o}=t,s=i[i.length-1],a=i[0];let l=n.to;if(s){const i=a.search(/\S/),c=n.from+a.indexOf(s),h=c+s.length;if(Lm(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>c)).length)return null;h<n.to&&o.delete(h,n.to),c>n.from&&o.delete(n.from+i,c),l=n.from+i+s.length,o.addMark(n.from+i,l,e.type.create(r||{})),o.removeStoredMark(e.type)}}})}function qm(e){return new om({find:e.find,handler:({state:t,range:n,match:i})=>{const r=t.doc.resolve(n.from),o=qp(e.getAttributes,void 0,i)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,o)}})}function Qm(e){return new om({find:e.find,handler:({state:t,range:n,match:i,chain:r})=>{const o=qp(e.getAttributes,void 0,i)||{},s=t.tr.delete(n.from,n.to),a=s.doc.resolve(n.from).blockRange(),l=a&&hc(a,e.type,o);if(!l)return null;if(s.wrap(a,l),e.keepMarks&&e.editor){const{selection:n,storedMarks:i}=t,{splittableMarks:r}=e.editor.extensionManager,o=i||n.$to.parentOffset&&n.$from.marks();if(o){const e=o.filter((e=>r.includes(e.type.name)));s.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";r().updateAttributes(t,o).run()}const c=s.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&pc(s.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(i,c))&&s.join(n.from-1)}})}class ef{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=qp(Hp(this,"addOptions",{name:this.name}))),this.storage=qp(Hp(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ef(e)}configure(e={}){const t=this.extend();return t.options=pm(this.options,e),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new ef(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=qp(Hp(t,"addOptions",{name:t.name})),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const r=i.marks();if(!r.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const o=r.find((e=>(null==e?void 0:e.type.name)===t.name));return o&&n.removeStoredMark(o),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}}class tf{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=qp(Hp(this,"addOptions",{name:this.name}))),this.storage=qp(Hp(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new tf(e)}configure(e={}){const t=this.extend();return t.options=pm(this.options,e),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new tf(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=qp(Hp(t,"addOptions",{name:t.name})),t.storage=qp(Hp(t,"addStorage",{name:t.name,options:t.options})),t}}function nf(e){return new cm({find:e.find,handler:({state:t,range:n,match:i})=>{const r=qp(e.getAttributes,void 0,i);if(!1===r||null===r)return null;const{tr:o}=t,s=i[i.length-1],a=i[0];let l=n.to;if(s){const i=a.search(/\S/),c=n.from+a.indexOf(s),h=c+s.length;if(Lm(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>c)).length)return null;h<n.to&&o.delete(h,n.to),c>n.from&&o.delete(n.from+i,c),l=n.from+i+s.length,o.addMark(n.from+i,l,e.type.create(r||{})),o.removeStoredMark(e.type)}}})}const rf=window.ReactDOM;class of extends Km{constructor(){super(...arguments),this.contentComponent=null}}const sf=({renderers:e})=>S.createElement(S.Fragment,null,Object.entries(e).map((([e,t])=>rf.createPortal(t.reactElement,t.element,e))));class af extends S.Component{constructor(e){super(e),this.editorContentRef=S.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?(0,rf.flushSync)(e):e()}setRenderer(e,t){this.maybeFlushSync((()=>{this.setState((({renderers:n})=>({renderers:{...n,[e]:t}})))}))}removeRenderer(e){this.maybeFlushSync((()=>{this.setState((({renderers:t})=>{const n={...t};return delete n[e],{renderers:n}}))}))}componentWillUnmount(){const{editor:e}=this.props;if(!e)return;if(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild)return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,...t}=this.props;return S.createElement(S.Fragment,null,S.createElement("div",{ref:this.editorContentRef,...t}),S.createElement(sf,{renderers:this.state.renderers}))}}const lf=S.memo(af),cf=(0,S.createContext)({onDragStart:void 0});S.forwardRef(((e,t)=>{const{onDragStart:n}=(0,S.useContext)(cf),i=e.as||"div";return S.createElement(i,{...e,ref:t,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...e.style}})}));const hf=/^\s*>\s$/,df=tf.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Qm({find:hf,type:this.type})]}}),uf=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,pf=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,mf=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,ff=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,gf=ef.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],renderHTML({HTMLAttributes:e}){return["strong",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[$m({find:uf,type:this.type}),$m({find:mf,type:this.type})]},addPasteRules(){return[nf({find:pf,type:this.type}),nf({find:ff,type:this.type})]}}),yf=tf.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Jp(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),vf=ef.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs:e=>!!e.hasAttribute("style")&&{}}],renderHTML({HTMLAttributes:e}){return["span",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=Dm(e,this.type);return!!Object.entries(n).some((([,e])=>!!e))||t.unsetMark(this.name)}}}}),bf=/^\s*([-+*])\s$/,wf=tf.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(yf.name,this.editor.getAttributes(vf.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=Qm({find:bf,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Qm({find:bf,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(vf.name),editor:this.editor})),[e]}}),_f=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,xf=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Cf=ef.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[$m({find:_f,type:this.type})]},addPasteRules(){return[nf({find:xf,type:this.type})]}}),Ef=/^```([a-z]+)?[\s\n]$/,Sf=/^~~~([a-z]+)?[\s\n]$/,Mf=tf.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options;return[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]].filter((e=>e.startsWith(n))).map((e=>e.replace(n,"")))[0]||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",Jp(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes()},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:i,empty:r}=n;if(!r||i.parent.type!==this.type)return!1;const o=i.parentOffset===i.parent.nodeSize-2,s=i.parent.textContent.endsWith("\n\n");return!(!o||!s)&&e.chain().command((({tr:e})=>(e.delete(i.pos-2,i.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:i}=t,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type)return!1;if(r.parentOffset!==r.parent.nodeSize-2)return!1;const s=r.after();return void 0!==s&&(!i.nodeAt(s)&&e.commands.exitCode())}}},addInputRules(){return[qm({find:Ef,type:this.type,getAttributes:e=>({language:e[1]})}),qm({find:Sf,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new $c({key:new eh("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),i=t.clipboardData.getData("vscode-editor-data"),r=i?JSON.parse(i):void 0,o=null==r?void 0:r.mode;if(!n||!o)return!1;const{tr:s}=e.state;return s.replaceSelectionWith(this.type.create({language:o})),s.setSelection(Lc.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.insertText(n.replace(/\r\n?/g,"\n")),s.setMeta("paste",!0),e.dispatch(s),!0}}})]}}),If=tf.create({name:"doc",topNode:!0,content:"block+"});function kf(e={}){return new $c({view:t=>new Tf(t,e)})}class Tf{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent;if(n){let n=t.nodeBefore,i=t.nodeAfter;if(n||i){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let r=t.getBoundingClientRect(),o=n?r.bottom:r.top;n&&i&&(o=(o+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:r.left,right:r.right,top:o-this.width/2,bottom:o+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let i,r,o=this.editorView.dom.offsetParent;if(this.element||(this.element=o.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!o||o==document.body&&"static"==getComputedStyle(o).position)i=-pageXOffset,r=-pageYOffset;else{let e=o.getBoundingClientRect();i=e.left-o.scrollLeft,r=e.top-o.scrollTop}this.element.style.left=e.left-i+"px",this.element.style.top=e.top-r+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=n&&n.type.spec.disableDropCursor,r="function"==typeof i?i(this.editorView,t,e):i;if(t&&!r){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=gc(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Nf=mm.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[kf(this.options)]}});class Rf extends Ac{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return Rf.valid(n)?new Rf(n):Ac.near(n)}content(){return Ja.empty}eq(e){return e instanceof Rf&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Rf(e.resolve(t.pos))}getBookmark(){return new Af(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),i=e.node(t);if(0!=n)for(let e=i.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(i.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),i=e.node(t);if(n!=i.childCount)for(let e=i.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(i.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&Rf.valid(e))return e;let i=e.pos,r=null;for(let n=e.depth;;n--){let o=e.node(n);if(t>0?e.indexAfter(n)<o.childCount:e.index(n)>0){r=o.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;i+=t;let s=e.doc.resolve(i);if(Rf.valid(s))return s}for(;;){let o=t>0?r.firstChild:r.lastChild;if(!o){if(r.isAtom&&!r.isText&&!Zc.isSelectable(r)){e=e.doc.resolve(i+r.nodeSize*t),n=!1;continue e}break}r=o,i+=t;let s=e.doc.resolve(i);if(Rf.valid(s))return s}return null}}}Rf.prototype.visible=!1,Rf.findFrom=Rf.findGapCursorFrom,Ac.jsonID("gapcursor",Rf);class Af{constructor(e){this.pos=e}map(e){return new Af(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Rf.valid(t)?new Rf(t):Ac.near(t)}}const Of=gp({ArrowLeft:Pf("horiz",-1),ArrowRight:Pf("horiz",1),ArrowUp:Pf("vert",-1),ArrowDown:Pf("vert",1)});function Pf(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,i,r){let o=e.selection,s=t>0?o.$to:o.$from,a=o.empty;if(o instanceof Lc){if(!r.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=e.doc.resolve(t>0?s.after():s.before())}let l=Rf.findGapCursorFrom(s,t,a);return!!l&&(i&&i(e.tr.setSelection(new Rf(l))),!0)}}function Df(e,t,n){if(!e||!e.editable)return!1;let i=e.state.doc.resolve(t);if(!Rf.valid(i))return!1;let r=e.posAtCoords({left:n.clientX,top:n.clientY});return!(r&&r.inside>-1&&Zc.isSelectable(e.state.doc.nodeAt(r.inside))||(e.dispatch(e.state.tr.setSelection(new Rf(i))),0))}function Lf(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof Rf))return!1;let{$from:n}=e.state.selection,i=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!i)return!1;let r=ja.empty;for(let e=i.length-1;e>=0;e--)r=ja.from(i[e].createAndFill(null,r));let o=e.state.tr.replace(n.pos,n.pos,new Ja(r,0,0));return o.setSelection(Lc.near(o.doc.resolve(n.pos+1))),e.dispatch(o),!1}function Bf(e){if(!(e.selection instanceof Rf))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",Pu.create(e.doc,[Ru.widget(e.selection.head,t,{key:"gapcursor"})])}const Zf=mm.create({name:"gapCursor",addProseMirrorPlugins:()=>[new $c({props:{decorations:Bf,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&Rf.valid(n)?new Rf(n):null,handleClick:Df,handleKeyDown:Of,handleDOMEvents:{beforeinput:Lf}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!==(t=qp(Hp(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))&&void 0!==t?t:null}}}),zf=tf.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",Jp(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:i})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:r}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:s}=i.extensionManager,a=r||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&a&&o){const t=a.filter((e=>s.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Ff=tf.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,Jp(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>qm({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var Vf=200,Gf=function(){};Gf.prototype.append=function(e){return e.length?(e=Gf.from(e),!this.length&&e||e.length<Vf&&this.leafAppend(e)||this.length<Vf&&e.leafPrepend(this)||this.appendInner(e)):this},Gf.prototype.prepend=function(e){return e.length?Gf.from(e).append(this):this},Gf.prototype.appendInner=function(e){return new Wf(this,e)},Gf.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?Gf.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},Gf.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},Gf.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},Gf.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var i=[];return this.forEach((function(t,n){return i.push(e(t,n))}),t,n),i},Gf.from=function(e){return e instanceof Gf?e:e&&e.length?new jf(e):Gf.empty};var jf=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,i){for(var r=t;r<n;r++)if(!1===e(this.values[r],i+r))return!1},t.prototype.forEachInvertedInner=function(e,t,n,i){for(var r=t-1;r>=n;r--)if(!1===e(this.values[r],i+r))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=Vf)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=Vf)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(Gf);Gf.empty=new jf([]);var Wf=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,i){var r=this.left.length;return!(t<r&&!1===this.left.forEachInner(e,t,Math.min(n,r),i))&&!(n>r&&!1===this.right.forEachInner(e,Math.max(t-r,0),Math.min(this.length,n)-r,i+r))&&void 0},t.prototype.forEachInvertedInner=function(e,t,n,i){var r=this.left.length;return!(t>r&&!1===this.right.forEachInvertedInner(e,t-r,Math.max(n,r)-r,i+r))&&!(n<r&&!1===this.left.forEachInvertedInner(e,Math.min(t,r),n,i))&&void 0},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(Gf);const Hf=Gf;class Uf{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,i,r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}t&&(n=this.remapping(r,this.items.length),i=n.maps.length);let o,s,a=e.tr,l=[],c=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(r,t+1),i=n.maps.length),i--,void c.push(e);if(n){c.push(new Yf(e.map));let t,r=e.step.map(n.slice(i));r&&a.maybeStep(r).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new Yf(t,void 0,void 0,l.length+c.length))),i--,t&&n.appendMap(t,i)}else a.maybeStep(e.step);return e.selection?(o=n?e.selection.map(n.slice(i)):e.selection,s=new Uf(this.items.slice(0,r).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:s,transform:a,selection:o}}addTransform(e,t,n,i){let r=[],o=this.eventCount,s=this.items,a=!i&&s.length?s.get(s.length-1):null;for(let n=0;n<e.steps.length;n++){let l,c=e.steps[n].invert(e.docs[n]),h=new Yf(e.mapping.maps[n],c,t);(l=a&&a.merge(h))&&(h=l,n?r.pop():s=s.slice(0,s.length-1)),r.push(h),t&&(o++,t=void 0),i||(a=h)}let l=o-n.depth;return l>Jf&&(s=function(e,t){let n;return e.forEach(((e,i)=>{if(e.selection&&0==t--)return n=i,!1})),e.slice(n)}(s,l),o-=l),new Uf(s.append(r),o)}remapping(e,t){let n=new Kl;return this.items.forEach(((t,i)=>{let r=null!=t.mirrorOffset&&i-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,r)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new Uf(this.items.append(e.map((e=>new Yf(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-t),r=e.mapping,o=e.steps.length,s=this.eventCount;this.items.forEach((e=>{e.selection&&s--}),i);let a=t;this.items.forEach((t=>{let i=r.getMirror(--a);if(null==i)return;o=Math.min(o,i);let l=r.maps[i];if(t.step){let o=e.steps[i].invert(e.docs[i]),c=t.selection&&t.selection.map(r.slice(a+1,i));c&&s++,n.push(new Yf(l,o,c))}else n.push(new Yf(l))}),i);let l=[];for(let e=t;e<o;e++)l.push(new Yf(r.maps[e]));let c=this.items.slice(0,i).append(l).append(n),h=new Uf(c,s);return h.emptyItemCount()>500&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,i=[],r=0;return this.items.forEach(((o,s)=>{if(s>=e)i.push(o),o.selection&&r++;else if(o.step){let e=o.step.map(t.slice(n)),s=e&&e.getMap();if(n--,s&&t.appendMap(s,n),e){let a=o.selection&&o.selection.map(t.slice(n));a&&r++;let l,c=new Yf(s.invert(),e,a),h=i.length-1;(l=i.length&&i[h].merge(c))?i[h]=l:i.push(c)}}else o.map&&n--}),this.items.length,0),new Uf(Hf.from(i.reverse()),r)}}Uf.empty=new Uf(Hf.empty,0);class Yf{constructor(e,t,n,i){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Yf(t.getMap().invert(),t,this.selection)}}}class Xf{constructor(e,t,n,i,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=i,this.prevComposition=r}}const Jf=20;function Kf(e){let t=[];return e.forEach(((e,n,i,r)=>t.push(i,r))),t}function $f(e,t){if(!e)return null;let n=[];for(let i=0;i<e.length;i+=2){let r=t.map(e[i],1),o=t.map(e[i+1],-1);r<=o&&n.push(r,o)}return n}function qf(e,t,n,i){let r=tg(t),o=ng.get(t).spec.config,s=(i?e.undone:e.done).popEvent(t,r);if(!s)return;let a=s.selection.resolve(s.transform.doc),l=(i?e.done:e.undone).addTransform(s.transform,t.selection.getBookmark(),o,r),c=new Xf(i?l:s.remaining,i?s.remaining:l,null,0,-1);n(s.transform.setSelection(a).setMeta(ng,{redo:i,historyState:c}).scrollIntoView())}let Qf=!1,eg=null;function tg(e){let t=e.plugins;if(eg!=t){Qf=!1,eg=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Qf=!0;break}}return Qf}const ng=new eh("history"),ig=new eh("closeHistory");function rg(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new $c({key:ng,state:{init:()=>new Xf(Uf.empty,Uf.empty,null,0,-1),apply:(t,n,i)=>function(e,t,n,i){let r,o=n.getMeta(ng);if(o)return o.historyState;n.getMeta(ig)&&(e=new Xf(e.done,e.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(s&&s.getMeta(ng))return s.getMeta(ng).redo?new Xf(e.done.addTransform(n,void 0,i,tg(t)),e.undone,Kf(n.mapping.maps[n.steps.length-1]),e.prevTime,e.prevComposition):new Xf(e.done,e.undone.addTransform(n,void 0,i,tg(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(r=n.getMeta("rebased"))?new Xf(e.done.rebased(n,r),e.undone.rebased(n,r),$f(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new Xf(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),$f(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let r=n.getMeta("composition"),o=0==e.prevTime||!s&&e.prevComposition!=r&&(e.prevTime<(n.time||0)-i.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,i)=>{for(let r=0;r<t.length;r+=2)e<=t[r+1]&&i>=t[r]&&(n=!0)})),n}(n,e.prevRanges)),a=s?$f(e.prevRanges,n.mapping):Kf(n.mapping.maps[n.steps.length-1]);return new Xf(e.done.addTransform(n,o?t.selection.getBookmark():void 0,i,tg(t)),Uf.empty,a,n.time,null==r?e.prevComposition:r)}}(n,i,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,i="historyUndo"==n?og:"historyRedo"==n?sg:null;return!!i&&(t.preventDefault(),i(e.state,e.dispatch))}}}})}const og=(e,t)=>{let n=ng.getState(e);return!(!n||0==n.done.eventCount||(t&&qf(n,e,t,!1),0))},sg=(e,t)=>{let n=ng.getState(e);return!(!n||0==n.undone.eventCount||(t&&qf(n,e,t,!0),0))},ag=mm.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>og(e,t),redo:()=>({state:e,dispatch:t})=>sg(e,t)}),addProseMirrorPlugins(){return[rg(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),lg=tf.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",Jp(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{var n;if(t){const{$to:t}=e.selection,i=t.end();if(t.nodeAfter)e.setSelection(Lc.create(e.doc,t.pos));else{const r=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();r&&(e.insert(i,r),e.setSelection(Lc.create(e.doc,i)))}e.scrollIntoView()}return!0})).run()}},addInputRules(){return[(e={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type},new om({find:e.find,handler:({state:t,range:n,match:i})=>{const r=qp(e.getAttributes,void 0,i)||{},{tr:o}=t,s=n.from;let a=n.to;if(i[1]){let t=s+i[0].lastIndexOf(i[1]);t>a?t=a:a=t+i[1].length;const n=i[0][i[0].length-1];o.insertText(n,s+i[0].length-1),o.replaceWith(t,a,e.type.create(r))}else i[0]&&o.replaceWith(s,a,e.type.create(r))}}))];var e}}),cg=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,hg=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,dg=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,ug=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,pg=ef.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes:e}){return["em",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[$m({find:cg,type:this.type}),$m({find:dg,type:this.type})]},addPasteRules(){return[nf({find:hg,type:this.type}),nf({find:ug,type:this.type})]}}),mg=tf.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Jp(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),fg=tf.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Jp(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),gg=ef.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs:e=>!!e.hasAttribute("style")&&{}}],renderHTML({HTMLAttributes:e}){return["span",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=Dm(e,this.type);return!!Object.entries(n).some((([,e])=>!!e))||t.unsetMark(this.name)}}}}),yg=/^(\d+)\.\s$/,vg=tf.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",Jp(this.options.HTMLAttributes,n),0]:["ol",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(fg.name,this.editor.getAttributes(gg.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=Qm({find:yg,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Qm({find:yg,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(gg.name)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),bg=tf.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),wg=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,_g=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,xg=ef.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[$m({find:wg,type:this.type})]},addPasteRules(){return[nf({find:_g,type:this.type})]}}),Cg=tf.create({name:"text",group:"inline"}),Eg=mm.create({name:"starterKit",addExtensions(){var e,t,n,i,r,o,s,a,l,c,h,d,u,p,m,f,g,y;const v=[];return!1!==this.options.blockquote&&v.push(df.configure(null===(e=this.options)||void 0===e?void 0:e.blockquote)),!1!==this.options.bold&&v.push(gf.configure(null===(t=this.options)||void 0===t?void 0:t.bold)),!1!==this.options.bulletList&&v.push(wf.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&v.push(Cf.configure(null===(i=this.options)||void 0===i?void 0:i.code)),!1!==this.options.codeBlock&&v.push(Mf.configure(null===(r=this.options)||void 0===r?void 0:r.codeBlock)),!1!==this.options.document&&v.push(If.configure(null===(o=this.options)||void 0===o?void 0:o.document)),!1!==this.options.dropcursor&&v.push(Nf.configure(null===(s=this.options)||void 0===s?void 0:s.dropcursor)),!1!==this.options.gapcursor&&v.push(Zf.configure(null===(a=this.options)||void 0===a?void 0:a.gapcursor)),!1!==this.options.hardBreak&&v.push(zf.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&v.push(Ff.configure(null===(c=this.options)||void 0===c?void 0:c.heading)),!1!==this.options.history&&v.push(ag.configure(null===(h=this.options)||void 0===h?void 0:h.history)),!1!==this.options.horizontalRule&&v.push(lg.configure(null===(d=this.options)||void 0===d?void 0:d.horizontalRule)),!1!==this.options.italic&&v.push(pg.configure(null===(u=this.options)||void 0===u?void 0:u.italic)),!1!==this.options.listItem&&v.push(mg.configure(null===(p=this.options)||void 0===p?void 0:p.listItem)),!1!==this.options.orderedList&&v.push(vg.configure(null===(m=this.options)||void 0===m?void 0:m.orderedList)),!1!==this.options.paragraph&&v.push(bg.configure(null===(f=this.options)||void 0===f?void 0:f.paragraph)),!1!==this.options.strike&&v.push(xg.configure(null===(g=this.options)||void 0===g?void 0:g.strike)),!1!==this.options.text&&v.push(Cg.configure(null===(y=this.options)||void 0===y?void 0:y.text)),v}}),Sg=ef.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("underline")&&{}}],renderHTML({HTMLAttributes:e}){return["u",Jp(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Mg=(0,e.createContext)();function Ig({icon:t,style:n,config:i,toggler:r}){const o=(0,e.useContext)(Mg);return(0,e.createElement)(m.ToolbarButton,{icon:t,isActive:o&&o.isActive(n,i),onClick:()=>o.chain().focus()[r](i).run(),disabled:o&&!o.can().chain().focus()[r](i).run()})}const kg=(0,e.forwardRef)((function({label:t,value:n,onChange:i,dependencies:r=[],className:o},s){const a=((e={},t=[])=>{const[n,i]=(0,S.useState)(null),r=function(){const[,e]=(0,S.useState)(0);return()=>e((e=>e+1))}(),{onBeforeCreate:o,onBlur:s,onCreate:a,onDestroy:l,onFocus:c,onSelectionUpdate:h,onTransaction:d,onUpdate:u}=e,p=(0,S.useRef)(o),m=(0,S.useRef)(s),f=(0,S.useRef)(a),g=(0,S.useRef)(l),y=(0,S.useRef)(c),v=(0,S.useRef)(h),b=(0,S.useRef)(d),w=(0,S.useRef)(u);return(0,S.useEffect)((()=>{n&&(o&&(n.off("beforeCreate",p.current),n.on("beforeCreate",o),p.current=o),s&&(n.off("blur",m.current),n.on("blur",s),m.current=s),a&&(n.off("create",f.current),n.on("create",a),f.current=a),l&&(n.off("destroy",g.current),n.on("destroy",l),g.current=l),c&&(n.off("focus",y.current),n.on("focus",c),y.current=c),h&&(n.off("selectionUpdate",v.current),n.on("selectionUpdate",h),v.current=h),d&&(n.off("transaction",b.current),n.on("transaction",d),b.current=d),u&&(n.off("update",w.current),n.on("update",u),w.current=u))}),[o,s,a,l,c,h,d,u,n]),(0,S.useEffect)((()=>{let t=!0;const n=new of(e);return i(n),n.on("transaction",(()=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{t&&r()}))}))})),()=>{n.destroy(),t=!1}}),t),n})({extensions:[Eg,Sg],content:n,onBlur:({editor:e})=>i&&i(e.getHTML())},r),l=(0,e.useRef)("toolbar-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(Mg.Provider,{value:a},(0,e.createElement)(m.BaseControl,{id:l.current,label:t,className:o},(0,e.createElement)("div",{className:`${rt.input} ${rt.border} ${a&&a.isFocused&&"q6avstvLjymODCrFgQeP"}`},(0,e.createElement)(m.Toolbar,{label:t,className:"sCcLhDt2ExUXfw0XnhFQ",id:l.current},(0,e.createElement)(m.ToolbarGroup,null,(0,e.createElement)(Ig,{icon:"heading",style:"heading",config:{level:3},toggler:"toggleHeading"}),(0,e.createElement)(Ig,{icon:"format-quote",style:"blockquote",toggler:"toggleBlockquote"})),(0,e.createElement)(m.ToolbarGroup,null,(0,e.createElement)(Ig,{icon:"editor-bold",style:"bold",toggler:"toggleBold"}),(0,e.createElement)(Ig,{icon:"editor-italic",style:"italic",toggler:"toggleItalic"}),(0,e.createElement)(Ig,{icon:"editor-underline",style:"underline",toggler:"toggleUnderline"})),(0,e.createElement)(m.ToolbarGroup,null,(0,e.createElement)(Ig,{icon:"editor-ul",style:"bulletList",toggler:"toggleBulletList"}),(0,e.createElement)(Ig,{icon:"editor-ol",style:"orderedList",toggler:"toggleOrderedList"})),(0,e.createElement)(m.ToolbarGroup,null,(0,e.createElement)(m.ToolbarButton,{icon:"editor-removeformatting",onClick:()=>a.chain().focus().unsetAllMarks().clearNodes().run()})),(0,e.createElement)(m.ToolbarGroup,null,(0,e.createElement)("div",{className:"oVoaCE4P2mKUVAMTTKiQ"}))),(0,e.createElement)(lf,{editor:a,className:"Ik2rBzGcBHXrGXSTFCoV",ref:s}))))})),Tg=(0,e.forwardRef)((function({label:t,value:n,onChange:i,className:r},o){const[s,a]=(0,e.useState)();async function l(e){if(e){const t=await e.first().fetch();a(t),i&&i(t?t.id:null)}else a(null),i(null)}const c=Fs(!1,l),h=st();(0,e.useEffect)((()=>{(n?wp.media.attachment(n).fetch():Promise.resolve(null)).then((e=>{a(e)})).catch((()=>h({message:(0,f.__)("Unable to load featured image.","image-map-connect"),style:"error"})))}),[h,n]),(0,e.useEffect)((()=>()=>i(null)),[i]);const d=(0,e.useRef)("img-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(m.BaseControl,{label:t,className:r,id:d.current},s&&(0,e.createElement)("img",{src:s.sizes.thumbnail.url,alt:s.alt,width:s.sizes.thumbnail.width,height:s.sizes.thumbnail.height,className:`${rt.featured} ${rt.border}`}),(0,e.createElement)("div",{className:s?rt.featuredButtons:""},(0,e.createElement)(m.Button,{id:d.current,variant:"secondary",onClick:()=>c.open(),ref:o},s?"Update":"Select image"),s&&(0,e.createElement)(m.Button,{variant:"secondary",isDestructive:!0,onClick:()=>l(null)},"Delete")))}));function Ng({markerType:t,title:n,icons:i}){const r=(0,g.useSelect)((e=>e("core").getPostTypes())),{watch:o}=W(),{query:s}=d(),a=(0,e.useRef)("place-marker-"+Math.floor(1e8*Math.random()));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h2",null,"new"===s.marker?(0,f.__)("Add Marker","image-map-connect"):(0,f.__)("Edit Marker","image-map-connect")),(0,e.createElement)("div",{className:"col-xs-9"},r&&t&&(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Type","image-map-connect"),tooltip:(0,f.__)("Post type linked to the marker, or standalone marker if not linked.","image-map-connect")}),className:rt.field,id:"no-input-to-focus-on"},"imc-marker"===t?(0,f.__)("Standalone marker","image-map-connect"):r.find((e=>e.slug===t))?.name),(0,e.createElement)(m.BaseControl,{className:rt.field,label:(0,e.createElement)(dt,{name:(0,f.__)("Marker placement","image-map-connect"),tooltip:(0,f.__)("Marker position can be updated at any time.","image-map-connect")}),id:a},(0,e.createElement)("div",{id:a},o("imc_loc.lat")?(0,f.__)("Drag the marker to change it's position.","image-map-connect"):(0,f.__)("Click on the image to set the location of the marker","image-map-connect"))),"imc-marker"!==t&&(0,e.createElement)(m.BaseControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Title","image-map-connect"),tooltip:(0,f.__)("Post title, can be shown in the popup when selecting a marker on the public user interface.","image-map-connect")}),className:rt.field,id:"no-input-to-focus-on"},n),(0,e.createElement)(re,{name:"imc_icons.0",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(Za,{label:(0,e.createElement)(dt,{name:(0,f.__)("Icon","image-map-connect"),tooltip:(0,f.__)("Select from the icon types defined on the map.","image-map-connect")}),value:t.value,onSelect:t.onChange,onBlur:t.onBlur,icons:i,className:ot(n)})}),"imc-marker"===t&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(re,{name:"title.raw",rules:{required:!0},render:({field:t,fieldState:n})=>(0,e.createElement)(m.TextControl,{label:(0,e.createElement)(dt,{name:(0,f.__)("Title"),tooltip:(0,f.__)("Can be shown in the popup when selecting a marker on the public user interface.","image-map-connect")}),...t,className:ot(n)})}),(0,e.createElement)(re,{name:"excerpt.raw",render:({field:t,fieldState:n})=>(0,e.createElement)(kg,{label:(0,e.createElement)(dt,{name:(0,f.__)("Content","image-map-connect"),tooltip:(0,f.__)("Can be shown in the popup when selecting the marker on the public user interface.","image-map-connect")}),...t,className:ot(n),dependencies:[o("id"),t.onChange]})}),(0,e.createElement)(re,{name:"featured_media",render:({field:t,fieldState:n})=>(0,e.createElement)(Tg,{label:(0,e.createElement)(dt,{name:(0,f.__)("Featured Image","image-map-connect"),tooltip:(0,f.__)("Can be shown in the popup when selecting a marker on the public user interface.","image-map-connect")}),...t,className:ot(n)})}))))}const Rg="element",Ag="map",Og="offset",Pg="position",Dg="positioning",Lg=class extends qt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container ol-selectable",this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===e.autoPan?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Rg,this.handleElementChanged),this.addChangeListener(Ag,this.handleMapChanged),this.addChangeListener(Og,this.handleOffsetChanged),this.addChangeListener(Pg,this.handlePositionChanged),this.addChangeListener(Dg,this.handlePositioningChanged),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),void 0!==e.position&&this.setPosition(e.position)}getElement(){return this.get(Rg)}getId(){return this.id}getMap(){return this.get(Ag)||null}getOffset(){return this.get(Og)}getPosition(){return this.get(Pg)}getPositioning(){return this.get(Dg)}handleElementChanged(){lo(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(ao(this.element),Ht(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=jt(e,_o,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Rg,e)}setMap(e){this.set(Ag,e)}setOffset(e){this.set(Og,e)}setPosition(e){this.set(Pg,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Pg))return;const n=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[ro(i),oo(i)]),o=void 0===(e=e||{}).margin?20:e.margin;if(!Mn(n,r)){const i=r[0]-n[0],s=n[2]-r[2],a=r[1]-n[1],l=n[3]-r[3],c=[0,0];if(i<0?c[0]=i-o:s<0&&(c[0]=Math.abs(s)+o),a<0?c[1]=a-o:l<0&&(c[1]=Math.abs(l)+o),0!==c[0]||0!==c[1]){const n=t.getView().getCenterInternal(),i=t.getPixelFromCoordinateInternal(n);if(!i)return;const r=[i[0]+c[0],i[1]+c[1]],o=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(r),duration:o.duration,easing:o.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),i=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[i,r,i+t[0],r+t[1]]}setPositioning(e){this.set(Dg,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const n=e.getPixelFromCoordinate(t),i=e.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(e,t){const n=this.element.style,i=this.getOffset(),r=this.getPositioning();this.setVisible(!0);let o="0%",s="0%";"bottom-right"==r||"center-right"==r||"top-right"==r?o="-100%":"bottom-center"!=r&&"center-center"!=r&&"top-center"!=r||(o="-50%"),"bottom-left"==r||"bottom-center"==r||"bottom-right"==r?s="-100%":"center-left"!=r&&"center-center"!=r&&"center-right"!=r||(s="-50%");const a=`translate(${o}, ${s}) translate(${Math.round(e[0]+i[0])+"px"}, ${Math.round(e[1]+i[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,n.transform=a)}getOptions(){return this.options}};function Bg({position:t,anchor:n,events:i,className:r,children:o}){const{map:s}=vs(),a=(0,e.useRef)(),l=(0,e.useMemo)((()=>new Lg({position:[t.lng,t.lat],stopEvent:!1,offset:n})),[]);return(0,e.useEffect)((()=>(l.setElement(a.current),s?.addOverlay(l),()=>{s.removeOverlay(l)})),[l,s]),(0,e.useEffect)((()=>{for(const e in i)l.on(e,i[e]);return()=>{for(const e in i)l.un(e,i[e])}}),[i,l]),(0,e.useEffect)((()=>{l.setPosition([t.lng,t.lat])}),[l,t.lng,t.lat]),(0,e.createElement)("div",null,(0,e.createElement)("div",{ref:a,className:r},o))}function Zg({query:t,state:n,children:i,...r}){const{createUrl:o,history:s}=d(),a=o(t);return(0,e.createElement)("a",{href:a,onClick:function(e){e.preventDefault(),s.push(a,n)},...r},i)}const zg={link:"zfMzjzprR6R6p7xcXVfv"};function Fg({marker:t,icons:n}){const i=(0,e.useMemo)((()=>{const e=t.imc_icons[0];return n.find((t=>t.id===e))}),[n,t.imc_icons]);return i?(0,e.createElement)(Bg,{position:t.imc_loc,anchor:[-i.img.iconAnchor.x*i.size,-i.img.iconAnchor.y*i.size]},(0,e.createElement)(Zg,{query:{marker:t.id},className:zg.link,style:{height:i.size}},(0,e.createElement)("i",{className:i.img.ref,style:mt(i)}))):null}const Vg={pin:"tVz0dvwwIHBkeO72E9Bb","pulse-black":"ivu5Zh_1JAPaKAThbH9j"};function Gg({icons:t,newPosition:n,onMove:i}){const{map:r}=vs(),o=ee({name:"imc_icons.0"}),s=(0,e.useMemo)((()=>{var e;return t?null!==(e=t?.find((e=>e.id===o)))&&void 0!==e?e:t[0]:null}),[t,o]),[a,l]=(0,e.useState)({});(0,e.useEffect)((()=>{n&&l(n)}),[n]);const[c,h]=(0,e.useState)(!1),d=(0,e.useCallback)((e=>l({lng:e.coordinate[0],lat:e.coordinate[1]})),[]),u=(0,e.useCallback)((()=>{r?.un("pointermove",d),window.removeEventListener("mouseup",u),r?.getInteractions().forEach((e=>{e instanceof $o&&e.setActive(!0)})),h(!0)}),[d,r]);return(0,e.useEffect)((()=>{c&&i(a)}),[c]),s&&a.lat&&a.lng?(0,e.createElement)(Bg,{position:a,anchor:[-s.img.iconAnchor.x*s.size,-s.img.iconAnchor.y*s.size]},(0,e.createElement)("div",{className:Vg.pin,style:{height:s.size},onMouseDown:function(e){e.stopPropagation(),r?.getInteractions().forEach((e=>{e instanceof $o&&e.setActive(!1)})),h(!1),r?.on("pointermove",d),window.addEventListener("mouseup",u)}},(0,e.createElement)("i",{className:s.img.ref,style:mt(s)}))):null}function jg({onSet:t}){const{query:n}=d(),{map:i}=vs();return(0,e.useEffect)((()=>{const e=e=>t({lng:e.coordinate[0],lat:e.coordinate[1]});return i?.on("click",e),()=>i?.un("click",e)}),[i,t,n.marker]),null}const Wg={invalid:"E5xpX0V23UXBAJYWvkrR"};function Hg({onMapLoaded:t,markers:n,selected:i,icons:r}){const{query:o}=d(),{record:s,status:a}=at([o.layer],"taxonomy","imc-layer",{_fields:"id,name,meta,image_source"},{meta:{}});return(0,e.createElement)(re,{name:"imc_loc",rules:{validate:e=>e&&0!==e.lat&&0!==e.lng},render:({field:l,fieldState:c})=>(0,e.createElement)(m.Card,{className:c.invalid&&Wg.invalid},(0,e.createElement)(bs,{eventHandlers:[{event:"postrender",handler:e=>t(e.map),once:!0}],className:Oa.canvas},"loaded"===a&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(zs,{layer:s}),r&&n.list.length&&n.list.map((t=>t.id!==+i.id?(0,e.createElement)(Fg,{key:t.id,marker:t,icons:r}):(0,e.createElement)(Gg,{key:t.id,icons:r,newPosition:t.imc_loc,onMove:l.onChange}))),r&&"new"===o.marker&&(l.value&&l.value.lat&&l.value.lng?(0,e.createElement)(Gg,{icons:r,newPosition:l.value,onMove:l.onChange}):(0,e.createElement)(jg,{onSet:l.onChange})))))})}const Ug={};function Yg({selected:t=Ug,markers:n,onMapLoaded:i,listQuery:r}){const{query:o}=d(),{record:{icon_details:s}}=at(o.map,"postType","imc-map",{_fields:"icon_details"}),a=(0,e.useMemo)((()=>{var e,n;const i=t.imc_icons?.length&&t.imc_icons||(s?[s[0]?.id]:[]);return{status:"publish",title:{raw:""},excerpt:{raw:""},imc_layers:[+o.layer],imc_icons:i,imc_loc:null!==(e=t.imc_loc)&&void 0!==e?e:{lng:0,lat:0},type:null!==(n=t.type)&&void 0!==n?n:"imc-marker"}}),[t,o.layer,s]),{record:l,status:c,delRecord:h,saveRecord:u}=at(t.id,"postType",a.type,{},a),p=it({mode:"onTouched",defaultValues:l});return(0,e.useEffect)((()=>{const e=p.watch(((e,{type:t})=>{t||!Array.isArray(e.imc_layers)||e.imc_layers.includes(+o.layer)||p.setValue("imc_layers",[...e.imc_layers,+o.layer])}));return()=>e.unsubscribe()}),[p,p.watch,o.layer]),(0,e.useEffect)((()=>{const e={...l};s?.length&&!l.imc_icons?.length&&(e.imc_icons=[s[0].id]),p.reset(e)}),[p,s,l]),(0,e.useEffect)((()=>{p.formState.isSubmitSuccessful&&p.reset(l)}),[p.formState.isSubmitSuccessful]),(0,e.createElement)(_t,{form:p},(0,e.createElement)(m.Flex,{direction:"column",gap:"1px",className:"full-height"},(0,e.createElement)(m.FlexItem,null,(0,e.createElement)(Hg,{onMapLoaded:i,markers:n,selected:t,icons:s})),(0,e.createElement)(m.FlexItem,{isBlock:!0},(0,e.createElement)(m.Card,{className:"full-height"},(0,e.createElement)(m.CardBody,null,"none"===c&&(0,e.createElement)("h3",{className:rt.noSelection},(0,f.__)("Select a marker from the list or add a new one.","image-map-connect")),"loading"===c&&(0,e.createElement)(m.Spinner,{style:{width:"100px",height:"100px"}}),("new"===c||"loaded"===c)&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(Ng,{markerType:l.type,title:l.title.raw,icons:s}),(0,e.createElement)("div",{className:"col-xs-3"},(0,e.createElement)(Ba,{marker:l,save:u,delete:h,listQuery:r}))))))))}const Xg={overlay:"yktN6m0k0lES4kt0B5C8",modal:"HODhlgu_0Q6FhpWTPuwJ",right:"HQJ7Ze0Xk7RtuaamCIiU"};function Jg({item:t}){return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",null,t.label),(0,e.createElement)("small",null,(0,e.createElement)("div",null,(0,f.__)("Type","image-map-connect"),": ",t.type," |"," ",(0,f.__)("Slug","image-map-connect"),": ",t.slug)))}function Kg({onRequestClose:t,layer:n,map:i,onRegisterMarker:r}){const{handleSubmit:o,control:s,watch:a}=it({defaultValues:{type:"standalone",post:0}}),l=(0,e.useRef)(),[c,d]=(0,e.useState)(),{list:u,loading:p}=_("postType","imc-marker",{layers_exclude:n,post_types:"unlinked",map:i,_fields:"id,title,type,slug",per_page:100,search:c},[n,i,c]),g=p?[{label:(0,f.__)("Loading","image-map-connect")+"..."}]:u.map((e=>({value:e.id,label:e.title.rendered,type:e.type,slug:e.slug})));function y(e){clearTimeout(l.current),l.current=setTimeout((()=>{d(e)}),300)}return(0,e.createElement)(m.Modal,{onRequestClose:t,title:"Add Marker",overlayClassName:Xg.overlay,className:Xg.modal},(0,e.createElement)(re,{name:"type",control:s,render:({field:t})=>(0,e.createElement)(m.RadioControl,{label:"Type",options:[{label:"Standalone marker",value:"standalone"},{label:"Existing post",value:"post"}],selected:t.value,onChange:t.onChange,className:rt.field})}),"post"===a("type")&&(0,e.createElement)(re,{name:"post",rules:{min:1},control:s,render:({field:t,fieldState:n})=>(0,e.createElement)(m.ComboboxControl,{label:"Post",options:g,value:t.value,onChange:t.onChange,onFilterValueChange:y,className:ot(n),__experimentalRenderItem:Jg})}),(0,e.createElement)("div",{className:Xg.right},(0,e.createElement)(m.Button,{className:"short",onClick:o((function(e){const n="post"===e.type?u.find((t=>t.id===e.post)):{id:"new"};h({marker:"new"}),r(n),t()})),variant:"primary"},(0,f.__)("Add","image-map-connect"))))}function $g(){var t;const{query:n,navigate:i}=d(),r={imc_layers:null!==(t=+n.layer)&&void 0!==t?t:0,_fields:"title,id,type,imc_icons,imc_loc",post_types:"all",map:n.map,per_page:-1},o=_("postType","imc-marker",r,[n.layer,n.map]),[s,a]=(0,e.useState)();(0,e.useEffect)((()=>{"new"!==n.marker&&a(o.list.find((e=>e.id===+n.marker)))}),[o.list,n.marker]);const[l,c]=(0,e.useState)(),[h,u]=(0,e.useState)(!1);return(0,e.createElement)(E,{list:o.list,titleAttr:"title.rendered",selected:+n.marker,selectItem:function(e){i({marker:e});const t=o.list.find((t=>t.id===e));l?.getView().animate({center:[t.imc_loc.lng,t.imc_loc.lat],duration:500})},loading:o.loading&&!o.list.length,addButton:(0,e.createElement)(m.Button,{variant:"primary",className:"medium",onClick:()=>u(!0)},(0,f.__)("Add Marker","image-map-connect"))},(0,e.createElement)(Yg,{listQuery:r,selected:s,markers:o,onMapLoaded:c}),h&&(0,e.createElement)(Kg,{onRequestClose:()=>u(!1),layer:+n.layer,map:+n.map,onRegisterMarker:a}))}const qg="xFJuXUy7eADohfEcBOvC",Qg="MLNykvwJ01rSzau_KQZ9",ey="mMipGIeN_jem3qZuUubI",ty="rjtaoUwcW3CxYOiS_uuT";function ny(){return(0,e.createElement)(m.Card,null,(0,e.createElement)(m.CardBody,{className:"grid direction-row-reverse"},(0,e.createElement)("div",{className:Qg+" col-12 col-md-3"},(0,e.createElement)("h2",{id:"toc"},(0,f.__)("Page contents","flare-imc")),(0,e.createElement)("ul",null,(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#about"},(0,f.__)("About the Plugin","flare-imc"))),(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#use"},(0,f.__)("How to Use the Plugin","flare-imc")),(0,e.createElement)("ul",null,(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#admin"},(0,f.__)("Plugin Admin Page","flare-imc"))),(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#block"},(0,f.__)("Image Map Connect Block","flare-imc"))))),(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#support"},(0,f.__)("Support and Enhancement Requests","flare-imc"))),(0,e.createElement)("li",null,(0,e.createElement)("a",{href:"#author"},(0,f.__)("About the Plugin Author","flare-imc"))))),(0,e.createElement)("div",{className:"col-12 col-md-9"},(0,e.createElement)("div",{className:qg},(0,e.createElement)("h2",{id:"about"},(0,f.__)("About the Plugin","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("Image Map Connect allows you to add any image to your WordPress website and make it an interactive image map. On the image map you can:","flare-imc")),(0,e.createElement)("ul",null,(0,e.createElement)("li",null,(0,f.__)("Display your posts as markers, including custom post types","flare-imc")),(0,e.createElement)("li",null,(0,f.__)("Show post details in a popup","flare-imc")),(0,e.createElement)("li",null,(0,f.__)("Filter markers","flare-imc")),(0,e.createElement)("li",null,(0,f.__)("Switch between layers","flare-imc")),(0,e.createElement)("li",null,(0,f.__)("Zoom in and out","flare-imc")),(0,e.createElement)("li",null,(0,f.__)("Use block settings to visually configure the plugin","flare-imc"))),(0,e.createElement)("h2",{id:"use"},(0,f.__)("How to Use the Plugin","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("The plugin is easy to set up following these four steps:","flare-imc")),(0,e.createElement)("figure",{className:ey},(0,e.createElement)("img",{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgd2lkdGg9Ijk3NjhweCIgaGVpZ2h0PSIxNjg4cHgiIHZpZXdCb3g9Ii0wLjUgLTAuNSA5NzY4IDE2ODgiPjxkZWZzLz48Zz48cmVjdCB4PSI3MjAwIiB5PSIwIiB3aWR0aD0iMjU2MCIgaGVpZ2h0PSIxNjgwIiByeD0iMjUyIiByeT0iMjUyIiBmaWxsPSJyZ2IoMjU1LCAyNTUsIDI1NSkiIHN0cm9rZT0iI2NjYzJkYyIgc3Ryb2tlLXdpZHRoPSI4IiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjYzMjAiIGhlaWdodD0iMTY4MCIgcng9IjI1MiIgcnk9IjI1MiIgZmlsbD0icmdiKDI1NSwgMjU1LCAyNTUpIiBzdHJva2U9IiNjY2MyZGMiIHN0cm9rZS13aWR0aD0iOCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IHg9IjAiIHk9IjI0MCIgd2lkdGg9IjYzMjAiIGhlaWdodD0iMjQwIiBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoOCkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA3ODhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0NXB4OyBtYXJnaW4tbGVmdDogMXB4OyI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+PGI+PGZvbnQgc3R5bGU9ImZvbnQtc2l6ZTogMTZweDsiPlBsdWdpbiBhZG1pbiBwYWdlPC9mb250PjwvYj48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzk1IiB5PSI0OSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlBsdWdpbiBhZG1pbiBwYWdlPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSIyNDAiIHk9IjY0MCIgd2lkdGg9IjE1MjAiIGhlaWdodD0iNzIwIiByeD0iMTA4IiByeT0iMTA4IiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS13aWR0aD0iOCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZWxsaXBzZSBjeD0iNTYwIiBjeT0iMTAwMCIgcng9IjE2MCIgcnk9IjE2MCIgZmlsbD0iI2UxZDVlNyIgc3Ryb2tlPSIjOTY3M2E2IiBzdHJva2Utd2lkdGg9IjgiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDgpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMjhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMjVweDsgbWFyZ2luLWxlZnQ6IDU2cHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogbm9uZTsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+PGZvbnQgc3R5bGU9ImZvbnQtc2l6ZTogMjJweDsiPjxiPjE8L2I+PC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI3MCIgeT0iMTI5IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MTwvdGV4dD48L3N3aXRjaD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDgpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgZmxleC1zdGFydDsgd2lkdGg6IDEwMXB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEyNXB4OyBtYXJnaW4tbGVmdDogMTAycHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTZweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPkNyZWF0ZTxiciAvPmltYWdlIG1hcDwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDIiIHk9IjEzMCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE2cHgiPkNyZWF0ZS4uLjwvdGV4dD48L3N3aXRjaD48L2c+PHBhdGggZD0iTSAxODQ0IDEwMzYgTCAxODQ0IDk1NiBMIDIxNjQgOTU2IEwgMjE2NCA4NzIgTCAyMzE2IDk5NiBMIDIxNjQgMTEyMCBMIDIxNjQgMTAzNiBaIiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIvPjxwYXRoIGQ9Ik0gNDAwNCAxMDM2IEwgNDAwNCA5NTYgTCA0MzI0IDk1NiBMIDQzMjQgODcyIEwgNDQ3NiA5OTYgTCA0MzI0IDExMjAgTCA0MzI0IDEwMzYgWiIgZmlsbD0iI2RhZThmYyIgc3Ryb2tlPSIjNmM4ZWJmIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48cGF0aCBkPSJNIDY1NjQgMTAzNiBMIDY1NjQgOTU2IEwgNjg4NCA5NTYgTCA2ODg0IDg3MiBMIDcwMzYgOTk2IEwgNjg4NCAxMTIwIEwgNjg4NCAxMDM2IFoiIGZpbGw9IiNkNWU4ZDQiIHN0cm9rZT0iIzgyYjM2NiIgc3Ryb2tlLXdpZHRoPSI4IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PHJlY3QgeD0iMjQwMCIgeT0iNjQwIiB3aWR0aD0iMTUyMCIgaGVpZ2h0PSI3MjAiIHJ4PSIxMDgiIHJ5PSIxMDgiIGZpbGw9IiNkYWU4ZmMiIHN0cm9rZT0iIzZjOGViZiIgc3Ryb2tlLXdpZHRoPSI4IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIvPjxyZWN0IHg9IjI0MDAiIHk9IjY0MCIgd2lkdGg9IjE1MjAiIGhlaWdodD0iNzIwIiByeD0iMTA4IiByeT0iMTA4IiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS13aWR0aD0iOCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZWxsaXBzZSBjeD0iMjcyMCIgY3k9IjEwMDAiIHJ4PSIxNjAiIHJ5PSIxNjAiIGZpbGw9IiNlMWQ1ZTciIHN0cm9rZT0iIzk2NzNhNiIgc3Ryb2tlLXdpZHRoPSI4IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSlzY2FsZSg4KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDI4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTI1cHg7IG1hcmdpbi1sZWZ0OiAzMjZweDsiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBub25lOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij48Zm9udCBzdHlsZT0iZm9udC1zaXplOiAyMnB4OyI+PGI+MjwvYj48L2ZvbnQ+PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjM0MCIgeT0iMTI5IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MjwvdGV4dD48L3N3aXRjaD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDgpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgZmxleC1zdGFydDsgd2lkdGg6IDEwMXB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEyNXB4OyBtYXJnaW4tbGVmdDogMzcycHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTZweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPkFkZCBsYXllcihzKTwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIzNzIiIHk9IjEzMCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE2cHgiPkFkZCBsYXllcihzKTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iNDU3NiIgeT0iNjQwIiB3aWR0aD0iMTUyMCIgaGVpZ2h0PSI3MjAiIHJ4PSIxMDgiIHJ5PSIxMDgiIGZpbGw9IiNkYWU4ZmMiIHN0cm9rZT0iIzZjOGViZiIgc3Ryb2tlLXdpZHRoPSI4IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIvPjxyZWN0IHg9IjQ1NzYiIHk9IjY0MCIgd2lkdGg9IjE1MjAiIGhlaWdodD0iNzIwIiByeD0iMTA4IiByeT0iMTA4IiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS13aWR0aD0iOCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZWxsaXBzZSBjeD0iNDg5NiIgY3k9IjEwMDAiIHJ4PSIxNjAiIHJ5PSIxNjAiIGZpbGw9IiNlMWQ1ZTciIHN0cm9rZT0iIzk2NzNhNiIgc3Ryb2tlLXdpZHRoPSI4IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSlzY2FsZSg4KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDI4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTI1cHg7IG1hcmdpbi1sZWZ0OiA1OThweDsiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBub25lOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij48Zm9udCBzdHlsZT0iZm9udC1zaXplOiAyMnB4OyI+PGI+MzwvYj48L2ZvbnQ+PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjYxMiIgeT0iMTI5IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MzwvdGV4dD48L3N3aXRjaD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDgpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgZmxleC1zdGFydDsgd2lkdGg6IDEwMXB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEyNXB4OyBtYXJnaW4tbGVmdDogNjQ0cHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTZweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPkFkZDxiciAvPm1hcmtlcnMgb24gdGhlIGxheWVyKHMpPC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjY0NCIgeT0iMTMwIiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTZweCI+QWRkLi4uPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSI3NzIwIiB5PSI2NDAiIHdpZHRoPSIxNTIwIiBoZWlnaHQ9IjcyMCIgcng9IjEwOCIgcnk9IjEwOCIgZmlsbD0iI2Q1ZThkNCIgc3Ryb2tlPSIjODJiMzY2IiBzdHJva2Utd2lkdGg9IjgiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PGVsbGlwc2UgY3g9IjgwNDAiIGN5PSIxMDAwIiByeD0iMTYwIiByeT0iMTYwIiBmaWxsPSIjZTFkNWU3IiBzdHJva2U9IiM5NjczYTYiIHN0cm9rZS13aWR0aD0iOCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoOCkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAyOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEyNXB4OyBtYXJnaW4tbGVmdDogOTkxcHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogbm9uZTsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+PGZvbnQgc3R5bGU9ImZvbnQtc2l6ZTogMjJweDsiPjxiPjQ8L2I+PC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDA1IiB5PSIxMjkiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj40PC90ZXh0Pjwvc3dpdGNoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoOCkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBmbGV4LXN0YXJ0OyB3aWR0aDogMTAxcHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTI1cHg7IG1hcmdpbi1sZWZ0OiAxMDM3cHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGxlZnQ7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTZweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPkFkZCBJbWFnZSBNYXAgQ29ubmVjdCBibG9jazwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDM3IiB5PSIxMzAiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNnB4Ij5BZGQgSW1hZ2UgTWFwLi4uPC90ZXh0Pjwvc3dpdGNoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoOCkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAzMThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0NXB4OyBtYXJnaW4tbGVmdDogOTAxcHg7Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogbm9uZTsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTogMTZweDsiPjxiPldvcmRQcmVzcyBwYWdlIG9yIHRlbXBsYXRlPC9iPjwvc3Bhbj48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMTA2MCIgeT0iNDkiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Xb3JkUHJlc3MgcGFnZSBvciB0ZW1wbGF0ZTwvdGV4dD48L3N3aXRjaD48L2c+PC9nPjxzd2l0Y2g+PGcgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ii8+PGEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNSkiIHhsaW5rOmhyZWY9Imh0dHBzOi8vd3d3LmRyYXdpby5jb20vZG9jL2ZhcS9zdmctZXhwb3J0LXRleHQtcHJvYmxlbXMiIHRhcmdldD0iX2JsYW5rIj48dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwcHgiIHg9IjUwJSIgeT0iMTAwJSI+VGV4dCBpcyBub3QgU1ZHIC0gY2Fubm90IGRpc3BsYXk8L3RleHQ+PC9hPjwvc3dpdGNoPjwvc3ZnPg==",alt:"Process diagram"}),(0,e.createElement)("figcaption",null,(0,f.__)("Image Map Connect steps","flare-imc"))),(0,e.createElement)("p",null,(0,f.__)("The tooltips in the Admin page and in the block editor will give you more information on the required fields.","flare-imc")),(0,e.createElement)("h4",{id:"admin"},(0,f.__)("Plugin Admin Page","flare-imc")),(0,e.createElement)("p",null,(0,f.__)('The "Image Maps" admin page is the page in the admin menu that you are currently on and has 4 tabs:',"flare-imc")),(0,e.createElement)(m.Panel,{className:ty},(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Maps tab","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("On the Maps tab you can manage your image map details like the image map name, description, and post and icon types.","flare-imc"))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Layers tab","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("On the Layers tab you can manage the layers for the selected map. A map can consist of one or more layers. Each layer defines an image to display, e.g. a floor of a building. Only one layer is visible at the time and the user can switch between them.","flare-imc"))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Markers tab","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("On the Markers tab you can manage the markers of the selected layer. Markers are placed at specific coordinates on a layer and reference a post or other content.","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("When a marker is clicked, it displays a popup with marker specific details (e.g. featured image, title and excerpt). These details can either be taken from a related post or defined directly in this tab.","flare-imc"))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Info tab","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("The tab you are currently on.","flare-imc")))),(0,e.createElement)("h4",{id:"block"},(0,f.__)("Image Map Connect Block","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("Image Map Connect includes the Image Map Connect block. This block will show the image map in the public user interface (UI).","flare-imc")),(0,e.createElement)(m.Panel,{className:ty},(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Block placement","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("The simplest option is to place the block on any page or post to display an image map.","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("It can also be added to page templates, post type templates or archives. How this is done depends on your theme.","flare-imc")),(0,e.createElement)("ul",null,(0,e.createElement)("li",null,(0,e.createInterpolateElement)((0,f.sprintf)(
// translators: %s: Link to the wordpress documentation.
(0,f.__)("For block themes: Add the block to the relevant template in the site editor. For details, see %s.","flare-imc"),"<a>"+(0,f.__)("the WordPress documentation","flare-imc")+"</a>"),{a:(0,e.createElement)("a",{href:"https://wordpress.org/documentation/article/template-editor/",target:"_blank",rel:"noreferrer"})})),(0,e.createElement)("li",null,(0,e.createInterpolateElement)((0,f.sprintf)(
// translators: %s: Link to the Block Visibility plugin.
(0,f.__)("For classic themes: Add the block to the widget area. Check with your theme which widget areas show up where. If more control is needed, you can use a plugin like %s.","flare-imc"),"<a>"+(0,f.__)("Block Visibility","flare-imc")+"</a>"),{a:(0,e.createElement)("a",{href:"https://wordpress.org/plugins/block-visibility/",target:"_blank",rel:"noreferrer"})})))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Framing the image in the block"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("The default layer and its position and zoom level in the public user interface is based on the selected layer, position and zoom level defined in the block editor.","flare-imc"))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Filtering Markers","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("To filter the markers that are displayed on the map, place the block inside a Query Loop block. In this case only the markers referencing posts in the query loop will be displayed on the map. ","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("You can choose to display standalone markers alongside the query loop posts by enabling this option in the block settings. However, it is not possible to filter them as they are not part of the query loop.","flare-imc"))),(0,e.createElement)(m.PanelBody,{title:(0,f.__)("Image Map and popup styling","flare-imc"),initialOpen:!1},(0,e.createElement)("p",null,(0,f.__)("The image map size, borders and background color are configurable in the block's Style tab. The popup text styling is taken from your theme by default and you can further modify the popup settings and style in the block's Settings tab.","flare-imc")))),(0,e.createElement)("h2",{id:"support"},(0,f.__)("Support and Enhancement Requests","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("Image Map Connect is an open-source plugin with a GNU General Public License v3.0 license. As such we do not provide any warranty. Of course, we like to see our plugin used and want to keep our users happy. As such we do our best to fix any issues that you might encounter.","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("We are also happy to hear about any features you think would be a great addition to the plugin.","flare-imc")),(0,e.createElement)("p",null,(0,f.__)("You can contact us in two ways at the moment:","flare-imc")),(0,e.createElement)("ul",null,(0,e.createElement)("li",null,(0,e.createInterpolateElement)((0,f.sprintf)(
// translators: %s: mailto link to info@flarehub.io
(0,f.__)("Send email to %s","flare-imc"),"<a>info@flarehub.io</a>"),{a:(0,e.createElement)("a",{href:"mailto:info@flarehub.io"})})),(0,e.createElement)("li",null,(0,e.createInterpolateElement)((0,f.sprintf)(
// translators: %s: mailto link to info@flarehub.io
(0,f.__)("Or you can report an issue in our %s. Please just make sure to search the existing issues and only report new ones.","flare-imc"),(0,f.__)("<a>Github repository</a>","flare-imc")),{a:(0,e.createElement)("a",{href:"https://github.com/Flare-Hub/image-map-connect-plugin/issues",target:"_blank",rel:"noreferrer"})}))),(0,e.createElement)("h2",{id:"author"},(0,f.__)("About the Plugin Author","flare-imc")),(0,e.createElement)("p",null,(0,e.createInterpolateElement)((0,f.sprintf)(
// translators: %s: Link to our homepage with the text Flare Hub.
(0,f.__)("We are a couple who enjoy working with solutions that smoothen user experience and processes, and offer informative and useful content. Through our company %s we help organisations to design and build intuitive digital products.","flare-imc"),"<a/>"),{a:(0,e.createElement)("a",{href:"https://flarehub.io",target:"_blank",rel:"noreferrer"},"Flare Hub")}))))))}const iy=document.getElementById("image-map-connect"),ry=(0,e.createElement)((function({children:t}){const[n,i]=(0,e.useState)(a.location.search),r=(0,e.useMemo)((()=>Object.fromEntries(new URLSearchParams(n))),[n]);return(0,e.useEffect)((()=>a.listen((({location:e})=>{i(e.search)}))),[]),(0,e.createElement)(l.Provider,{value:{query:r,history:a,navigate:h,createUrl:c}},t)}),null,(0,e.createElement)((function(){const{query:t,navigate:n}=d(),i=(0,g.useSelect)((e=>e(y.store).getNotices())),{removeNotice:r}=(0,g.useDispatch)(y.store),[o,s]=(0,e.useState)(0);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(m.NoticeList,{notices:i,onRemove:r,className:"sJmZ3PSZxnBz5BcGT7d6"}),(0,e.createElement)("div",{className:"DztrT6FfxSZGQizLAuvA"},(0,e.createElement)("div",{className:"UTKXTZueXjENnil45w3M"},(0,e.createElement)("h1",{className:"wp-heading-inline"},(0,f.__)("Image Map Connect","image-map-connect"))),(0,e.createElement)(m.CardDivider,null),(0,e.createElement)(m.TabPanel,{tabs:[{name:"maps",title:"Maps"},{name:"layers",title:"Layers",disabled:!t.map},{name:"markers",title:"Markers",disabled:!t.layer},{name:"info",title:(0,e.createElement)(m.Icon,{icon:b})}],onSelect:function(e){e!==t.tab&&(n({tab:e}),new URLSearchParams(window.location.search).get("tab")===t.tab&&s((e=>e+1)))},selectOnMove:!1,initialTabName:t.tab,className:"Emd6pyMM6DT0DW8KbrUu",key:o},(()=>null)),(0,e.createElement)(u,{param:"tab",rootPath:"maps",errorPath:"error"},(0,e.createElement)(p,{path:"maps"},(0,e.createElement)(Et,null)),(0,e.createElement)(p,{path:"layers"},(0,e.createElement)(La,null)),(0,e.createElement)(p,{path:"markers"},(0,e.createElement)($g,null)),(0,e.createElement)(p,{path:"info"},(0,e.createElement)(ny,null)),(0,e.createElement)(p,{path:"error"},(0,e.createElement)("h2",{className:"jI4ov4wxToyGe1PxuNaW"},"404: Page not found")))))}),null));e.createRoot?(0,e.createRoot)(iy).render(ry):(0,e.render)(ry,iy)})()})();